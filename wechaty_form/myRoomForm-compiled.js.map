{"version":3,"sources":["myRoomForm.js"],"names":[],"mappings":"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","file":"myRoomForm-compiled.js","sourcesContent":["/**\r\n * Created by zhuozhuo on 2017/5/16.\r\n */\r\nconst { Wechaty, Room } = require('wechaty')\r\nvar MongoClient = require('mongodb').MongoClient\r\nvar DB_CONN_STR = 'mongodb://localhost:27017/runoob'\r\nWechaty.instance()\r\n    .on('scan', (url, code) => {\r\n        let loginUrl = url.replace('qrcode', 'l')\r\n        require('qrcode-terminal').generate(loginUrl)\r\n        console.log(url)\r\n    })\r\n\r\n    .on('login', user => {\r\n        console.log(`${user} login`)\r\n    })\r\n\r\n    .on('friend', function(contact, request) {\r\n        if (request) {\r\n            request.accept().then(function() {\r\n                console.log(`Contact: ${contact.name()} send request ${request.hello}`)\r\n            })\r\n        }\r\n    })\r\n\r\n   /* .on('room-join', function(this, room, inviteeList, inviter) {\r\n        log.info('Bot', 'EVENT: room-join - Room %s got new member %s, invited by %s',\r\n            room.topic(),\r\n            inviteeList.map(c => c.name()).join(','),\r\n            inviter.name(),\r\n        )\r\n    })*/\r\n\r\n        .on('message', function(m) {\r\n            const contact = m.from()\r\n            const content = m.content()\r\n            const room = m.room()\r\n\r\n            if (room) {\r\n                console.log(`Room: ${room.topic()} Contact: ${contact.name()} Content: ${content}`)\r\n            } else {\r\n                console.log(`Contact: ${contact.name()} Content: ${content}`)\r\n            }\r\n\r\n            if (m.self()) {\r\n                return\r\n            }\r\n\r\n            if (/What/.test(content)) {\r\n                m.say(\"I am coding!\")\r\n            }\r\n\r\n            if (/swim/.test(content)) {\r\n                let user = `${contact.name()}`\r\n                m.say(\"Please click the following url, and input the form. You will be invited into the group after checked!\")\r\n                m.say('http://192.168.1.117:8081/form?contact='+user)\r\n\r\n                var selectData = function (db, callback) {\r\n                    //连接到表\r\n                    var collection = db.collection('site')\r\n                    //查询数据\r\n                    var array = {\"status\": 1}\r\n                    collection.find(array).toArray(function (err, result) {\r\n                        if (err) {\r\n                            console.log('Error:' + err)\r\n                            return;\r\n                        }\r\n                        callback(result);\r\n\r\n                    });\r\n                }\r\n\r\n                MongoClient.connect(DB_CONN_STR, function (err, db) {\r\n                    console.log(\"连接成功！\");\r\n                    selectData(db, function (result) {\r\n                        console.log(result);\r\n                        if(result.length>0){\r\n                            for(var i=0 ;i<result.length;i++)\r\n                                Room.find({ topic: \"swim\" }).then(function(keyroom) {\r\n                                    if (keyroom) {\r\n                                        keyroom.add(result[i].contact).then(function() {\r\n                                            keyroom.say(\"welcome!\", result[i].contact)\r\n                                        })\r\n                                    }\r\n                                })\r\n                        }\r\n                       // res.end(JSON.stringify(result));\r\n                        db.close();\r\n                    });\r\n                });\r\n            }\r\n\r\n\r\n\r\n            if (/out/.test(content)) {\r\n                Room.find({ topic: \"test\" }).then(function(keyroom) {\r\n                    if (keyroom) {\r\n                        keyroom.del(contact).then(function() {\r\n                            keyroom.say(\"Remove from the room\", contact)\r\n                        })\r\n                    }\r\n                })\r\n            }\r\n        })\r\n\r\n        .init()"]}