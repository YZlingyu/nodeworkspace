{"version":3,"sources":["safari.js"],"names":[],"mappings":"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","file":"safari-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n/**\n * @fileoverview Defines a WebDriver client for Safari.\n */\n\n'use strict';\n\nconst http = require('./http');\nconst io = require('./io');\nconst {Capabilities, Capability} = require('./lib/capabilities');\nconst command = require('./lib/command');\nconst error = require('./lib/error');\nconst logging = require('./lib/logging');\nconst promise = require('./lib/promise');\nconst Symbols = require('./lib/symbols');\nconst webdriver = require('./lib/webdriver');\nconst portprober = require('./net/portprober');\nconst remote = require('./remote');\n\n\n/**\n * @return {string} .\n * @throws {Error}\n */\nfunction findSafariDriver() {\n  let exe = io.findInPath('safaridriver', true);\n  if (!exe) {\n    throw Error(\n      `The safaridriver executable could not be found on the current PATH.\n      Please ensure you are using Safari 10.0 or above.`);\n  }\n  return exe;\n}\n\n\n/**\n * Creates {@link selenium-webdriver/remote.DriverService} instances that manage\n * a [safaridriver] server in a child process.\n *\n * [safaridriver]: https://developer.apple.com/library/prerelease/content/releasenotes/General/WhatsNewInSafari/Articles/Safari_10_0.html#//apple_ref/doc/uid/TP40014305-CH11-DontLinkElementID_28\n */\nclass ServiceBuilder extends remote.DriverService.Builder {\n  /**\n   * @param {string=} opt_exe Path to the server executable to use. If omitted,\n   *     the builder will attempt to locate the safaridriver on the system PATH.\n   */\n  constructor(opt_exe) {\n    super(opt_exe || findSafariDriver());\n    this.setLoopback(true);  // Required.\n  }\n}\n\n\nconst OPTIONS_CAPABILITY_KEY = 'safari.options';\nconst TECHNOLOGY_PREVIEW_OPTIONS_KEY = 'technologyPreview';\n\n/**\n * Configuration options specific to the {@link Driver SafariDriver}.\n */\nclass Options {\n  constructor() {\n    /** @private {Object<string, *>} */\n    this.options_ = null;\n\n    /** @private {./lib/logging.Preferences} */\n    this.logPrefs_ = null;\n\n    /** @private {?./lib/capabilities.ProxyConfig} */\n    this.proxy_ = null;\n  }\n\n  /**\n   * Extracts the SafariDriver specific options from the given capabilities\n   * object.\n   * @param {!Capabilities} capabilities The capabilities object.\n   * @return {!Options} The SafariDriver options.\n   */\n  static fromCapabilities(capabilities) {\n    var options = new Options();\n    var o = capabilities.get(OPTIONS_CAPABILITY_KEY);\n\n    if (o instanceof Options) {\n      options = o;\n    } else if (o) {\n      options.setCleanSession(o.cleanSession);\n      options.setTechnologyPreview(o[TECHNOLOGY_PREVIEW_OPTIONS_KEY]);\n    }\n\n    if (capabilities.has(Capability.PROXY)) {\n      options.setProxy(capabilities.get(Capability.PROXY));\n    }\n\n    if (capabilities.has(Capability.LOGGING_PREFS)) {\n      options.setLoggingPrefs(capabilities.get(Capability.LOGGING_PREFS));\n    }\n\n    return options;\n  }\n\n  /**\n   * Sets whether to force Safari to start with a clean session. Enabling this\n   * option will cause all global browser data to be deleted.\n   * @param {boolean} clean Whether to make sure the session has no cookies,\n   *     cache entries, local storage, or databases.\n   * @return {!Options} A self reference.\n   */\n  setCleanSession(clean) {\n    if (!this.options_) {\n      this.options_ = {};\n    }\n    this.options_['cleanSession'] = clean;\n    return this;\n  }\n\n  /**\n   * Sets the logging preferences for the new session.\n   * @param {!./lib/logging.Preferences} prefs The logging preferences.\n   * @return {!Options} A self reference.\n   */\n  setLoggingPrefs(prefs) {\n    this.logPrefs_ = prefs;\n    return this;\n  }\n\n  /**\n   * Sets the proxy to use.\n   *\n   * @param {./lib/capabilities.ProxyConfig} proxy The proxy configuration to use.\n   * @return {!Options} A self reference.\n   */\n  setProxy(proxy) {\n    this.proxy_ = proxy;\n    return this;\n  }\n\n  /**\n   * Instruct the SafariDriver to use the Safari Technology Preview if true.\n   * Otherwise, use the release version of Safari. Defaults to using the release version of Safari.\n   *\n   * @param {boolean} useTechnologyPreview\n   * @return {!Options} A self reference.\n   */\n  setTechnologyPreview(useTechnologyPreview) {\n    if (!this.options_) {\n      this.options_ = {};\n    }\n\n    this.options_[TECHNOLOGY_PREVIEW_OPTIONS_KEY] = !!useTechnologyPreview;\n    return this;\n  }\n\n  /**\n   * Converts this options instance to a {@link Capabilities} object.\n   * @param {Capabilities=} opt_capabilities The capabilities to\n   *     merge these options into, if any.\n   * @return {!Capabilities} The capabilities.\n   */\n  toCapabilities(opt_capabilities) {\n    var caps = opt_capabilities || Capabilities.safari();\n    if (this.logPrefs_) {\n      caps.set(Capability.LOGGING_PREFS, this.logPrefs_);\n    }\n    if (this.proxy_) {\n      caps.set(Capability.PROXY, this.proxy_);\n    }\n    if (this.options_) {\n      caps.set(OPTIONS_CAPABILITY_KEY, this);\n    }\n    return caps;\n  }\n\n  /**\n   * Converts this instance to its JSON wire protocol representation. Note this\n   * function is an implementation detail not intended for general use.\n   * @return {!Object<string, *>} The JSON wire protocol representation of this\n   *     instance.\n   */\n  [Symbols.serialize]() {\n    return this.options_ || {};\n  }\n}\n\n/**\n * @param  {(Options|Object<string, *>)=} o The options object\n * @return {boolean}\n */\nfunction useTechnologyPreview(o) {\n  if (o instanceof Options) {\n    return !!(o.options_ && o.options_[TECHNOLOGY_PREVIEW_OPTIONS_KEY]);\n  }\n\n  if (o && typeof o === 'object') {\n    return !!o[TECHNOLOGY_PREVIEW_OPTIONS_KEY];\n  }\n\n  return false;\n}\n\nconst SAFARIDRIVER_TECHNOLOGY_PREVIEW_EXE = '/Applications/Safari Technology Preview.app/Contents/MacOS/safaridriver';\n\n/**\n * A WebDriver client for Safari. This class should never be instantiated\n * directly; instead, use the {@linkplain ./builder.Builder Builder}:\n *\n *     var driver = new Builder()\n *         .forBrowser('safari')\n *         .build();\n *\n */\nclass Driver extends webdriver.WebDriver {\n  /**\n   * Creates a new Safari session.\n   *\n   * @param {(Options|Capabilities)=} opt_config The configuration\n   *     options for the new session.\n   * @param {promise.ControlFlow=} opt_flow The control flow to create\n   *     the driver under.\n   * @return {!Driver} A new driver instance.\n   */\n  static createSession(opt_config, opt_flow) {\n    let caps, exe;\n\n    if (opt_config instanceof Options) {\n      caps = opt_config.toCapabilities();\n    } else {\n      caps = opt_config || Capabilities.safari();\n    }\n\n    if (useTechnologyPreview(caps.get(OPTIONS_CAPABILITY_KEY))) {\n      exe = SAFARIDRIVER_TECHNOLOGY_PREVIEW_EXE;\n    }\n\n    let service = new ServiceBuilder(exe).build();\n    let executor = new http.Executor(\n        service.start().then(url => new http.HttpClient(url)));\n\n    return /** @type {!Driver} */(webdriver.WebDriver.createSession(\n        executor, caps, opt_flow, this, () => service.kill()));\n  }\n}\n\n\n// Public API\n\n\nexports.Driver = Driver;\nexports.Options = Options;\nexports.ServiceBuilder = ServiceBuilder;\n"]}