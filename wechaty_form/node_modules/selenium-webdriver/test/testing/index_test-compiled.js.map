{"version":3,"sources":["index_test.js"],"names":[],"mappings":"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","file":"index_test-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n'use strict';\n\nconst assert = require('assert');\nconst promise = require('../..').promise;\nconst {enablePromiseManager} = require('../../lib/test/promise');\n\n\nvar test = require('../../testing');\n\ndescribe('Mocha Integration', function() {\n\n  describe('beforeEach properly binds \"this\"', function() {\n    beforeEach(function() { this.x = 1; });\n    test.beforeEach(function() { this.x = 2; });\n    it('', function() { assert.equal(this.x, 2); });\n  });\n\n  describe('afterEach properly binds \"this\"', function() {\n    it('', function() { this.x = 1; });\n    test.afterEach(function() { this.x = 2; });\n    afterEach(function() { assert.equal(this.x, 2); });\n  });\n\n  describe('it properly binds \"this\"', function() {\n    beforeEach(function() { this.x = 1; });\n    test.it('', function() { this.x = 2; });\n    afterEach(function() { assert.equal(this.x, 2); });\n  });\n\n  enablePromiseManager(function() {\n    describe('timeout handling', function() {\n      describe('it does not reset the control flow on a non-timeout', function() {\n        var flowReset = false;\n\n        beforeEach(function() {\n          flowReset = false;\n          test.controlFlow().once(promise.ControlFlow.EventType.RESET, onreset);\n        });\n\n        test.it('', function() {\n          this.timeout(100);\n          return promise.delayed(50);\n        });\n\n        afterEach(function() {\n          assert.ok(!flowReset);\n          test.controlFlow().removeListener(\n              promise.ControlFlow.EventType.RESET, onreset);\n        });\n\n        function onreset() {\n          flowReset = true;\n        }\n      });\n\n      describe('it resets the control flow after a timeout' ,function() {\n        var timeoutErr, flowReset;\n\n        beforeEach(function() {\n          flowReset = false;\n          test.controlFlow().once(promise.ControlFlow.EventType.RESET, onreset);\n        });\n\n        test.it('', function() {\n          var callback = this.runnable().callback;\n          var test = this;\n          this.runnable().callback = function(err) {\n            timeoutErr = err;\n            // Reset our timeout to 0 so Mocha does not fail the test.\n            test.timeout(0);\n            // When we invoke the real callback, do not pass along the error so\n            // Mocha does not fail the test.\n            return callback.call(this);\n          };\n\n          test.timeout(50);\n          return promise.defer().promise;\n        });\n\n        afterEach(function() {\n          return Promise.resolve().then(function() {\n            test.controlFlow().removeListener(\n                promise.ControlFlow.EventType.RESET, onreset);\n            assert.ok(flowReset, 'control flow was not reset after a timeout');\n          });\n        });\n\n        function onreset() {\n          flowReset = true;\n        }\n      });\n    });\n\n    describe('async \"done\" support', function() {\n       this.timeout(2*1000);\n\n       var waited = false;\n       var DELAY = 100; // ms enough to notice\n\n       // Each test asynchronously sets waited to true, so clear/check waited\n       // before/after:\n       beforeEach(function() {\n          waited = false;\n       });\n\n       afterEach(function() {\n          assert.strictEqual(waited, true);\n       });\n\n       // --- First, vanilla mocha \"it\" should support the \"done\" callback correctly.\n\n       // This 'it' should block until 'done' is invoked\n       it('vanilla delayed', function(done) {\n          setTimeout(function delayedVanillaTimeout() {\n             waited = true;\n             done();\n          }, DELAY);\n       });\n\n       // --- Now with the webdriver wrappers for 'it' should support the \"done\" callback:\n\n       test.it('delayed', function(done) {\n          assert(done);\n          assert.strictEqual(typeof done, 'function');\n          setTimeout(function delayedTimeoutCallback() {\n             waited = true;\n             done();\n          }, DELAY);\n       });\n\n       // --- And test that the webdriver wrapper for 'it' works with a returned promise, too:\n\n       test.it('delayed by promise', function() {\n          var defer = promise.defer();\n          setTimeout(function delayedPromiseCallback() {\n             waited = true;\n             defer.fulfill('ignored');\n          });\n          return defer.promise;\n       });\n    });\n\n    describe('ControlFlow and \"done\" work together', function() {\n       var flow, order;\n       before(function() {\n          order = [];\n          flow = test.controlFlow();\n          flow.execute(function() { order.push(1); });\n       });\n\n       test.it('control flow updates and async done', function(done) {\n          flow.execute(function() { order.push(2); });\n          flow.execute(function() { order.push(3); }).then(function() {\n             order.push(4);\n          });\n          done();\n       });\n\n       after(function() {\n          assert.deepEqual([1, 2, 3, 4], order);\n       });\n    });\n  });\n\n  describe('generator support', function() {\n    let arr;\n\n    beforeEach(() => arr = []);\n    afterEach(() => assert.deepEqual(arr, [0, 1, 2, 3]));\n\n    test.it('sync generator', function* () {\n      arr.push(yield arr.length);\n      arr.push(yield arr.length);\n      arr.push(yield arr.length);\n      arr.push(yield arr.length);\n    });\n\n    test.it('async generator', function* () {\n      arr.push(yield Promise.resolve(arr.length));\n      arr.push(yield Promise.resolve(arr.length));\n      arr.push(yield Promise.resolve(arr.length));\n      arr.push(yield Promise.resolve(arr.length));\n    });\n\n    test.it('generator returns promise', function*() {\n      arr.push(yield Promise.resolve(arr.length));\n      arr.push(yield Promise.resolve(arr.length));\n      arr.push(yield Promise.resolve(arr.length));\n      setTimeout(_ => arr.push(arr.length), 10);\n      return new Promise((resolve) => setTimeout(_ => resolve(), 25));\n    });\n\n    describe('generator runs with proper \"this\" context', () => {\n      before(function() { this.values = [0, 1, 2, 3]; });\n      test.it('', function*() {\n        arr = this.values;\n      });\n    });\n\n    it('generator function must not take a callback', function() {\n      arr = [0, 1, 2, 3];  // For teardown hook.\n      assert.throws(_ => {\n        test.it('', function*(done){});\n      }, TypeError);\n    });\n  });\n});\n"]}