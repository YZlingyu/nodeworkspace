{"version":3,"sources":["firefox_test.js"],"names":[],"mappings":"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","file":"firefox_test-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n'use strict';\n\nvar path = require('path');\n\nvar firefox = require('../../firefox'),\n    io = require('../../io'),\n    test = require('../../lib/test'),\n    assert = require('../../testing/assert'),\n    Context = require('../../firefox').Context,\n    error = require('../..').error;\n\nvar {consume} = require('../../lib/promise');\n\n\nvar JETPACK_EXTENSION = path.join(__dirname,\n    '../../lib/test/data/firefox/jetpack-sample.xpi');\nvar NORMAL_EXTENSION = path.join(__dirname,\n    '../../lib/test/data/firefox/sample.xpi');\n\n\ntest.suite(function(env) {\n  describe('firefox', function() {\n    describe('Options', function() {\n      var driver;\n\n      test.beforeEach(function() {\n        driver = null;\n      });\n\n      test.afterEach(function() {\n        if (driver) {\n          return driver.quit();\n        }\n      });\n\n      /**\n       * Runs a test that requires Firefox Developer Edition. The test will be\n       * skipped if dev cannot be found on the current system.\n       */\n      function runWithFirefoxDev(options, testFn) {\n        return firefox.Channel.AURORA.locate().then(exe => {\n          options.setBinary(exe);\n          driver = env.builder()\n              .setFirefoxOptions(options)\n              .build();\n          return driver.call(testFn);\n        }, err => {\n          console.warn(\n              'Skipping test: could not find Firefox Dev Edition: ' + err);\n        });\n      }\n\n      describe('can start Firefox with custom preferences', function() {\n        function runTest(opt_dir) {\n          return consume(function*() {\n            let profile = new firefox.Profile(opt_dir);\n            profile.setPreference('general.useragent.override', 'foo;bar');\n\n            let options = new firefox.Options().setProfile(profile);\n\n            driver = env.builder().\n                setFirefoxOptions(options).\n                build();\n\n            yield driver.get('data:text/html,<html><div>content</div></html>');\n\n            var userAgent = yield driver.executeScript(\n                'return window.navigator.userAgent');\n            assert(userAgent).equalTo('foo;bar');\n          });\n        }\n\n        test.it('profile created from scratch', function() {\n          return runTest();\n        });\n\n        test.it('profile created from template', function() {\n          return io.tmpDir().then(runTest);\n        });\n      });\n\n      test.it('can start Firefox with a jetpack extension', function() {\n        let profile = new firefox.Profile();\n        profile.addExtension(JETPACK_EXTENSION);\n\n        let options = new firefox.Options().setProfile(profile);\n\n        return runWithFirefoxDev(options, function*() {\n          yield loadJetpackPage(driver,\n              'data:text/html;charset=UTF-8,<html><div>content</div></html>');\n\n          let text =\n              yield driver.findElement({id: 'jetpack-sample-banner'}).getText();\n          assert(text).equalTo('Hello, world!');\n        });\n      });\n\n      test.it('can start Firefox with a normal extension', function() {\n        let profile = new firefox.Profile();\n        profile.addExtension(NORMAL_EXTENSION);\n\n        let options = new firefox.Options().setProfile(profile);\n\n        return runWithFirefoxDev(options, function*() {\n          yield driver.get('data:text/html,<html><div>content</div></html>');\n\n          let footer =\n              yield driver.findElement({id: 'sample-extension-footer'});\n          let text = yield footer.getText();\n          assert(text).equalTo('Goodbye');\n        });\n      });\n\n      test.it('can start Firefox with multiple extensions', function() {\n        let profile = new firefox.Profile();\n        profile.addExtension(JETPACK_EXTENSION);\n        profile.addExtension(NORMAL_EXTENSION);\n\n        let options = new firefox.Options().setProfile(profile);\n\n        return runWithFirefoxDev(options, function*() {\n          yield loadJetpackPage(driver,\n              'data:text/html;charset=UTF-8,<html><div>content</div></html>');\n\n          let banner =\n              yield driver.findElement({id: 'jetpack-sample-banner'}).getText();\n          assert(banner).equalTo('Hello, world!');\n\n          let footer =\n              yield driver.findElement({id: 'sample-extension-footer'})\n                  .getText();\n          assert(footer).equalTo('Goodbye');\n        });\n      });\n\n      function loadJetpackPage(driver, url) {\n        // On linux the jetpack extension does not always run the first time\n        // we load a page. If this happens, just reload the page (a simple\n        // refresh doesn't appear to work).\n        return driver.wait(function() {\n          driver.get(url);\n          return driver.findElements({id: 'jetpack-sample-banner'})\n              .then(found => found.length > 0);\n        }, 3000);\n      }\n    });\n\n    describe('binary management', function() {\n      var driver1, driver2;\n\n      test.ignore(env.isRemote).\n      it('can start multiple sessions with single binary instance', function*() {\n        var options = new firefox.Options().setBinary(new firefox.Binary);\n        env.builder().setFirefoxOptions(options);\n        driver1 = yield env.builder().build();\n        driver2 = yield env.builder().build();\n        // Ok if this doesn't fail.\n      });\n\n      test.afterEach(function*() {\n        if (driver1) {\n          yield driver1.quit();\n        }\n\n        if (driver2) {\n          yield driver2.quit();\n        }\n      });\n    });\n\n    describe('context switching', function() {\n      var driver;\n\n      test.beforeEach(function*() {\n        driver = yield env.builder().build();\n      });\n\n      test.afterEach(function() {\n        if (driver) {\n          return driver.quit();\n        }\n      });\n\n      test.ignore(() => !env.isMarionette).\n      it('can get context', function() {\n        return assert(driver.getContext()).equalTo(Context.CONTENT);\n      });\n\n      test.ignore(() => !env.isMarionette).\n      it('can set context', function*() {\n        yield driver.setContext(Context.CHROME);\n        let ctxt = yield driver.getContext();\n        assert(ctxt).equalTo(Context.CHROME);\n\n        yield driver.setContext(Context.CONTENT);\n        ctxt = yield driver.getContext();\n        assert(ctxt).equalTo(Context.CONTENT);\n      });\n\n      test.ignore(() => !env.isMarionette).\n      it('throws on unknown context', function() {\n        return driver.setContext(\"foo\").then(assert.fail, function(e) {\n          assert(e).instanceOf(error.InvalidArgumentError);\n        });\n      });\n    });\n\n  });\n}, {browsers: ['firefox']});\n"]}