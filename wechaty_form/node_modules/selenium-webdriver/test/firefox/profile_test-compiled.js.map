{"version":3,"sources":["profile_test.js"],"names":[],"mappings":"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","file":"profile_test-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n'use strict';\n\nvar AdmZip = require('adm-zip'),\n    assert = require('assert'),\n    fs = require('fs'),\n    path = require('path');\n\nvar promise = require('../..').promise,\n    Profile = require('../../firefox/profile').Profile,\n    decode = require('../../firefox/profile').decode,\n    loadUserPrefs = require('../../firefox/profile').loadUserPrefs,\n    io = require('../../io');\n\n\nvar JETPACK_EXTENSION = path.join(__dirname,\n    '../../lib/test/data/firefox/jetpack-sample.xpi');\nvar NORMAL_EXTENSION = path.join(__dirname,\n    '../../lib/test/data/firefox/sample.xpi');\n\nvar JETPACK_EXTENSION_ID = 'jid1-EaXX7k0wwiZR7w@jetpack.xpi';\nvar NORMAL_EXTENSION_ID = 'sample@seleniumhq.org';\nvar WEBDRIVER_EXTENSION_ID = 'fxdriver@googlecode.com';\n\n\n\ndescribe('Profile', function() {\n  describe('setPreference', function() {\n    it('allows setting custom properties', function() {\n      var profile = new Profile();\n      assert.equal(undefined, profile.getPreference('foo'));\n\n      profile.setPreference('foo', 'bar');\n      assert.equal('bar', profile.getPreference('foo'));\n    });\n\n    it('allows overriding mutable properties', function() {\n      var profile = new Profile();\n\n      profile.setPreference('browser.newtab.url', 'http://www.example.com');\n      assert.equal('http://www.example.com',\n          profile.getPreference('browser.newtab.url'));\n    });\n\n    it('throws if setting a frozen preference', function() {\n      var profile = new Profile();\n      assert.throws(function() {\n        profile.setPreference('app.update.auto', true);\n      });\n    });\n  });\n\n  describe('writeToDisk', function() {\n    it('copies template directory recursively', function() {\n      var templateDir;\n      return io.tmpDir().then(function(td) {\n        templateDir = td;\n        var foo = path.join(templateDir, 'foo');\n        fs.writeFileSync(foo, 'Hello, world');\n\n        var bar = path.join(templateDir, 'subfolder/bar');\n        fs.mkdirSync(path.dirname(bar));\n        fs.writeFileSync(bar, 'Goodbye, world!');\n\n        return new Profile(templateDir).writeToDisk();\n      }).then(function(profileDir) {\n        assert.notEqual(profileDir, templateDir);\n\n        assert.equal('Hello, world',\n            fs.readFileSync(path.join(profileDir, 'foo')));\n        assert.equal('Goodbye, world!',\n            fs.readFileSync(path.join(profileDir, 'subfolder/bar')));\n      });\n    });\n\n    it('does not copy lock files', function() {\n      return io.tmpDir().then(function(dir) {\n        fs.writeFileSync(path.join(dir, 'parent.lock'), 'lock');\n        fs.writeFileSync(path.join(dir, 'lock'), 'lock');\n        fs.writeFileSync(path.join(dir, '.parentlock'), 'lock');\n        return new Profile(dir).writeToDisk();\n      }).then(function(dir) {\n        assert.ok(fs.existsSync(dir));\n        assert.ok(!fs.existsSync(path.join(dir, 'parent.lock')));\n        assert.ok(!fs.existsSync(path.join(dir, 'lock')));\n        assert.ok(!fs.existsSync(path.join(dir, '.parentlock')));\n      });\n    });\n\n    describe('user.js', function() {\n\n      it('writes defaults', function() {\n        return new Profile().writeToDisk().then(function(dir) {\n          return loadUserPrefs(path.join(dir, 'user.js'));\n        }).then(function(prefs) {\n          // Just check a few.\n          assert.equal(false, prefs['app.update.auto']);\n          assert.equal(true, prefs['browser.EULA.override']);\n          assert.equal(false, prefs['extensions.update.enabled']);\n          assert.equal('about:blank', prefs['browser.newtab.url']);\n          assert.equal(30, prefs['dom.max_script_run_time']);\n        });\n      });\n\n      it('merges template user.js into preferences', function() {\n        return io.tmpDir().then(function(dir) {\n          fs.writeFileSync(path.join(dir, 'user.js'), [\n            'user_pref(\"browser.newtab.url\", \"http://www.example.com\")',\n            'user_pref(\"dom.max_script_run_time\", 1234)'\n          ].join('\\n'));\n\n          return new Profile(dir).writeToDisk();\n        }).then(function(profile) {\n          return loadUserPrefs(path.join(profile, 'user.js'));\n        }).then(function(prefs) {\n          assert.equal('http://www.example.com', prefs['browser.newtab.url']);\n          assert.equal(1234, prefs['dom.max_script_run_time']);\n        });\n      });\n\n      it('ignores frozen preferences when merging template user.js',\n        function() {\n          return io.tmpDir().then(function(dir) {\n            fs.writeFileSync(path.join(dir, 'user.js'),\n                'user_pref(\"app.update.auto\", true)');\n            return new Profile(dir).writeToDisk();\n          }).then(function(profile) {\n            return loadUserPrefs(path.join(profile, 'user.js'));\n          }).then(function(prefs) {\n            assert.equal(false, prefs['app.update.auto']);\n          });\n        });\n    });\n\n    describe('extensions', function() {\n      it('are copied into new profile directory', function() {\n        var profile = new Profile();\n        profile.addExtension(JETPACK_EXTENSION);\n        profile.addExtension(NORMAL_EXTENSION);\n\n        return profile.writeToDisk().then(function(dir) {\n          dir = path.join(dir, 'extensions');\n          assert.ok(fs.existsSync(path.join(dir, JETPACK_EXTENSION_ID)));\n          assert.ok(fs.existsSync(path.join(dir, NORMAL_EXTENSION_ID)));\n          assert.ok(fs.existsSync(path.join(dir, WEBDRIVER_EXTENSION_ID)));\n        });\n      });\n    });\n  });\n\n  describe('encode', function() {\n    it('excludes the bundled WebDriver extension', function() {\n      return new Profile().encode().then(function(data) {\n        return decode(data);\n      }).then(function(dir) {\n        assert.ok(fs.existsSync(path.join(dir, 'user.js')));\n        assert.ok(fs.existsSync(path.join(dir, 'extensions')));\n        return loadUserPrefs(path.join(dir, 'user.js'));\n      }).then(function(prefs) {\n        // Just check a few.\n        assert.equal(false, prefs['app.update.auto']);\n        assert.equal(true, prefs['browser.EULA.override']);\n        assert.equal(false, prefs['extensions.update.enabled']);\n        assert.equal('about:blank', prefs['browser.newtab.url']);\n        assert.equal(30, prefs['dom.max_script_run_time']);\n      });\n    });\n  });\n});\n"]}