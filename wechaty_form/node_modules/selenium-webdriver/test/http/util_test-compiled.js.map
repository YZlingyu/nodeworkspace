{"version":3,"sources":["util_test.js"],"names":[],"mappings":"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","file":"util_test-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n'use strict';\n\nconst assert = require('assert');\nconst http = require('http');\n\nconst error = require('../../lib/error');\nconst util = require('../../http/util');\nconst promise = require('../../lib/promise');\n\ndescribe('selenium-webdriver/http/util', function() {\n\n  var server, baseUrl;\n\n  var status, value, responseCode;\n\n  function startServer(done) {\n    if (server) return done();\n\n    server = http.createServer(function(req, res) {\n      var data = JSON.stringify({status: status, value: value});\n      res.writeHead(responseCode, {\n        'Content-Type': 'application/json; charset=utf-8',\n        'Content-Length': Buffer.byteLength(data, 'utf8')\n      });\n      res.end(data);\n    });\n\n    server.listen(0, '127.0.0.1', function(e) {\n      if (e) return done(e);\n\n      var addr = server.address();\n      baseUrl = 'http://' + addr.address + ':' + addr.port;\n      done();\n    });\n  }\n\n  function killServer(done) {\n    if (!server) return done();\n    server.close(done);\n    server = null;\n  }\n\n  after(killServer);\n\n  beforeEach(function(done) {\n    status = 0;\n    value = 'abc123';\n    responseCode = 200;\n    startServer(done);\n  });\n\n  describe('#getStatus', function() {\n    it('should return value field on success', function() {\n      return util.getStatus(baseUrl).then(function(response) {\n        assert.equal('abc123', response);\n      });\n    });\n\n    it('should fail if response object is not success', function() {\n      status = 1;\n      return util.getStatus(baseUrl).then(function() {\n        throw Error('expected a failure');\n      }, function(err) {\n        assert.ok(err instanceof error.WebDriverError);\n        assert.equal(err.code, error.WebDriverError.code);\n        assert.equal(err.message, value);\n      });\n    });\n\n    it('should fail if the server is not listening', function(done) {\n      killServer(function(e) {\n        if(e) return done(e);\n\n        util.getStatus(baseUrl).then(function() {\n          done(Error('expected a failure'));\n        }, function() {\n          // Expected.\n          done();\n        });\n      });\n    });\n\n    it('should fail if HTTP status is not 200', function() {\n      status = 1;\n      responseCode = 404;\n      return util.getStatus(baseUrl).then(function() {\n        throw Error('expected a failure');\n      }, function(err) {\n        assert.ok(err instanceof error.WebDriverError);\n        assert.equal(err.code, error.WebDriverError.code);\n        assert.equal(err.message, value);\n      });\n    });\n  });\n\n  describe('#waitForServer', function() {\n    it('resolves when server is ready', function() {\n      status = 1;\n      setTimeout(function() { status = 0; }, 50);\n      return util.waitForServer(baseUrl, 100);\n    });\n\n    it('should fail if server does not become ready', function() {\n      status = 1;\n      return util.waitForServer(baseUrl, 50).\n          then(function() {throw Error('Expected to time out')},\n               function() {});\n    });\n\n    it('can cancel wait', function() {\n      status = 1;\n      let cancel = new Promise(resolve => {\n        setTimeout(_ => resolve(), 50)\n      });\n      return util.waitForServer(baseUrl, 200, cancel)\n          .then(\n              () => { throw Error('Did not expect to succeed!'); },\n              (e) => assert.ok(e instanceof promise.CancellationError));\n    });\n  });\n\n  describe('#waitForUrl', function() {\n    it('succeeds when URL returns 2xx', function() {\n      responseCode = 404;\n      setTimeout(function() { responseCode = 200; }, 50);\n\n      return util.waitForUrl(baseUrl, 200);\n    });\n\n    it('fails if URL always returns 4xx', function() {\n      responseCode = 404;\n\n      return util.waitForUrl(baseUrl, 50)\n          .then(() => assert.fail('Expected to time out'),\n                () => true);\n    });\n\n    it('fails if cannot connect to server', function() {\n      return new Promise((resolve, reject) => {\n        killServer(function(e) {\n          if (e) return reject(e);\n\n          util.waitForUrl(baseUrl, 50).\n              then(function() { reject(Error('Expected to time out')); },\n                   function() { resolve(); });\n        });\n      });\n    });\n\n    it('can cancel wait', function() {\n      responseCode = 404;\n      let cancel = new Promise(resolve => {\n        setTimeout(_ => resolve(), 50);\n      });\n      return util.waitForUrl(baseUrl, 200, cancel)\n          .then(\n              () => { throw Error('Did not expect to succeed!'); },\n              (e) => assert.ok(e instanceof promise.CancellationError));\n    });\n  });\n});\n"]}