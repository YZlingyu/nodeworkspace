{"version":3,"sources":["promise_generator_test.js"],"names":[],"mappings":"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","file":"promise_generator_test-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n'use strict';\n\nconst assert = require('assert');\nconst promise = require('../../lib/promise');\nconst {enablePromiseManager, promiseManagerSuite} = require('../../lib/test/promise');\n\ndescribe('promise.consume()', function() {\n  promiseManagerSuite(() => {\n    it('requires inputs to be generator functions', function() {\n      assert.throws(function() {\n        promise.consume(function() {});\n      });\n    });\n\n    it('handles a basic generator with no yielded promises', function() {\n      var values = [];\n      return promise.consume(function* () {\n        var i = 0;\n        while (i < 4) {\n          i = yield i + 1;\n          values.push(i);\n        }\n      }).then(function() {\n        assert.deepEqual([1, 2, 3, 4], values);\n      });\n    });\n\n    it('handles a promise yielding generator', function() {\n      var values = [];\n      return promise.consume(function* () {\n        var i = 0;\n        while (i < 4) {\n          // Test that things are actually async here.\n          setTimeout(function() {\n            values.push(i * 2);\n          }, 10);\n\n          yield promise.delayed(10).then(function() {\n            values.push(i++);\n          });\n        }\n      }).then(function() {\n        assert.deepEqual([0, 0, 2, 1, 4, 2, 6, 3], values);\n      });\n    });\n\n    it('assignments to yielded promises get fulfilled value', function() {\n      return promise.consume(function* () {\n        let x = yield Promise.resolve(2);\n        assert.equal(2, x);\n      });\n    });\n\n    it('uses final return value as fulfillment value', function() {\n      return promise.consume(function* () {\n        yield 1;\n        yield 2;\n        return 3;\n      }).then(function(value) {\n        assert.equal(3, value);\n      });\n    });\n\n    it('throws rejected promise errors within the generator', function() {\n      var values = [];\n      return promise.consume(function* () {\n        values.push('a');\n        var e = Error('stub error');\n        try {\n          yield Promise.reject(e);\n          values.push('b');\n        } catch (ex) {\n          assert.equal(e, ex);\n          values.push('c');\n        }\n        values.push('d');\n      }).then(function() {\n        assert.deepEqual(['a', 'c', 'd'], values);\n      });\n    });\n\n    it('aborts the generator if there is an unhandled rejection', function() {\n      var values = [];\n      var e = Error('stub error');\n      return promise.consume(function* () {\n        values.push(1);\n        yield promise.rejected(e);\n        values.push(2);\n      }).catch(function() {\n        assert.deepEqual([1], values);\n      });\n    });\n\n    it('yield waits for promises', function() {\n      let values = [];\n      let blocker = promise.delayed(100).then(() => {\n        assert.deepEqual([1], values);\n        return 2;\n      });\n\n      return promise.consume(function* () {\n        values.push(1);\n        values.push(yield blocker, 3);\n      }).then(function() {\n        assert.deepEqual([1, 2, 3], values);\n      });\n    });\n\n    it('accepts custom scopes', function() {\n      return promise.consume(function* () {\n        return this.name;\n      }, {name: 'Bob'}).then(function(value) {\n        assert.equal('Bob', value);\n      });\n    });\n\n    it('accepts initial generator arguments', function() {\n      return promise.consume(function* (a, b) {\n        assert.equal('red', a);\n        assert.equal('apples', b);\n      }, null, 'red', 'apples');\n    });\n  });\n\n  enablePromiseManager(() =>  {\n    it('is possible to cancel promise generators', function() {\n      var values = [];\n      var p = promise.consume(function* () {\n        var i = 0;\n        while (i < 3) {\n          yield promise.delayed(100).then(function() {\n            values.push(i++);\n          });\n        }\n      });\n      return promise.delayed(75).then(function() {\n        p.cancel();\n        return p.catch(function() {\n          return promise.delayed(300);\n        });\n      }).then(function() {\n        assert.deepEqual([0], values);\n      });\n    });\n\n    it('executes generator within the control flow', function() {\n      var promises = [\n          promise.defer(),\n          promise.defer()\n      ];\n      var values = [];\n\n      setTimeout(function() {\n        assert.deepEqual([], values);\n        promises[0].fulfill(1);\n      }, 100);\n\n      setTimeout(function() {\n        assert.deepEqual([1], values);\n        promises[1].fulfill(2);\n      }, 200);\n\n      return promise.controlFlow().execute(function* () {\n        values.push(yield promises[0].promise);\n        values.push(yield promises[1].promise);\n        values.push('fin');\n      }).then(function() {\n        assert.deepEqual([1, 2, 'fin'], values);\n      });\n    });\n\n    it('handles tasks scheduled in generator', function() {\n      var flow = promise.controlFlow();\n      return flow.execute(function* () {\n        var x = yield flow.execute(function() {\n          return promise.delayed(10).then(function() {\n            return 1;\n          });\n        });\n\n        var y = yield flow.execute(function() {\n          return 2;\n        });\n\n        return x + y;\n      }).then(function(value) {\n        assert.equal(3, value);\n      });\n    });\n\n    it('blocks the control flow while processing generator', function() {\n      var values = [];\n      return promise.controlFlow().wait(function* () {\n        yield values.push(1);\n        values.push(yield promise.delayed(10).then(function() {\n          return 2;\n        }));\n        yield values.push(3);\n        return values.length === 6;\n      }, 250).then(function() {\n        assert.deepEqual([1, 2, 3, 1, 2, 3], values);\n      });\n    });\n\n    it('ControlFlow.wait() will timeout on long generator', function() {\n      var values = [];\n      return promise.controlFlow().wait(function* () {\n        var i = 0;\n        while (i < 3) {\n          yield promise.delayed(100).then(function() {\n            values.push(i++);\n          });\n        }\n      }, 75).catch(function() {\n        assert.deepEqual(\n            [0, 1, 2], values, 'Should complete one loop of wait condition');\n      });\n    });\n\n    describe('generators in promise callbacks', function() {\n      it('works with no initial value', function() {\n        var promises = [\n          promise.defer(),\n          promise.defer()\n        ];\n        var values = [];\n\n        setTimeout(function() {\n          promises[0].fulfill(1);\n        }, 50);\n\n        setTimeout(function() {\n          promises[1].fulfill(2);\n        }, 100);\n\n        return promise.fulfilled().then(function*() {\n          values.push(yield promises[0].promise);\n          values.push(yield promises[1].promise);\n          values.push('fin');\n        }).then(function() {\n          assert.deepEqual([1, 2, 'fin'], values);\n        });\n      });\n\n      it('starts the generator with promised value', function() {\n        var promises = [\n          promise.defer(),\n          promise.defer()\n        ];\n        var values = [];\n\n        setTimeout(function() {\n          promises[0].fulfill(1);\n        }, 50);\n\n        setTimeout(function() {\n          promises[1].fulfill(2);\n        }, 100);\n\n        return promise.fulfilled(3).then(function*(value) {\n          var p1 = yield promises[0].promise;\n          var p2 = yield promises[1].promise;\n          values.push(value + p1);\n          values.push(value + p2);\n          values.push('fin');\n        }).then(function() {\n          assert.deepEqual([4, 5, 'fin'], values);\n        });\n      });\n\n      it('throws yielded rejections within the generator callback', function() {\n        var d = promise.defer();\n        var e = Error('stub');\n\n        setTimeout(function() {\n          d.reject(e);\n        }, 50);\n\n        return promise.fulfilled().then(function*() {\n          var threw = false;\n          try {\n            yield d.promise;\n          } catch (ex) {\n            threw = true;\n            assert.equal(e, ex);\n          }\n          assert.ok(threw);\n        });\n      });\n    });\n  });\n});\n\n"]}