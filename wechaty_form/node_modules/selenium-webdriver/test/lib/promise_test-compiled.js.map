{"version":3,"sources":["promise_test.js"],"names":[],"mappings":"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","file":"promise_test-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n'use strict';\n\nconst assert = require('assert');\n\nconst testutil = require('./testutil');\nconst promise = require('../../lib/promise');\nconst {enablePromiseManager, promiseManagerSuite} = require('../../lib/test/promise');\n\n// Aliases for readability.\nconst NativePromise = Promise;\nconst StubError = testutil.StubError;\nconst assertIsStubError = testutil.assertIsStubError;\nconst callbackHelper = testutil.callbackHelper;\nconst callbackPair = testutil.callbackPair;\nconst throwStubError = testutil.throwStubError;\nconst fail = () => assert.fail();\n\n// Refer to promise_aplus_test for promise compliance with standard behavior.\ndescribe('promise', function() {\n  var app, uncaughtExceptions;\n\n  beforeEach(function setUp() {\n    if (promise.USE_PROMISE_MANAGER) {\n      promise.LONG_STACK_TRACES = false;\n      uncaughtExceptions = [];\n\n      app = promise.controlFlow();\n      app.on(promise.ControlFlow.EventType.UNCAUGHT_EXCEPTION,\n             (e) => uncaughtExceptions.push(e));\n    }\n  });\n\n  afterEach(function tearDown() {\n    if (promise.USE_PROMISE_MANAGER) {\n      app.reset();\n      promise.setDefaultFlow(new promise.ControlFlow);\n      assert.deepEqual([], uncaughtExceptions,\n          'Did not expect any uncaught exceptions');\n      promise.LONG_STACK_TRACES = false;\n    }\n  });\n\n  const assertIsPromise = (p) => assert.ok(promise.isPromise(p));\n  const assertNotPromise = (v) => assert.ok(!promise.isPromise(v));\n\n  function defer() {\n    let d = {};\n    let promise = new Promise((resolve, reject) => {\n      Object.assign(d, {resolve, reject});\n    });\n    d.promise = promise;\n    return d;\n  }\n\n  function createRejectedPromise(reason) {\n    var p = Promise.reject(reason);\n    p.catch(function() {});  // Silence unhandled rejection handlers.\n    return p;\n  }\n\n  enablePromiseManager(() => {\n    it('testCanDetectPromiseLikeObjects', function() {\n      assertIsPromise(new promise.Promise(function(fulfill) {\n        fulfill();\n      }));\n      assertIsPromise(new promise.Deferred().promise);\n      assertIsPromise(Promise.resolve(123));\n      assertIsPromise({then:function() {}});\n\n      assertNotPromise(new promise.Deferred());\n      assertNotPromise(undefined);\n      assertNotPromise(null);\n      assertNotPromise('');\n      assertNotPromise(true);\n      assertNotPromise(false);\n      assertNotPromise(1);\n      assertNotPromise({});\n      assertNotPromise({then:1});\n      assertNotPromise({then:true});\n      assertNotPromise({then:''});\n    });\n\n    describe('then', function() {\n      it('returnsOwnPromiseIfNoCallbacksWereGiven', function() {\n        var deferred = new promise.Deferred();\n        assert.equal(deferred.promise, deferred.promise.then());\n        assert.equal(deferred.promise, deferred.promise.catch());\n        assert.equal(deferred.promise, promise.when(deferred.promise));\n      });\n\n      it('stillConsideredUnHandledIfNoCallbacksWereGivenOnCallsToThen', function() {\n        promise.rejected(new StubError).then();\n        var handler = callbackHelper(assertIsStubError);\n\n        // so tearDown() doesn't throw\n        app.removeAllListeners();\n        app.on(promise.ControlFlow.EventType.UNCAUGHT_EXCEPTION, handler);\n        return NativePromise.resolve()\n            // Macro yield so the uncaught exception has a chance to trigger.\n            .then(() => new NativePromise(resolve => setTimeout(resolve, 0)))\n            .then(() => handler.assertCalled());\n      });\n    });\n\n    describe('finally', function() {\n      it('nonFailingCallbackDoesNotSuppressOriginalError', function() {\n        var done = callbackHelper(assertIsStubError);\n        return promise.rejected(new StubError).\n            finally(function() {}).\n            catch(done).\n            finally(done.assertCalled);\n      });\n\n      it('failingCallbackSuppressesOriginalError', function() {\n        var done = callbackHelper(assertIsStubError);\n        return promise.rejected(new Error('original')).\n            finally(throwStubError).\n            catch(done).\n            finally(done.assertCalled);\n      });\n\n      it('callbackThrowsAfterFulfilledPromise', function() {\n        var done = callbackHelper(assertIsStubError);\n        return promise.fulfilled().\n            finally(throwStubError).\n            catch(done).\n            finally(done.assertCalled);\n      });\n\n      it('callbackReturnsRejectedPromise', function() {\n        var done = callbackHelper(assertIsStubError);\n        return promise.fulfilled().\n            finally(function() {\n              return promise.rejected(new StubError);\n            }).\n            catch(done).\n            finally(done.assertCalled);\n      });\n    });\n\n    describe('cancel', function() {\n      it('passesTheCancellationReasonToReject', function() {\n        var d = new promise.Deferred();\n        var res = d.promise.then(assert.fail, function(e) {\n          assert.ok(e instanceof promise.CancellationError);\n          assert.equal('because i said so', e.message);\n        });\n        d.promise.cancel('because i said so');\n        return res;\n      });\n\n      describe('can cancel original promise from its child;', function() {\n        it('child created by then()', function() {\n          var d = new promise.Deferred();\n          var p = d.promise.then(assert.fail, function(e) {\n            assert.ok(e instanceof promise.CancellationError);\n            assert.equal('because i said so', e.message);\n            return 123;\n          });\n\n          p.cancel('because i said so');\n          return p.then(v => assert.equal(123, v));\n        });\n\n        it('child linked by resolving with parent', function() {\n          let parent = promise.defer();\n          let child = new promise.Promise(resolve => resolve(parent.promise));\n          child.cancel('all done');\n\n          return parent.promise.then(\n              () => assert.fail('expected a cancellation'),\n              e => {\n                assert.ok(e instanceof promise.CancellationError);\n                assert.equal('all done', e.message);\n              });\n        });\n\n        it('grand child through thenable chain', function() {\n          let p = new promise.Promise(function() {/* never resolve*/});\n\n          let noop = function() {};\n          let gc = p.then(noop).then(noop).then(noop);\n          gc.cancel('stop!');\n\n          return p.then(\n              () => assert.fail('expected to be cancelled'),\n              (e) => {\n                assert.ok(e instanceof promise.CancellationError);\n                assert.equal('stop!', e.message);\n              });\n        });\n\n        it('grand child through thenable chain started at resolve', function() {\n          function noop() {}\n\n          let parent = promise.defer();\n          let child = new promise.Promise(resolve => resolve(parent.promise));\n          let grandChild = child.then(noop).then(noop).then(noop);\n          grandChild.cancel('all done');\n\n          return parent.promise.then(\n              () => assert.fail('expected a cancellation'),\n              e => {\n                assert.ok(e instanceof promise.CancellationError);\n                assert.equal('all done', e.message);\n              });\n        });\n\n        it('\"parent\" is a CancellableThenable', function() {\n          function noop() {}\n\n          class FakeThenable {\n            constructor(p) {\n              this.promise = p;\n            }\n\n            cancel(reason) {\n              this.promise.cancel(reason);\n            }\n\n            then(cb, eb) {\n              let result = this.promise.then(cb, eb);\n              return new FakeThenable(result);\n            }\n          }\n          promise.CancellableThenable.addImplementation(FakeThenable);\n\n          let root = new promise.Promise(noop);\n          let thenable = new FakeThenable(root);\n          assert.ok(promise.Thenable.isImplementation(thenable));\n          assert.ok(promise.CancellableThenable.isImplementation(thenable));\n\n          let child = new promise.Promise(resolve => resolve(thenable));\n          assert.ok(child instanceof promise.Promise);\n          child.cancel('stop!');\n\n          function assertStopped(p) {\n            return p.then(\n                () => assert.fail('not stopped!'),\n                (e) => {\n                  assert.ok(e instanceof promise.CancellationError);\n                  assert.equal('stop!', e.message);\n                });\n          }\n\n          return assertStopped(child).then(() => assertStopped(root));\n        });\n      });\n\n      it('canCancelATimeout', function() {\n        var p = promise.delayed(25)\n            .then(assert.fail, (e) => e instanceof promise.CancellationError);\n        setTimeout(() => p.cancel(), 20);\n        p.cancel();\n        return p;\n      });\n\n      it('can cancel timeout from grandchild', function() {\n      });\n\n      it('cancelIsANoopOnceAPromiseHasBeenFulfilled', function() {\n        var p = promise.fulfilled(123);\n        p.cancel();\n        return p.then((v) => assert.equal(123, v));\n      });\n\n      it('cancelIsANoopOnceAPromiseHasBeenRejected', function() {\n        var p = promise.rejected(new StubError);\n        p.cancel();\n\n        var pair = callbackPair(null, assertIsStubError);\n        return p.then(assert.fail, assertIsStubError);\n      });\n\n      it('noopCancelTriggeredOnCallbackOfResolvedPromise', function() {\n        var d = promise.defer();\n        var p = d.promise.then();\n\n        d.fulfill();\n        p.cancel();  // This should not throw.\n        return p;    // This should not trigger a failure.\n      });\n    });\n  });\n\n  promiseManagerSuite(() => {\n    describe('fulfilled', function() {\n      it('returns input value if it is already a valid promise', function() {\n        let p = promise.createPromise(function() {});\n        let r = promise.fulfilled(p);\n        assert.strictEqual(p, r);\n      });\n\n      it('creates a new promise fulfilled with input', function() {\n        return promise.fulfilled(1234).then(v => assert.equal(1234, v));\n      });\n\n      it('can convert thenables to valid promise', function() {\n        let thenable = {then: function(cb) {cb(1234)}};\n        let p = promise.fulfilled(thenable);\n        assert.notStrictEqual(thenable, p);\n        return p.then(v => assert.equal(1234, v));\n      });\n    });\n\n    describe('when', function() {\n      it('ReturnsAResolvedPromiseIfGivenANonPromiseValue', function() {\n        var ret = promise.when('abc');\n        assertIsPromise(ret);\n        return ret.then((value) => assert.equal('abc', value));\n      });\n\n      it('PassesRawErrorsToCallbacks', function() {\n        var error = new Error('boo!');\n        return promise.when(error, function(value) {\n          assert.equal(error, value);\n        });\n      });\n\n      it('WaitsForValueToBeResolvedBeforeInvokingCallback', function() {\n        let d = defer();\n        let callback;\n        let result = promise.when(d.promise, callback = callbackHelper(function(value) {\n          assert.equal('hi', value);\n        }));\n        callback.assertNotCalled();\n        d.resolve('hi');\n        return result.then(callback.assertCalled);\n      });\n    });\n\n    describe('fullyResolved', function() {\n      it('primitives', function() {\n        function runTest(value) {\n          var callback, errback;\n          return promise.fullyResolved(value)\n              .then((resolved) => assert.equal(value, resolved));\n        }\n        return runTest(true)\n           .then(() => runTest(function() {}))\n           .then(() => runTest(null))\n           .then(() => runTest(123))\n           .then(() => runTest('foo bar'))\n           .then(() => runTest(undefined));\n      });\n\n      it('arrayOfPrimitives', function() {\n        var fn = function() {};\n        var array = [true, fn, null, 123, '', undefined, 1];\n        return promise.fullyResolved(array).then(function(resolved) {\n          assert.equal(array, resolved);\n          assert.deepEqual([true, fn, null, 123, '', undefined, 1],\n              resolved);\n        });\n      });\n\n      it('nestedArrayOfPrimitives', function() {\n        var fn = function() {};\n        var array = [true, [fn, null, 123], '', undefined];\n        return promise.fullyResolved(array)\n            .then(function(resolved) {\n              assert.equal(array, resolved);\n              assert.deepEqual([true, [fn, null, 123], '', undefined], resolved);\n              assert.deepEqual([fn, null, 123], resolved[1]);\n            });\n      });\n\n      it('arrayWithPromisedPrimitive', function() {\n        return promise.fullyResolved([Promise.resolve(123)])\n            .then(function(resolved) {\n              assert.deepEqual([123], resolved);\n            });\n      });\n\n      it('promiseResolvesToPrimitive', function() {\n        return promise.fullyResolved(Promise.resolve(123))\n            .then((resolved) => assert.equal(123, resolved));\n      });\n\n      it('promiseResolvesToArray', function() {\n        var fn = function() {};\n        var array = [true, [fn, null, 123], '', undefined];\n        var aPromise = Promise.resolve(array);\n\n        var result = promise.fullyResolved(aPromise);\n        return result.then(function(resolved) {\n          assert.equal(array, resolved);\n          assert.deepEqual([true, [fn, null, 123], '', undefined],\n              resolved);\n          assert.deepEqual([fn, null, 123], resolved[1]);\n        });\n      });\n\n      it('promiseResolvesToArrayWithPromises', function() {\n        var nestedPromise = Promise.resolve(123);\n        var aPromise = Promise.resolve([true, nestedPromise]);\n        return promise.fullyResolved(aPromise)\n            .then(function(resolved) {\n              assert.deepEqual([true, 123], resolved);\n            });\n      });\n\n      it('rejectsIfArrayPromiseRejects', function() {\n        var nestedPromise = createRejectedPromise(new StubError);\n        var aPromise = Promise.resolve([true, nestedPromise]);\n\n        var pair = callbackPair(null, assertIsStubError);\n        return promise.fullyResolved(aPromise)\n            .then(assert.fail, assertIsStubError);\n      });\n\n      it('rejectsOnFirstArrayRejection', function() {\n        var e1 = new Error('foo');\n        var e2 = new Error('bar');\n        var aPromise = Promise.resolve([\n          createRejectedPromise(e1),\n          createRejectedPromise(e2)\n        ]);\n\n        return promise.fullyResolved(aPromise)\n            .then(assert.fail, function(error) {\n              assert.strictEqual(e1, error);\n            });\n      });\n\n      it('rejectsIfNestedArrayPromiseRejects', function() {\n        var aPromise = Promise.resolve([\n          Promise.resolve([\n            createRejectedPromise(new StubError)\n          ])\n        ]);\n\n        return promise.fullyResolved(aPromise)\n            .then(assert.fail, assertIsStubError);\n      });\n\n      it('simpleHash', function() {\n        var hash = {'a': 123};\n        return promise.fullyResolved(hash)\n            .then(function(resolved) {\n              assert.strictEqual(hash, resolved);\n              assert.deepEqual(hash, {'a': 123});\n            });\n      });\n\n      it('nestedHash', function() {\n        var nestedHash = {'foo':'bar'};\n        var hash = {'a': 123, 'b': nestedHash};\n\n        return promise.fullyResolved(hash)\n            .then(function(resolved) {\n              assert.strictEqual(hash, resolved);\n              assert.deepEqual({'a': 123, 'b': {'foo': 'bar'}}, resolved);\n              assert.strictEqual(nestedHash, resolved['b']);\n            });\n      });\n\n      it('promiseResolvesToSimpleHash', function() {\n        var hash = {'a': 123};\n        var aPromise = Promise.resolve(hash);\n\n        return promise.fullyResolved(aPromise)\n            .then((resolved) => assert.strictEqual(hash, resolved));\n      });\n\n      it('promiseResolvesToNestedHash', function() {\n        var nestedHash = {'foo':'bar'};\n        var hash = {'a': 123, 'b': nestedHash};\n        var aPromise = Promise.resolve(hash);\n\n        return promise.fullyResolved(aPromise)\n            .then(function(resolved) {\n              assert.strictEqual(hash, resolved);\n              assert.strictEqual(nestedHash, resolved['b']);\n              assert.deepEqual(hash, {'a': 123, 'b': {'foo': 'bar'}});\n            });\n      });\n\n      it('promiseResolvesToHashWithPromises', function() {\n        var aPromise = Promise.resolve({\n            'a': Promise.resolve(123)\n        });\n\n        return promise.fullyResolved(aPromise)\n            .then(function(resolved) {\n              assert.deepEqual({'a': 123}, resolved);\n            });\n      });\n\n      it('rejectsIfHashPromiseRejects', function() {\n        var aPromise = Promise.resolve({\n            'a': createRejectedPromise(new StubError)\n        });\n\n        return promise.fullyResolved(aPromise)\n            .then(assert.fail, assertIsStubError);\n      });\n\n      it('rejectsIfNestedHashPromiseRejects', function() {\n        var aPromise = Promise.resolve({\n            'a': {'b': createRejectedPromise(new StubError)}\n        });\n\n        return promise.fullyResolved(aPromise)\n            .then(assert.fail, assertIsStubError);\n      });\n\n      it('instantiatedObject', function() {\n        function Foo() {\n          this.bar = 'baz';\n        }\n        var foo = new Foo;\n\n        return promise.fullyResolved(foo).then(function(resolvedFoo) {\n          assert.equal(foo, resolvedFoo);\n          assert.ok(resolvedFoo instanceof Foo);\n          assert.deepEqual(new Foo, resolvedFoo);\n        });\n      });\n\n      it('withEmptyArray', function() {\n        return promise.fullyResolved([]).then(function(resolved) {\n          assert.deepEqual([], resolved);\n        });\n      });\n\n      it('withEmptyHash', function() {\n        return promise.fullyResolved({}).then(function(resolved) {\n          assert.deepEqual({}, resolved);\n        });\n      });\n\n      it('arrayWithPromisedHash', function() {\n        var obj = {'foo': 'bar'};\n        var array = [Promise.resolve(obj)];\n\n        return promise.fullyResolved(array).then(function(resolved) {\n          assert.deepEqual(resolved, [obj]);\n        });\n      });\n    });\n\n    describe('checkedNodeCall', function() {\n      it('functionThrows', function() {\n        return promise.checkedNodeCall(throwStubError)\n            .then(assert.fail, assertIsStubError);\n      });\n\n      it('functionReturnsAnError', function() {\n        return promise.checkedNodeCall(function(callback) {\n          callback(new StubError);\n        }).then(assert.fail, assertIsStubError);\n      });\n\n      it('functionReturnsSuccess', function() {\n        var success = 'success!';\n        return promise.checkedNodeCall(function(callback) {\n          callback(null, success);\n        }).then((value) => assert.equal(success, value));\n      });\n\n      it('functionReturnsAndThrows', function() {\n        var error = new Error('boom');\n        var error2 = new Error('boom again');\n        return promise.checkedNodeCall(function(callback) {\n          callback(error);\n          throw error2;\n        }).then(assert.fail, (e) => assert.equal(error, e));\n      });\n\n      it('functionThrowsAndReturns', function() {\n        var error = new Error('boom');\n        var error2 = new Error('boom again');\n        return promise.checkedNodeCall(function(callback) {\n          setTimeout(() => callback(error), 10);\n          throw error2;\n        }).then(assert.fail, (e) => assert.equal(error2, e));\n      });\n    });\n\n    describe('all', function() {\n      it('(base case)', function() {\n        let deferredObjs = [defer(), defer()];\n        var a = [\n            0, 1,\n            deferredObjs[0].promise,\n            deferredObjs[1].promise,\n            4, 5, 6\n        ];\n        delete a[5];\n\n        var pair = callbackPair(function(value) {\n          assert.deepEqual([0, 1, 2, 3, 4, undefined, 6], value);\n        });\n\n        var result = promise.all(a).then(pair.callback, pair.errback);\n        pair.assertNeither();\n\n        deferredObjs[0].resolve(2);\n        pair.assertNeither();\n\n        deferredObjs[1].resolve(3);\n        return result.then(() => pair.assertCallback());\n      });\n\n      it('empty array', function() {\n        return promise.all([]).then((a) => assert.deepEqual([], a));\n      });\n\n      it('usesFirstRejection', function() {\n        let deferredObjs = [defer(), defer()];\n        let a = [deferredObjs[0].promise, deferredObjs[1].promise];\n\n        var result = promise.all(a).then(assert.fail, assertIsStubError);\n        deferredObjs[1].reject(new StubError);\n        setTimeout(() => deferredObjs[0].reject(Error('ignored')), 0);\n        return result;\n      });\n    });\n\n    describe('map', function() {\n      it('(base case)', function() {\n        var a = [1, 2, 3];\n        return promise.map(a, function(value, index, a2) {\n          assert.equal(a, a2);\n          assert.equal('number', typeof index, 'not a number');\n          return value + 1;\n        }).then(function(value) {\n          assert.deepEqual([2, 3, 4], value);\n        });\n      });\n\n      it('omitsDeleted', function() {\n        var a = [0, 1, 2, 3, 4, 5, 6];\n        delete a[1];\n        delete a[3];\n        delete a[4];\n        delete a[6];\n\n        var expected = [0, 1, 4, 9, 16, 25, 36];\n        delete expected[1];\n        delete expected[3];\n        delete expected[4];\n        delete expected[6];\n\n        return promise.map(a, function(value) {\n          return value * value;\n        }).then(function(value) {\n          assert.deepEqual(expected, value);\n        });\n      });\n\n      it('emptyArray', function() {\n        return promise.map([], function(value) {\n          return value + 1;\n        }).then(function(value) {\n          assert.deepEqual([], value);\n        });\n      });\n\n      it('inputIsPromise', function() {\n        var input = defer();\n        var result = promise.map(input.promise, function(value) {\n          return value + 1;\n        });\n\n        var pair = callbackPair(function(value) {\n          assert.deepEqual([2, 3, 4], value);\n        });\n        result = result.then(pair.callback, pair.errback);\n\n        setTimeout(function() {\n          pair.assertNeither();\n          input.resolve([1, 2, 3]);\n        }, 10);\n\n        return result;\n      });\n\n      it('waitsForFunctionResultToResolve', function() {\n        var innerResults = [\n          defer(),\n          defer()\n        ];\n\n        var result = promise.map([1, 2], function(value, index) {\n          return innerResults[index].promise;\n        });\n\n        var pair = callbackPair(function(value) {\n          assert.deepEqual(['a', 'b'], value);\n        });\n        result = result.then(pair.callback, pair.errback);\n\n        return NativePromise.resolve()\n            .then(function() {\n              pair.assertNeither();\n              innerResults[0].resolve('a');\n            })\n            .then(function() {\n              pair.assertNeither();\n              innerResults[1].resolve('b');\n              return result;\n            })\n            .then(pair.assertCallback);\n      });\n\n      it('rejectsPromiseIfFunctionThrows', function() {\n        return promise.map([1], throwStubError)\n            .then(assert.fail, assertIsStubError);\n      });\n\n      it('rejectsPromiseIfFunctionReturnsRejectedPromise', function() {\n        return promise.map([1], function() {\n          return createRejectedPromise(new StubError);\n        }).then(assert.fail, assertIsStubError);\n      });\n\n      it('stopsCallingFunctionIfPreviousIterationFailed', function() {\n        var count = 0;\n        return promise.map([1, 2, 3, 4], function() {\n          count++;\n          if (count == 3) {\n            throw new StubError;\n          }\n        }).then(assert.fail, function(e) {\n          assertIsStubError(e);\n          assert.equal(3, count);\n        });\n      });\n\n      it('rejectsWithFirstRejectedPromise', function() {\n        var innerResult = [\n            Promise.resolve(),\n            createRejectedPromise(new StubError),\n            createRejectedPromise(Error('should be ignored'))\n        ];\n        var count = 0;\n        return promise.map([1, 2, 3, 4], function(value, index) {\n          count += 1;\n          return innerResult[index];\n        }).then(assert.fail, function(e) {\n          assertIsStubError(e);\n          assert.equal(2, count);\n        });\n      });\n\n      it('preservesOrderWhenMapReturnsPromise', function() {\n        var deferreds = [\n          defer(),\n          defer(),\n          defer(),\n          defer()\n        ];\n        var result = promise.map(deferreds, function(value) {\n          return value.promise;\n        });\n\n        var pair = callbackPair(function(value) {\n          assert.deepEqual([0, 1, 2, 3], value);\n        });\n        result = result.then(pair.callback, pair.errback);\n\n        return Promise.resolve()\n            .then(function() {\n              pair.assertNeither();\n              for (let i = deferreds.length; i > 0; i -= 1) {\n                deferreds[i - 1].resolve(i - 1);\n              }\n              return result;\n            }).then(pair.assertCallback);\n      });\n    });\n\n    describe('filter', function() {\n      it('basicFiltering', function() {\n        var a = [0, 1, 2, 3];\n        return promise.filter(a, function(val, index, a2) {\n          assert.equal(a, a2);\n          assert.equal('number', typeof index, 'not a number');\n          return val > 1;\n        }).then(function(val) {\n          assert.deepEqual([2, 3], val);\n        });\n      });\n\n      it('omitsDeleted', function() {\n        var a = [0, 1, 2, 3, 4, 5, 6];\n        delete a[3];\n        delete a[4];\n\n        return promise.filter(a, function(value) {\n          return value > 1 && value < 6;\n        }).then(function(val) {\n          assert.deepEqual([2, 5], val);\n        });\n      });\n\n      it('preservesInputs', function() {\n        var a = [0, 1, 2, 3];\n\n        return promise.filter(a, function(value, i, a2) {\n          assert.equal(a, a2);\n          // Even if a function modifies the input array, the original value\n          // should be inserted into the new array.\n          a2[i] = a2[i] - 1;\n          return a2[i] >= 1;\n        }).then(function(val) {\n          assert.deepEqual([2, 3], val);\n        });\n      });\n\n      it('inputIsPromise', function() {\n        var input = defer();\n        var result = promise.filter(input.promise, function(value) {\n          return value > 1 && value < 3;\n        });\n\n        var pair = callbackPair(function(value) {\n          assert.deepEqual([2], value);\n        });\n        result = result.then(pair.callback, pair.errback);\n        return NativePromise.resolve()\n            .then(function() {\n              pair.assertNeither();\n              input.resolve([1, 2, 3]);\n              return result;\n            })\n            .then(pair.assertCallback);\n      });\n\n      it('waitsForFunctionResultToResolve', function() {\n        var innerResults = [\n          defer(),\n          defer()\n        ];\n\n        var result = promise.filter([1, 2], function(value, index) {\n          return innerResults[index].promise;\n        });\n\n        var pair = callbackPair(function(value) {\n          assert.deepEqual([2], value);\n        });\n        result = result.then(pair.callback, pair.errback);\n        return NativePromise.resolve()\n            .then(function() {\n              pair.assertNeither();\n              innerResults[0].resolve(false);\n            })\n            .then(function() {\n              pair.assertNeither();\n              innerResults[1].resolve(true);\n              return result;\n            })\n            .then(pair.assertCallback);\n      });\n\n      it('rejectsPromiseIfFunctionReturnsRejectedPromise', function() {\n        return promise.filter([1], function() {\n          return createRejectedPromise(new StubError);\n        }).then(assert.fail, assertIsStubError);\n      });\n\n      it('stopsCallingFunctionIfPreviousIterationFailed', function() {\n        var count = 0;\n        return promise.filter([1, 2, 3, 4], function() {\n          count++;\n          if (count == 3) {\n            throw new StubError;\n          }\n        }).then(assert.fail, function(e) {\n          assertIsStubError(e);\n          assert.equal(3, count);\n        });\n      });\n\n      it('rejectsWithFirstRejectedPromise', function() {\n        var innerResult = [\n          Promise.resolve(),\n          createRejectedPromise(new StubError),\n          createRejectedPromise(Error('should be ignored'))\n        ];\n\n        return promise.filter([1, 2, 3, 4], function(value, index) {\n          assert.ok(index < innerResult.length);\n          return innerResult[index];\n        }).then(assert.fail, assertIsStubError);\n      });\n\n      it('preservesOrderWhenFilterReturnsPromise', function() {\n        var deferreds = [\n          defer(),\n          defer(),\n          defer(),\n          defer()\n        ];\n        var result = promise.filter([0, 1, 2, 3], function(value, index) {\n          return deferreds[index].promise;\n        });\n\n        var pair = callbackPair(function(value) {\n          assert.deepEqual([1, 2], value);\n        });\n        result = result.then(pair.callback, pair.errback);\n\n        return NativePromise.resolve()\n            .then(function() {\n              pair.assertNeither();\n              for (let i = deferreds.length - 1; i >= 0; i -= 1) {\n                deferreds[i].resolve(i > 0 && i < 3);\n              }\n              return result;\n            }).then(pair.assertCallback);\n      });\n    });\n  });\n\n  enablePromiseManager(() => {\n    it('firesUncaughtExceptionEventIfRejectionNeverHandled', function() {\n      promise.rejected(new StubError);\n      var handler = callbackHelper(assertIsStubError);\n\n      // so tearDown() doesn't throw\n      app.removeAllListeners();\n      app.on(promise.ControlFlow.EventType.UNCAUGHT_EXCEPTION, handler);\n\n      return NativePromise.resolve()\n          // Macro yield so the uncaught exception has a chance to trigger.\n          .then(() => new NativePromise(resolve => setTimeout(resolve, 0)))\n          .then(handler.assertCalled);\n    });\n\n    it('cannotResolveADeferredWithItself', function() {\n      var deferred = new promise.Deferred();\n      assert.throws(() => deferred.fulfill(deferred));\n      assert.throws(() => deferred.reject(deferred));\n    });\n\n    describe('testLongStackTraces', function() {\n      beforeEach(() => promise.LONG_STACK_TRACES = false);\n      afterEach(() => promise.LONG_STACK_TRACES = false);\n\n      it('doesNotAppendStackIfFeatureDisabled', function() {\n        promise.LONG_STACK_TRACES = false;\n\n        var error = Error('hello');\n        var originalStack = error.stack;\n        return promise.rejected(error).\n            then(fail).\n            then(fail).\n            then(fail).\n            then(fail, function(e) {\n              assert.equal(error, e);\n              assert.equal(originalStack, e.stack);\n            });\n      });\n\n      function getStackMessages(error) {\n        return error.stack.split(/\\n/).filter(function(line) {\n          return /^From: /.test(line);\n        });\n      }\n\n      it('appendsInitialPromiseCreation_resolverThrows', function() {\n        promise.LONG_STACK_TRACES = true;\n\n        var error = Error('hello');\n        var originalStack = '(placeholder; will be overwritten later)';\n\n        return new promise.Promise(function() {\n          try {\n            throw error;\n          } catch (e) {\n            originalStack = e.stack;\n            throw e;\n          }\n        }).then(fail, function(e) {\n          assert.strictEqual(error, e);\n          if (typeof originalStack !== 'string') {\n            return;\n          }\n          assert.notEqual(originalStack, e.stack);\n          assert.equal(e.stack.indexOf(originalStack), 0,\n              'should start with original stack');\n          assert.deepEqual(['From: ManagedPromise: new'], getStackMessages(e));\n        });\n      });\n\n      it('appendsInitialPromiseCreation_rejectCalled', function() {\n        promise.LONG_STACK_TRACES = true;\n\n        var error = Error('hello');\n        var originalStack = error.stack;\n\n        return new promise.Promise(function(_, reject) {\n          reject(error);\n        }).then(fail, function(e) {\n          assert.equal(error, e);\n          if (typeof originalStack !== 'string') {\n            return;\n          }\n          assert.notEqual(originalStack, e.stack);\n          assert.equal(e.stack.indexOf(originalStack), 0,\n              'should start with original stack');\n          assert.deepEqual(['From: ManagedPromise: new'], getStackMessages(e));\n        });\n      });\n\n      it('appendsEachStepToRejectionError', function() {\n        promise.LONG_STACK_TRACES = true;\n\n        var error = Error('hello');\n        var originalStack = '(placeholder; will be overwritten later)';\n\n        return new promise.Promise(function() {\n          try {\n            throw error;\n          } catch (e) {\n            originalStack = e.stack;\n            throw e;\n          }\n        }).\n        then(fail).\n        catch(function(e) { throw e; }).\n        then(fail).\n        catch(function(e) { throw e; }).\n        then(fail, function(e) {\n          assert.equal(error, e);\n          if (typeof originalStack !== 'string') {\n            return;\n          }\n          assert.notEqual(originalStack, e.stack);\n          assert.equal(e.stack.indexOf(originalStack), 0,\n              'should start with original stack');\n          assert.deepEqual([\n            'From: ManagedPromise: new',\n            'From: Promise: then',\n            'From: Promise: catch',\n            'From: Promise: then',\n            'From: Promise: catch',\n          ], getStackMessages(e));\n        });\n      });\n\n      it('errorOccursInCallbackChain', function() {\n        promise.LONG_STACK_TRACES = true;\n\n        var error = Error('hello');\n        var originalStack = '(placeholder; will be overwritten later)';\n\n        return promise.fulfilled().\n            then(function() {}).\n            then(function() {}).\n            then(function() {\n              try {\n                throw error;\n              } catch (e) {\n                originalStack = e.stack;\n                throw e;\n              }\n            }).\n            catch(function(e) { throw e; }).\n            then(fail, function(e) {\n              assert.equal(error, e);\n              if (typeof originalStack !== 'string') {\n                return;\n              }\n              assert.notEqual(originalStack, e.stack);\n              assert.equal(e.stack.indexOf(originalStack), 0,\n                  'should start with original stack');\n              assert.deepEqual([\n                'From: Promise: then',\n                'From: Promise: catch',\n              ], getStackMessages(e));\n            });\n      });\n    });\n  });\n\n  it('testAddThenableImplementation', function() {\n    function tmp() {}\n    assert.ok(!promise.Thenable.isImplementation(new tmp()));\n    promise.Thenable.addImplementation(tmp);\n    assert.ok(promise.Thenable.isImplementation(new tmp()));\n\n    class tmpClass {}\n    assert.ok(!promise.Thenable.isImplementation(new tmpClass()));\n    promise.Thenable.addImplementation(tmpClass);\n    assert.ok(promise.Thenable.isImplementation(new tmpClass()));\n  });\n});\n"]}