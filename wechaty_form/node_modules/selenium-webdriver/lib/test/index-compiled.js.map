{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n'use strict';\n\nvar assert = require('assert');\n\nvar build = require('./build'),\n    isDevMode = require('../devmode'),\n    webdriver = require('../../'),\n    flow = webdriver.promise.controlFlow(),\n    firefox = require('../../firefox'),\n    logging = require('../../lib/logging'),\n    safari = require('../../safari'),\n    remote = require('../../remote'),\n    testing = require('../../testing'),\n    fileserver = require('./fileserver');\n\n\nconst LEGACY_FIREFOX = 'legacy-' + webdriver.Browser.FIREFOX;\n\n\n/**\n * Browsers with native support.\n * @type {!Array.<webdriver.Browser>}\n */\nvar NATIVE_BROWSERS = [\n  webdriver.Browser.CHROME,\n  webdriver.Browser.EDGE,\n  webdriver.Browser.FIREFOX,\n  LEGACY_FIREFOX,\n  webdriver.Browser.IE,\n  webdriver.Browser.OPERA,\n  webdriver.Browser.PHANTOM_JS,\n  webdriver.Browser.SAFARI\n];\n\n\nvar noBuild = /^1|true$/i.test(process.env['SELENIUM_NO_BUILD']);\nvar serverJar = process.env['SELENIUM_SERVER_JAR'];\nvar remoteUrl = process.env['SELENIUM_REMOTE_URL'];\nvar useLoopback = process.env['SELENIUM_USE_LOOP_BACK'] == '1';\nvar noMarionette = /^0|false$/i.test(process.env['SELENIUM_GECKODRIVER']);\nvar startServer = !!serverJar && !remoteUrl;\nvar nativeRun = !serverJar && !remoteUrl;\n\nif (/^1|true$/i.test(process.env['SELENIUM_VERBOSE'])) {\n  logging.installConsoleHandler();\n  logging.getLogger('webdriver.http').setLevel(logging.Level.ALL);\n}\n\nvar browsersToTest = (function() {\n  var permitRemoteBrowsers = !!remoteUrl || !!serverJar;\n  var permitUnknownBrowsers = !nativeRun;\n  var browsers = process.env['SELENIUM_BROWSER'] || webdriver.Browser.FIREFOX;\n\n  browsers = browsers.split(',').map(function(browser) {\n    var parts = browser.split(/:/);\n    if (parts[0] === 'ie') {\n      parts[0] = webdriver.Browser.IE;\n    }\n    if (parts[0] === 'edge') {\n      parts[0] = webdriver.Browser.EDGE;\n    }\n    if (noMarionette && parts[0] === webdriver.Browser.FIREFOX) {\n      parts[0] = LEGACY_FIREFOX;\n    }\n    return parts.join(':');\n  });\n\n  browsers.forEach(function(browser) {\n    var parts = browser.split(/:/, 3);\n    if (parts[0] === 'ie') {\n      parts[0] = webdriver.Browser.IE;\n    }\n\n    if (parts[0] === LEGACY_FIREFOX) {\n      return;\n    }\n\n    if (NATIVE_BROWSERS.indexOf(parts[0]) == -1 && !permitRemoteBrowsers) {\n      throw Error('Browser ' + parts[0] + ' requires a WebDriver server and ' +\n          'neither the SELENIUM_REMOTE_URL nor the SELENIUM_SERVER_JAR ' +\n          'environment variables have been set.');\n    }\n\n    var recognized = false;\n    for (var prop in webdriver.Browser) {\n      if (webdriver.Browser.hasOwnProperty(prop) &&\n          webdriver.Browser[prop] === parts[0]) {\n        recognized = true;\n        break;\n      }\n    }\n\n    if (!recognized && !permitUnknownBrowsers) {\n      throw Error('Unrecognized browser: ' + browser);\n    }\n  });\n\n  console.log('Running tests against [' + browsers.join(',') + ']');\n  if (remoteUrl) {\n    console.log('Using remote server ' + remoteUrl);\n  } else if (serverJar) {\n    console.log('Using standalone Selenium server ' + serverJar);\n    if (useLoopback) {\n      console.log('Running tests using loopback address')\n    }\n  }\n  console.log(\n      'Promise manager is enabled? ' + webdriver.promise.USE_PROMISE_MANAGER);\n\n  return browsers;\n})();\n\n\n/**\n * Creates a predicate function that ignores tests for specific browsers.\n * @param {string} currentBrowser The name of the current browser.\n * @param {!Array.<!Browser>} browsersToIgnore The browsers to ignore.\n * @return {function(): boolean} The predicate function.\n */\nfunction browsers(currentBrowser, browsersToIgnore) {\n  return function() {\n    return browsersToIgnore.indexOf(currentBrowser) != -1;\n  };\n}\n\n\n/**\n * @param {string} browserName The name to use.\n * @param {remote.DriverService} server The server to use, if any.\n * @constructor\n */\nfunction TestEnvironment(browserName, server) {\n  var name = browserName;\n\n  this.currentBrowser = function() {\n    return browserName;\n  };\n\n  this.isRemote = function() {\n    return server || remoteUrl;\n  };\n\n  this.isMarionette = function() {\n    return !noMarionette;\n  };\n\n  this.browsers = function(var_args) {\n    var browsersToIgnore = Array.prototype.slice.apply(arguments, [0]);\n    return browsers(browserName, browsersToIgnore);\n  };\n\n  this.builder = function() {\n    var builder = new webdriver.Builder();\n    var realBuild = builder.build;\n\n    builder.build = function() {\n      var parts = browserName.split(/:/, 3);\n\n      if (parts[0] === LEGACY_FIREFOX) {\n        var options = builder.getFirefoxOptions() || new firefox.Options();\n        options.useGeckoDriver(false);\n        builder.setFirefoxOptions(options);\n\n        parts[0] = webdriver.Browser.FIREFOX;\n      }\n\n      builder.forBrowser(parts[0], parts[1], parts[2]);\n      if (server) {\n        builder.usingServer(server.address());\n      } else if (remoteUrl) {\n        builder.usingServer(remoteUrl);\n      }\n\n      builder.disableEnvironmentOverrides();\n      return realBuild.call(builder);\n    };\n\n    return builder;\n  };\n}\n\n\nvar seleniumServer;\nvar inSuite = false;\n\n\n/**\n * Expands a function to cover each of the target browsers.\n * @param {function(!TestEnvironment)} fn The top level suite\n *     function.\n * @param {{browsers: !Array.<string>}=} opt_options Suite specific options.\n */\nfunction suite(fn, opt_options) {\n  assert.ok(!inSuite, 'You may not nest suite calls');\n  inSuite = true;\n\n  var suiteOptions = opt_options || {};\n  var browsers = suiteOptions.browsers;\n  if (browsers) {\n    // Filter out browser specific tests when that browser is not currently\n    // selected for testing.\n    browsers = browsers.filter(function(browser) {\n      return browsersToTest.indexOf(browser) != -1;\n    });\n  } else {\n    browsers = browsersToTest;\n  }\n\n  try {\n\n    before(function() {\n      if (isDevMode && !noBuild) {\n        return build.of(\n            '//javascript/atoms/fragments:is-displayed',\n            '//javascript/webdriver/atoms:getAttribute')\n            .onlyOnce().go();\n      }\n    });\n\n    // Server is only started if required for a specific config.\n    after(function() {\n      if (seleniumServer) {\n        return seleniumServer.stop();\n      }\n    });\n\n    browsers.forEach(function(browser) {\n      describe('[' + browser + ']', function() {\n\n        if (isDevMode && nativeRun) {\n          if (browser === LEGACY_FIREFOX) {\n            before(function() {\n              return build.of('//javascript/firefox-driver:webdriver')\n                  .onlyOnce().go();\n            });\n          }\n        }\n\n        var serverToUse = null;\n\n        if (!!serverJar && !remoteUrl) {\n          if (!(serverToUse = seleniumServer)) {\n            serverToUse = seleniumServer = new remote.SeleniumServer(\n                serverJar, {loopback: useLoopback});\n          }\n\n          before(function() {\n            this.timeout(0);\n            return seleniumServer.start(60 * 1000);\n          });\n        }\n        fn(new TestEnvironment(browser, serverToUse));\n      });\n    });\n  } finally {\n    inSuite = false;\n  }\n}\n\n\n// GLOBAL TEST SETUP\n\nbefore(function() {\n   // Do not pass register fileserver.start directly with testing.before,\n   // as start takes an optional port, which before assumes is an async\n   // callback.\n   return fileserver.start();\n});\n\nafter(function() {\n   return fileserver.stop();\n});\n\n// PUBLIC API\n\n\nexports.suite = suite;\nexports.after = testing.after;\nexports.afterEach = testing.afterEach;\nexports.before = testing.before;\nexports.beforeEach = testing.beforeEach;\nexports.it = testing.it;\nexports.ignore = testing.ignore;\n\nexports.Pages = fileserver.Pages;\nexports.whereIs = fileserver.whereIs;\n"]}