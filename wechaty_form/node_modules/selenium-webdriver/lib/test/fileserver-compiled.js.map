{"version":3,"sources":["fileserver.js"],"names":[],"mappings":"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","file":"fileserver-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n'use strict';\n\nvar fs = require('fs'),\n    http = require('http'),\n    path = require('path'),\n    url = require('url');\n\nvar express = require('express');\nvar multer = require('multer');\nvar serveIndex = require('serve-index');\n\nvar Server = require('./httpserver').Server,\n    resources = require('./resources'),\n    isDevMode = require('../devmode');\n\nvar WEB_ROOT = '/common';\nvar JS_ROOT = '/javascript';\n\nvar baseDirectory = resources.locate(isDevMode ? 'common/src/web' : '.');\nvar jsDirectory = resources.locate(isDevMode ? 'javascript' : '..');\n\nvar Pages = (function() {\n  var pages = {};\n  function addPage(page, path) {\n    pages.__defineGetter__(page, function() {\n      return exports.whereIs(path);\n    });\n  }\n\n  addPage('ajaxyPage', 'ajaxy_page.html');\n  addPage('alertsPage', 'alerts.html');\n  addPage('bodyTypingPage', 'bodyTypingTest.html');\n  addPage('booleanAttributes', 'booleanAttributes.html');\n  addPage('childPage', 'child/childPage.html');\n  addPage('chinesePage', 'cn-test.html');\n  addPage('clickJacker', 'click_jacker.html');\n  addPage('clickEventPage', 'clickEventPage.html');\n  addPage('clicksPage', 'clicks.html');\n  addPage('colorPage', 'colorPage.html');\n  addPage('deletingFrame', 'deletingFrame.htm');\n  addPage('draggableLists', 'draggableLists.html');\n  addPage('dragAndDropPage', 'dragAndDropTest.html');\n  addPage('droppableItems', 'droppableItems.html');\n  addPage('documentWrite', 'document_write_in_onload.html');\n  addPage('dynamicallyModifiedPage', 'dynamicallyModifiedPage.html');\n  addPage('dynamicPage', 'dynamic.html');\n  addPage('echoPage', 'echo');\n  addPage('errorsPage', 'errors.html');\n  addPage('xhtmlFormPage', 'xhtmlFormPage.xhtml');\n  addPage('formPage', 'formPage.html');\n  addPage('formSelectionPage', 'formSelectionPage.html');\n  addPage('framesetPage', 'frameset.html');\n  addPage('grandchildPage', 'child/grandchild/grandchildPage.html');\n  addPage('html5Page', 'html5Page.html');\n  addPage('html5OfflinePage', 'html5/offline.html');\n  addPage('iframePage', 'iframes.html');\n  addPage('javascriptEnhancedForm', 'javascriptEnhancedForm.html');\n  addPage('javascriptPage', 'javascriptPage.html');\n  addPage('linkedImage', 'linked_image.html');\n  addPage('longContentPage', 'longContentPage.html');\n  addPage('macbethPage', 'macbeth.html');\n  addPage('mapVisibilityPage', 'map_visibility.html');\n  addPage('metaRedirectPage', 'meta-redirect.html');\n  addPage('missedJsReferencePage', 'missedJsReference.html');\n  addPage('mouseTrackerPage', 'mousePositionTracker.html');\n  addPage('nestedPage', 'nestedElements.html');\n  addPage('readOnlyPage', 'readOnlyPage.html');\n  addPage('rectanglesPage', 'rectangles.html');\n  addPage('redirectPage', 'redirect');\n  addPage('resultPage', 'resultPage.html');\n  addPage('richTextPage', 'rich_text.html');\n  addPage('selectableItemsPage', 'selectableItems.html');\n  addPage('selectPage', 'selectPage.html');\n  addPage('simpleTestPage', 'simpleTest.html');\n  addPage('simpleXmlDocument', 'simple.xml');\n  addPage('sleepingPage', 'sleep');\n  addPage('slowIframes', 'slow_loading_iframes.html');\n  addPage('slowLoadingAlertPage', 'slowLoadingAlert.html');\n  addPage('svgPage', 'svgPiechart.xhtml');\n  addPage('tables', 'tables.html');\n  addPage('underscorePage', 'underscore.html');\n  addPage('unicodeLtrPage', 'utf8/unicode_ltr.html');\n  addPage('uploadPage', 'upload.html');\n  addPage('veryLargeCanvas', 'veryLargeCanvas.html');\n  addPage('xhtmlTestPage', 'xhtmlTest.html');\n\n  return pages;\n})();\n\n\nvar Path = {\n  BASIC_AUTH: WEB_ROOT + '/basicAuth',\n  ECHO: WEB_ROOT + '/echo',\n  GENERATED: WEB_ROOT + '/generated',\n  MANIFEST: WEB_ROOT + '/manifest',\n  REDIRECT: WEB_ROOT + '/redirect',\n  PAGE: WEB_ROOT + '/page',\n  SLEEP: WEB_ROOT + '/sleep',\n  UPLOAD: WEB_ROOT + '/upload'\n};\n\nvar app = express();\n\napp.get('/', sendIndex)\n.get('/favicon.ico', function(req, res) {\n  res.writeHead(204);\n  res.end();\n})\n.use(JS_ROOT, serveIndex(jsDirectory), express.static(jsDirectory))\n.post(Path.UPLOAD, handleUpload)\n.use(WEB_ROOT, serveIndex(baseDirectory), express.static(baseDirectory))\n.get(Path.ECHO, sendEcho)\n.get(Path.PAGE, sendInifinitePage)\n.get(Path.PAGE + '/*', sendInifinitePage)\n.get(Path.REDIRECT, redirectToResultPage)\n.get(Path.SLEEP, sendDelayedResponse)\n\nif (isDevMode) {\n  var closureDir = resources.locate('third_party/closure/goog');\n  app.use('/third_party/closure/goog',\n      serveIndex(closureDir), express.static(closureDir));\n}\nvar server = new Server(app);\n\n\nfunction redirectToResultPage(_, response) {\n  response.writeHead(303, {\n    Location: Pages.resultPage\n  });\n  return response.end();\n}\n\n\nfunction sendInifinitePage(request, response) {\n  var pathname = url.parse(request.url).pathname;\n  var lastIndex = pathname.lastIndexOf('/');\n  var pageNumber =\n      (lastIndex == -1 ? 'Unknown' : pathname.substring(lastIndex + 1));\n  var body = [\n    '<!DOCTYPE html>',\n    '<title>Page', pageNumber, '</title>',\n    'Page number <span id=\"pageNumber\">', pageNumber, '</span>',\n    '<p><a href=\"../xhtmlTest.html\" target=\"_top\">top</a>'\n  ].join('');\n  response.writeHead(200, {\n    'Content-Length': Buffer.byteLength(body, 'utf8'),\n    'Content-Type': 'text/html; charset=utf-8'\n  });\n  response.end(body);\n}\n\n\nfunction sendDelayedResponse(request, response) {\n  var duration = 0;\n  var query = url.parse(request.url).query || '';\n  var match = query.match(/\\btime=(\\d+)/);\n  if (match) {\n    duration = parseInt(match[1], 10);\n  }\n\n  setTimeout(function() {\n    var body = [\n      '<!DOCTYPE html>',\n      '<title>Done</title>',\n      '<body>Slept for ', duration, 's</body>'\n    ].join('');\n    response.writeHead(200, {\n      'Content-Length': Buffer.byteLength(body, 'utf8'),\n      'Content-Type': 'text/html; charset=utf-8',\n      'Cache-Control': 'no-cache',\n      'Pragma': 'no-cache',\n      'Expires': 0\n    });\n    response.end(body);\n  }, duration * 1000);\n}\n\n\nfunction handleUpload(request, response) {\n  let upload = multer({storage: multer.memoryStorage()}).any();\n  upload(request, response, function(err) {\n    if (err) {\n      response.writeHead(500);\n      response.end(err + '');\n    } else {\n      response.writeHead(200);\n      response.write(request.files[0].buffer);\n      response.end('<script>window.top.window.onUploadDone();</script>');\n    }\n  });\n}\n\n\nfunction sendEcho(request, response) {\n  var body = [\n    '<!DOCTYPE html>',\n    '<title>Echo</title>',\n    '<div class=\"request\">',\n    request.method, ' ', request.url, ' ', 'HTTP/', request.httpVersion,\n    '</div>'\n  ];\n  for (var name in request.headers) {\n    body.push('<div class=\"header ', name , '\">',\n        name, ': ', request.headers[name], '</div>');\n  }\n  body = body.join('');\n  response.writeHead(200, {\n    'Content-Length': Buffer.byteLength(body, 'utf8'),\n    'Content-Type': 'text/html; charset=utf-8'\n  });\n  response.end(body);\n}\n\n\n/**\n * Responds to a request for the file server's main index.\n * @param {!http.ServerRequest} request The request object.\n * @param {!http.ServerResponse} response The response object.\n */\nfunction sendIndex(request, response) {\n  var pathname = url.parse(request.url).pathname;\n\n  var host = request.headers.host;\n  if (!host) {\n    host = server.host();\n  }\n\n  var requestUrl = ['http://' + host + pathname].join('');\n\n  function createListEntry(path) {\n    var url = requestUrl + path;\n    return ['<li><a href=\"', url, '\">', path, '</a>'].join('');\n  }\n\n  var data = ['<!DOCTYPE html><h1>/</h1><hr/><ul>',\n              createListEntry('common')];\n  if (isDevMode) {\n    data.push(createListEntry('javascript'));\n  }\n  data.push('</ul>');\n  data = data.join('');\n\n  response.writeHead(200, {\n    'Content-Type': 'text/html; charset=UTF-8',\n    'Content-Length': Buffer.byteLength(data, 'utf8')\n  });\n  response.end(data);\n}\n\n\n// PUBLIC application\n\n\n/**\n * Starts the server on the specified port.\n * @param {number=} opt_port The port to use, or 0 for any free port.\n * @return {!Promise<Host>} A promise that will resolve\n *     with the server host when it has fully started.\n */\nexports.start = server.start.bind(server);\n\n\n/**\n * Stops the server.\n * @return {!Promise} A promise that will resolve when the\n *     server has closed all connections.\n */\nexports.stop = server.stop.bind(server);\n\n\n/**\n * Formats a URL for this server.\n * @param {string=} opt_pathname The desired pathname on the server.\n * @return {string} The formatted URL.\n * @throws {Error} If the server is not running.\n */\nexports.url = server.url.bind(server);\n\n\n/**\n * Builds the URL for a file in the //common/src/web directory of the\n * Selenium client.\n * @param {string} filePath A path relative to //common/src/web to compute a\n *     URL for.\n * @return {string} The formatted URL.\n * @throws {Error} If the server is not running.\n */\nexports.whereIs = function(filePath) {\n  filePath = filePath.replace(/\\\\/g, '/');\n  if (!filePath.startsWith('/')) {\n    filePath = '/' + filePath;\n  }\n  return server.url(WEB_ROOT + filePath);\n};\n\n\nexports.Pages = Pages;\n\n\nif (require.main === module) {\n  server.start(2310).then(function() {\n    console.log('Server running at ' + server.url());\n  });\n}\n"]}