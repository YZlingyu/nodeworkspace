{"version":3,"sources":["http.js"],"names":[],"mappings":"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","file":"http-compiled.js","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n/**\n * @fileoverview Defines an environment agnostic {@linkplain cmd.Executor\n * command executor} that communicates with a remote end using JSON over HTTP.\n *\n * Clients should implement the {@link Client} interface, which is used by\n * the {@link Executor} to send commands to the remote end.\n */\n\n'use strict';\n\nconst cmd = require('./command');\nconst error = require('./error');\nconst logging = require('./logging');\nconst promise = require('./promise');\nconst Session = require('./session').Session;\nconst WebElement = require('./webdriver').WebElement;\n\nconst {getAttribute, isDisplayed} = (function() {\n  try {\n    return {\n      getAttribute: require('./atoms/getAttribute.js'),\n      isDisplayed: require('./atoms/is-displayed.js')\n    };\n  } catch (ex) {\n    throw Error(\n        'Failed to import atoms modules. If running in devmode, you need to run'\n            + ' `./go node:atoms` from the project root: ' + ex);\n  }\n})();\n\n\n/**\n * Converts a headers map to a HTTP header block string.\n * @param {!Map<string, string>} headers The map to convert.\n * @return {string} The headers as a string.\n */\nfunction headersToString(headers) {\n  let ret = [];\n  headers.forEach(function(value, name) {\n    ret.push(`${name.toLowerCase()}: ${value}`);\n  });\n  return ret.join('\\n');\n}\n\n\n/**\n * Represents a HTTP request message. This class is a \"partial\" request and only\n * defines the path on the server to send a request to. It is each client's\n * responsibility to build the full URL for the final request.\n * @final\n */\nclass Request {\n  /**\n   * @param {string} method The HTTP method to use for the request.\n   * @param {string} path The path on the server to send the request to.\n   * @param {Object=} opt_data This request's non-serialized JSON payload data.\n   */\n  constructor(method, path, opt_data) {\n    this.method = /** string */method;\n    this.path = /** string */path;\n    this.data = /** Object */opt_data;\n    this.headers = /** !Map<string, string> */new Map(\n        [['Accept', 'application/json; charset=utf-8']]);\n  }\n\n  /** @override */\n  toString() {\n    let ret = `${this.method} ${this.path} HTTP/1.1\\n`;\n    ret += headersToString(this.headers) + '\\n\\n';\n    if (this.data) {\n      ret += JSON.stringify(this.data);\n    }\n    return ret;\n  }\n}\n\n\n/**\n * Represents a HTTP response message.\n * @final\n */\nclass Response {\n  /**\n   * @param {number} status The response code.\n   * @param {!Object<string>} headers The response headers. All header names\n   *     will be converted to lowercase strings for consistent lookups.\n   * @param {string} body The response body.\n   */\n  constructor(status, headers, body) {\n    this.status = /** number */status;\n    this.body = /** string */body;\n    this.headers = /** !Map<string, string>*/new Map;\n    for (let header in headers) {\n      this.headers.set(header.toLowerCase(), headers[header]);\n    }\n  }\n\n  /** @override */\n  toString() {\n    let ret = `HTTP/1.1 ${this.status}\\n${headersToString(this.headers)}\\n\\n`;\n    if (this.body) {\n      ret += this.body;\n    }\n    return ret;\n  }\n}\n\n\nconst DEV_ROOT = '../../../../buck-out/gen/javascript/';\n\n/** @enum {!Function} */\nconst Atom = {\n  GET_ATTRIBUTE: getAttribute,\n  IS_DISPLAYED: isDisplayed\n};\n\n\nconst LOG = logging.getLogger('webdriver.http');\n\n\nfunction post(path) { return resource('POST', path); }\nfunction del(path)  { return resource('DELETE', path); }\nfunction get(path)  { return resource('GET', path); }\nfunction resource(method, path) { return {method: method, path: path}; }\n\n\n/** @typedef {{method: string, path: string}} */\nvar CommandSpec;\n\n\n/** @typedef {function(!cmd.Command): !Promise<!cmd.Command>} */\nvar CommandTransformer;\n\n\nclass InternalTypeError extends TypeError {}\n\n\n/**\n * @param {!cmd.Command} command The initial command.\n * @param {Atom} atom The name of the atom to execute.\n * @return {!Promise<!cmd.Command>} The transformed command to execute.\n */\nfunction toExecuteAtomCommand(command, atom, ...params) {\n  return new Promise((resolve, reject) => {\n    if (typeof atom !== 'function') {\n      reject(new InternalTypeError('atom is not a function: ' + typeof atom));\n      return;\n    }\n\n    let newCmd = new cmd.Command(cmd.Name.EXECUTE_SCRIPT)\n        .setParameter('sessionId', command.getParameter('sessionId'))\n        .setParameter('script', `return (${atom}).apply(null, arguments)`)\n        .setParameter('args', params.map(param => command.getParameter(param)));\n    resolve(newCmd);\n  });\n}\n\n\n\n/** @const {!Map<string, CommandSpec>} */\nconst COMMAND_MAP = new Map([\n    [cmd.Name.GET_SERVER_STATUS, get('/status')],\n    [cmd.Name.NEW_SESSION, post('/session')],\n    [cmd.Name.GET_SESSIONS, get('/sessions')],\n    [cmd.Name.DESCRIBE_SESSION, get('/session/:sessionId')],\n    [cmd.Name.QUIT, del('/session/:sessionId')],\n    [cmd.Name.CLOSE, del('/session/:sessionId/window')],\n    [cmd.Name.GET_CURRENT_WINDOW_HANDLE, get('/session/:sessionId/window_handle')],\n    [cmd.Name.GET_WINDOW_HANDLES, get('/session/:sessionId/window_handles')],\n    [cmd.Name.GET_CURRENT_URL, get('/session/:sessionId/url')],\n    [cmd.Name.GET, post('/session/:sessionId/url')],\n    [cmd.Name.GO_BACK, post('/session/:sessionId/back')],\n    [cmd.Name.GO_FORWARD, post('/session/:sessionId/forward')],\n    [cmd.Name.REFRESH, post('/session/:sessionId/refresh')],\n    [cmd.Name.ADD_COOKIE, post('/session/:sessionId/cookie')],\n    [cmd.Name.GET_ALL_COOKIES, get('/session/:sessionId/cookie')],\n    [cmd.Name.DELETE_ALL_COOKIES, del('/session/:sessionId/cookie')],\n    [cmd.Name.DELETE_COOKIE, del('/session/:sessionId/cookie/:name')],\n    [cmd.Name.FIND_ELEMENT, post('/session/:sessionId/element')],\n    [cmd.Name.FIND_ELEMENTS, post('/session/:sessionId/elements')],\n    [cmd.Name.GET_ACTIVE_ELEMENT, post('/session/:sessionId/element/active')],\n    [cmd.Name.FIND_CHILD_ELEMENT, post('/session/:sessionId/element/:id/element')],\n    [cmd.Name.FIND_CHILD_ELEMENTS, post('/session/:sessionId/element/:id/elements')],\n    [cmd.Name.CLEAR_ELEMENT, post('/session/:sessionId/element/:id/clear')],\n    [cmd.Name.CLICK_ELEMENT, post('/session/:sessionId/element/:id/click')],\n    [cmd.Name.SEND_KEYS_TO_ELEMENT, post('/session/:sessionId/element/:id/value')],\n    [cmd.Name.SUBMIT_ELEMENT, post('/session/:sessionId/element/:id/submit')],\n    [cmd.Name.GET_ELEMENT_TEXT, get('/session/:sessionId/element/:id/text')],\n    [cmd.Name.GET_ELEMENT_TAG_NAME, get('/session/:sessionId/element/:id/name')],\n    [cmd.Name.IS_ELEMENT_SELECTED, get('/session/:sessionId/element/:id/selected')],\n    [cmd.Name.IS_ELEMENT_ENABLED, get('/session/:sessionId/element/:id/enabled')],\n    [cmd.Name.IS_ELEMENT_DISPLAYED, get('/session/:sessionId/element/:id/displayed')],\n    [cmd.Name.GET_ELEMENT_LOCATION, get('/session/:sessionId/element/:id/location')],\n    [cmd.Name.GET_ELEMENT_SIZE, get('/session/:sessionId/element/:id/size')],\n    [cmd.Name.GET_ELEMENT_ATTRIBUTE, get('/session/:sessionId/element/:id/attribute/:name')],\n    [cmd.Name.GET_ELEMENT_VALUE_OF_CSS_PROPERTY, get('/session/:sessionId/element/:id/css/:propertyName')],\n    [cmd.Name.ELEMENT_EQUALS, get('/session/:sessionId/element/:id/equals/:other')],\n    [cmd.Name.TAKE_ELEMENT_SCREENSHOT, get('/session/:sessionId/element/:id/screenshot')],\n    [cmd.Name.SWITCH_TO_WINDOW, post('/session/:sessionId/window')],\n    [cmd.Name.MAXIMIZE_WINDOW, post('/session/:sessionId/window/current/maximize')],\n    [cmd.Name.GET_WINDOW_POSITION, get('/session/:sessionId/window/current/position')],\n    [cmd.Name.SET_WINDOW_POSITION, post('/session/:sessionId/window/current/position')],\n    [cmd.Name.GET_WINDOW_SIZE, get('/session/:sessionId/window/current/size')],\n    [cmd.Name.SET_WINDOW_SIZE, post('/session/:sessionId/window/current/size')],\n    [cmd.Name.SWITCH_TO_FRAME, post('/session/:sessionId/frame')],\n    [cmd.Name.GET_PAGE_SOURCE, get('/session/:sessionId/source')],\n    [cmd.Name.GET_TITLE, get('/session/:sessionId/title')],\n    [cmd.Name.EXECUTE_SCRIPT, post('/session/:sessionId/execute')],\n    [cmd.Name.EXECUTE_ASYNC_SCRIPT, post('/session/:sessionId/execute_async')],\n    [cmd.Name.SCREENSHOT, get('/session/:sessionId/screenshot')],\n    [cmd.Name.GET_TIMEOUT, get('/session/:sessionId/timeouts')],\n    [cmd.Name.SET_TIMEOUT, post('/session/:sessionId/timeouts')],\n    [cmd.Name.MOVE_TO, post('/session/:sessionId/moveto')],\n    [cmd.Name.CLICK, post('/session/:sessionId/click')],\n    [cmd.Name.DOUBLE_CLICK, post('/session/:sessionId/doubleclick')],\n    [cmd.Name.MOUSE_DOWN, post('/session/:sessionId/buttondown')],\n    [cmd.Name.MOUSE_UP, post('/session/:sessionId/buttonup')],\n    [cmd.Name.MOVE_TO, post('/session/:sessionId/moveto')],\n    [cmd.Name.SEND_KEYS_TO_ACTIVE_ELEMENT, post('/session/:sessionId/keys')],\n    [cmd.Name.TOUCH_SINGLE_TAP, post('/session/:sessionId/touch/click')],\n    [cmd.Name.TOUCH_DOUBLE_TAP, post('/session/:sessionId/touch/doubleclick')],\n    [cmd.Name.TOUCH_DOWN, post('/session/:sessionId/touch/down')],\n    [cmd.Name.TOUCH_UP, post('/session/:sessionId/touch/up')],\n    [cmd.Name.TOUCH_MOVE, post('/session/:sessionId/touch/move')],\n    [cmd.Name.TOUCH_SCROLL, post('/session/:sessionId/touch/scroll')],\n    [cmd.Name.TOUCH_LONG_PRESS, post('/session/:sessionId/touch/longclick')],\n    [cmd.Name.TOUCH_FLICK, post('/session/:sessionId/touch/flick')],\n    [cmd.Name.ACCEPT_ALERT, post('/session/:sessionId/accept_alert')],\n    [cmd.Name.DISMISS_ALERT, post('/session/:sessionId/dismiss_alert')],\n    [cmd.Name.GET_ALERT_TEXT, get('/session/:sessionId/alert_text')],\n    [cmd.Name.SET_ALERT_TEXT, post('/session/:sessionId/alert_text')],\n    [cmd.Name.SET_ALERT_CREDENTIALS, post('/session/:sessionId/alert/credentials')],\n    [cmd.Name.GET_LOG, post('/session/:sessionId/log')],\n    [cmd.Name.GET_AVAILABLE_LOG_TYPES, get('/session/:sessionId/log/types')],\n    [cmd.Name.GET_SESSION_LOGS, post('/logs')],\n    [cmd.Name.UPLOAD_FILE, post('/session/:sessionId/file')],\n]);\n\n\n/** @const {!Map<string, (CommandSpec|CommandTransformer)>} */\nconst W3C_COMMAND_MAP = new Map([\n  [cmd.Name.GET_ACTIVE_ELEMENT, get('/session/:sessionId/element/active')],\n  [cmd.Name.GET_ALERT_TEXT, get('/session/:sessionId/alert/text')],\n  [cmd.Name.SET_ALERT_TEXT, post('/session/:sessionId/alert/text')],\n  [cmd.Name.ACCEPT_ALERT, post('/session/:sessionId/alert/accept')],\n  [cmd.Name.DISMISS_ALERT, post('/session/:sessionId/alert/dismiss')],\n  [cmd.Name.GET_ELEMENT_ATTRIBUTE, (cmd) => {\n    return toExecuteAtomCommand(cmd, Atom.GET_ATTRIBUTE, 'id', 'name');\n  }],\n  [cmd.Name.GET_ELEMENT_LOCATION, get('/session/:sessionId/element/:id/rect')],\n  [cmd.Name.GET_ELEMENT_SIZE, get('/session/:sessionId/element/:id/rect')],\n  [cmd.Name.IS_ELEMENT_DISPLAYED, (cmd) => {\n    return toExecuteAtomCommand(cmd, Atom.IS_DISPLAYED, 'id');\n  }],\n  [cmd.Name.EXECUTE_SCRIPT, post('/session/:sessionId/execute/sync')],\n  [cmd.Name.EXECUTE_ASYNC_SCRIPT, post('/session/:sessionId/execute/async')],\n  [cmd.Name.MAXIMIZE_WINDOW, post('/session/:sessionId/window/maximize')],\n  [cmd.Name.GET_WINDOW_POSITION, get('/session/:sessionId/window/position')],\n  [cmd.Name.SET_WINDOW_POSITION, post('/session/:sessionId/window/position')],\n  [cmd.Name.GET_WINDOW_SIZE, get('/session/:sessionId/window/size')],\n  [cmd.Name.SET_WINDOW_SIZE, post('/session/:sessionId/window/size')],\n  [cmd.Name.GET_CURRENT_WINDOW_HANDLE, get('/session/:sessionId/window')],\n  [cmd.Name.GET_WINDOW_HANDLES, get('/session/:sessionId/window/handles')],\n]);\n\n\n/**\n * Handles sending HTTP messages to a remote end.\n *\n * @interface\n */\nclass Client {\n\n  /**\n   * Sends a request to the server. The client will automatically follow any\n   * redirects returned by the server, fulfilling the returned promise with the\n   * final response.\n   *\n   * @param {!Request} httpRequest The request to send.\n   * @return {!Promise<Response>} A promise that will be fulfilled with the\n   *     server's response.\n   */\n  send(httpRequest) {}\n}\n\n\nconst CLIENTS =\n    /** !WeakMap<!Executor, !(Client|IThenable<!Client>)> */new WeakMap;\n\n\n/**\n * Sends a request using the given executor.\n * @param {!Executor} executor\n * @param {!Request} request\n * @return {!Promise<Response>}\n */\nfunction doSend(executor, request) {\n  const client = CLIENTS.get(executor);\n  if (promise.isPromise(client)) {\n    return client.then(client => {\n      CLIENTS.set(executor, client);\n      return client.send(request);\n    });\n  } else {\n    return client.send(request);\n  }\n}\n\n\n/**\n * @param {Map<string, CommandSpec>} customCommands\n *     A map of custom command definitions.\n * @param {boolean} w3c Whether to use W3C command mappings.\n * @param {!cmd.Command} command The command to resolve.\n * @return {!Promise<!Request>} A promise that will resolve with the\n *     command to execute.\n */\nfunction buildRequest(customCommands, w3c, command) {\n  LOG.finest(() => `Translating command: ${command.getName()}`);\n  let spec = customCommands && customCommands.get(command.getName());\n  if (spec) {\n    return toHttpRequest(spec);\n  }\n\n  if (w3c) {\n    spec = W3C_COMMAND_MAP.get(command.getName());\n    if (typeof spec === 'function') {\n      LOG.finest(() => `Transforming command for W3C: ${command.getName()}`);\n      return spec(command)\n          .then(newCommand => buildRequest(customCommands, w3c, newCommand));\n    } else if (spec) {\n      return toHttpRequest(spec);\n    }\n  }\n\n  spec = COMMAND_MAP.get(command.getName());\n  if (spec) {\n    return toHttpRequest(spec);\n  }\n  return Promise.reject(\n      new error.UnknownCommandError(\n          'Unrecognized command: ' + command.getName()));\n\n  /**\n   * @param {CommandSpec} resource\n   * @return {!Promise<!Request>}\n   */\n  function toHttpRequest(resource) {\n    LOG.finest(() => `Building HTTP request: ${JSON.stringify(resource)}`);\n    let parameters = command.getParameters();\n    let path = buildPath(resource.path, parameters);\n    return Promise.resolve(new Request(resource.method, path, parameters));\n  }\n}\n\n\n/**\n * A command executor that communicates with the server using JSON over HTTP.\n *\n * By default, each instance of this class will use the legacy wire protocol\n * from [Selenium project][json]. The executor will automatically switch to the\n * [W3C wire protocol][w3c] if the remote end returns a compliant response to\n * a new session command.\n *\n * [json]: https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol\n * [w3c]: https://w3c.github.io/webdriver/webdriver-spec.html\n *\n * @implements {cmd.Executor}\n */\nclass Executor {\n  /**\n   * @param {!(Client|IThenable<!Client>)} client The client to use for sending\n   *     requests to the server, or a promise-like object that will resolve to\n   *     to the client.\n   */\n  constructor(client) {\n    CLIENTS.set(this, client);\n\n    /**\n     * Whether this executor should use the W3C wire protocol. The executor\n     * will automatically switch if the remote end sends a compliant response\n     * to a new session command, however, this property may be directly set to\n     * `true` to force the executor into W3C mode.\n     * @type {boolean}\n     */\n    this.w3c = false;\n\n    /** @private {Map<string, CommandSpec>} */\n    this.customCommands_ = null;\n\n    /** @private {!logging.Logger} */\n    this.log_ = logging.getLogger('webdriver.http.Executor');\n  }\n\n  /**\n   * Defines a new command for use with this executor. When a command is sent,\n   * the {@code path} will be preprocessed using the command's parameters; any\n   * path segments prefixed with \":\" will be replaced by the parameter of the\n   * same name. For example, given \"/person/:name\" and the parameters\n   * \"{name: 'Bob'}\", the final command path will be \"/person/Bob\".\n   *\n   * @param {string} name The command name.\n   * @param {string} method The HTTP method to use when sending this command.\n   * @param {string} path The path to send the command to, relative to\n   *     the WebDriver server's command root and of the form\n   *     \"/path/:variable/segment\".\n   */\n  defineCommand(name, method, path) {\n    if (!this.customCommands_) {\n      this.customCommands_ = new Map;\n    }\n    this.customCommands_.set(name, {method, path});\n  }\n\n  /** @override */\n  execute(command) {\n    let request = buildRequest(this.customCommands_, this.w3c, command);\n    return request.then(request => {\n      this.log_.finer(() => `>>> ${request.method} ${request.path}`);\n      return doSend(this, request).then(response => {\n        this.log_.finer(() => `>>>\\n${request}\\n<<<\\n${response}`);\n\n        let httpResponse = /** @type {!Response} */(response);\n        let {isW3C, value} = parseHttpResponse(command, httpResponse);\n\n        if (command.getName() === cmd.Name.NEW_SESSION\n            || command.getName() === cmd.Name.DESCRIBE_SESSION) {\n          if (!value || !value.sessionId) {\n            throw new error.WebDriverError(\n                `Unable to parse new session response: ${response.body}`);\n          }\n\n          // The remote end is a W3C compliant server if there is no `status`\n          // field in the response. This is not applicable for the DESCRIBE_SESSION\n          // command, which is not defined in the W3C spec.\n          if (command.getName() === cmd.Name.NEW_SESSION) {\n            this.w3c = this.w3c || isW3C;\n          }\n\n          // No implementations use the `capabilities` key yet...\n          let capabilities = value.capabilities || value.value;\n          return new Session(value.sessionId, capabilities);\n        }\n\n        return typeof value === 'undefined' ? null : value;\n      });\n    });\n  }\n}\n\n\n/**\n * @param {string} str .\n * @return {?} .\n */\nfunction tryParse(str) {\n  try {\n    return JSON.parse(str);\n  } catch (ignored) {\n    // Do nothing.\n  }\n}\n\n\n/**\n * Callback used to parse {@link Response} objects from a\n * {@link HttpClient}.\n *\n * @param {!cmd.Command} command The command the response is for.\n * @param {!Response} httpResponse The HTTP response to parse.\n * @return {{isW3C: boolean, value: ?}} An object describing the parsed\n *     response. This object will have two fields: `isW3C` indicates whether\n *     the response looks like it came from a remote end that conforms with the\n *     W3C WebDriver spec, and `value`, the actual response value.\n * @throws {WebDriverError} If the HTTP response is an error.\n */\nfunction parseHttpResponse(command, httpResponse) {\n  if (httpResponse.status < 200) {\n    // This should never happen, but throw the raw response so users report it.\n    throw new error.WebDriverError(\n        `Unexpected HTTP response:\\n${httpResponse}`);\n  }\n\n  let parsed = tryParse(httpResponse.body);\n  if (parsed && typeof parsed === 'object') {\n    let value = parsed.value;\n    let isW3C =\n        value !== null && typeof value === 'object'\n            && typeof parsed.status === 'undefined';\n\n    if (!isW3C) {\n      error.checkLegacyResponse(parsed);\n\n      // Adjust legacy new session responses to look like W3C to simplify\n      // later processing.\n      if (command.getName() === cmd.Name.NEW_SESSION\n          || command.getName() == cmd.Name.DESCRIBE_SESSION) {\n        value = parsed;\n      }\n\n    } else if (httpResponse.status > 399) {\n      error.throwDecodedError(value);\n    }\n\n    return {isW3C, value};\n  }\n\n  if (parsed !== undefined) {\n    return {isW3C: false, value: parsed};\n  }\n\n  let value = httpResponse.body.replace(/\\r\\n/g, '\\n');\n\n  // 404 represents an unknown command; anything else > 399 is a generic unknown\n  // error.\n  if (httpResponse.status == 404) {\n    throw new error.UnsupportedOperationError(value);\n  } else if (httpResponse.status >= 400) {\n    throw new error.WebDriverError(value);\n  }\n\n  return {isW3C: false, value: value || null};\n}\n\n\n/**\n * Builds a fully qualified path using the given set of command parameters. Each\n * path segment prefixed with ':' will be replaced by the value of the\n * corresponding parameter. All parameters spliced into the path will be\n * removed from the parameter map.\n * @param {string} path The original resource path.\n * @param {!Object<*>} parameters The parameters object to splice into the path.\n * @return {string} The modified path.\n */\nfunction buildPath(path, parameters) {\n  let pathParameters = path.match(/\\/:(\\w+)\\b/g);\n  if (pathParameters) {\n    for (let i = 0; i < pathParameters.length; ++i) {\n      let key = pathParameters[i].substring(2);  // Trim the /:\n      if (key in parameters) {\n        let value = parameters[key];\n        if (WebElement.isId(value)) {\n          // When inserting a WebElement into the URL, only use its ID value,\n          // not the full JSON.\n          value = WebElement.extractId(value);\n        }\n        path = path.replace(pathParameters[i], '/' + value);\n        delete parameters[key];\n      } else {\n        throw new error.InvalidArgumentError(\n            'Missing required parameter: ' + key);\n      }\n    }\n  }\n  return path;\n}\n\n\n// PUBLIC API\n\nexports.Executor = Executor;\nexports.Client = Client;\nexports.Request = Request;\nexports.Response = Response;\nexports.buildPath = buildPath;  // Exported for testing.\n"]}