{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["// muri\n\n/**\n * MongoDB URI parser as described here:\n * http://www.mongodb.org/display/DOCS/Connections\n */\n\n/**\n * Module dependencies\n */\n\nvar qs = require('querystring');\n\n/**\n * Defaults\n */\n\nvar DEFAULT_PORT = 27017;\nvar DEFAULT_DB = 'test';\nvar ADMIN_DB = 'admin';\n\n/**\n * Muri\n */\n\nmodule.exports = exports = function muri (str) {\n  if (!/^mongodb:\\/\\//.test(str)) {\n    throw new Error('Invalid mongodb uri. Must begin with \"mongodb://\"'\n                  + '\\n  Received: ' + str);\n  }\n\n  var ret = {\n      hosts: []\n    , db: DEFAULT_DB\n    , options: {}\n  }\n\n  var match = /^mongodb:\\/\\/([^?]+)(\\??.*)$/.exec(str);\n  if (!match || '/' == match[1]) {\n    throw new Error('Invalid mongodb uri. Missing hostname');\n  }\n\n  var uris = match[1];\n  var path = match[2];\n  var db;\n\n  uris.split(',').forEach(function (uri) {\n    var o = parse(uri);\n\n    if (o.host) {\n      ret.hosts.push({\n          host: o.host\n        , port: parseInt(o.port, 10)\n      })\n\n      if (!db && o.db) {\n        db = o.db;\n      }\n    } else if (o.ipc) {\n      ret.hosts.push({ ipc: o.ipc });\n    }\n\n    if (o.auth) {\n      ret.auth = {\n          user: o.auth.user ? (o.auth.user) : void 0\n        , pass: o.auth.pass ? (o.auth.pass) : void 0\n      }\n    }\n  })\n\n  if (!ret.hosts.length) {\n    throw new Error('Invalid mongodb uri. Missing hostname');\n  }\n\n  var parts = path.split('?');\n\n  if (!db) {\n    if (parts[0]) {\n      db = parts[0].replace(/^\\//, '');\n    } else {\n      // deal with ipc formats\n      db = /\\/([^\\.]+)$/.exec(match[1]);\n      if (db && db[1]) {\n        db = db[1];\n      }\n    }\n  }\n\n  if (db) {\n    ret.db = db;\n  } else if (ret.auth) {\n    ret.db = ADMIN_DB;\n  }\n\n  if (parts[1]) {\n    ret.options = options(parts[1]);\n  }\n\n  return ret;\n}\n\n/**\n * Parse str into key/val pairs casting values appropriately.\n */\n\nfunction options (str) {\n  var sep = /;/.test(str)\n    ? ';'\n    : '&';\n\n  var ret = qs.parse(str, sep);\n\n  Object.keys(ret).forEach(function (key) {\n    var val = ret[key];\n    if ('readPreferenceTags' == key) {\n      val = readPref(val);\n      if (val) {\n        ret[key] = Array.isArray(val)\n          ? val\n          : [val];\n      }\n    } else {\n      ret[key] = format(val);\n    }\n  });\n\n  return ret;\n}\n\nfunction format (val) {\n  var num;\n\n  if ('true' == val) {\n    return true;\n  } else if ('false' == val) {\n    return false;\n  } else {\n    num = parseInt(+val, 10);\n    if (!isNaN(num)) {\n      return num;\n    }\n  }\n\n  return val;\n}\n\nfunction readPref (val) {\n  var ret;\n\n  if (Array.isArray(val)) {\n    ret = val.map(readPref).filter(Boolean);\n    return ret.length\n      ? ret\n      : undefined\n  }\n\n  var pair = val.split(',');\n  var hasKeys;\n  ret = {};\n\n  pair.forEach(function (kv) {\n    kv = (kv || '').trim();\n    if (!kv) return;\n    hasKeys = true;\n    var split = kv.split(':');\n    ret[split[0]] = format(split[1]);\n  });\n\n  return hasKeys && ret;\n}\n\nvar ipcRgx = /\\.sock/;\n\nfunction parse (uriString) {\n  // do not use require('url').parse b/c it can't handle # in username or pwd\n  // mongo uris are strange\n\n  var uri = uriString;\n  var ret = {};\n  var parts;\n  var auth;\n  var ipcs;\n\n  // skip protocol\n  uri = uri.replace(/^mongodb:\\/\\//, '');\n\n  // auth\n  if (/@/.test(uri)) {\n    parts = uri.split(/@/);\n    auth = parts[0];\n    uri = parts[1];\n\n    parts = auth.split(':');\n    ret.auth = {};\n    ret.auth.user = decodeURIComponent(parts[0]);\n    ret.auth.pass = parts[1] ? decodeURIComponent(parts[1]) : void 0;\n  }\n\n  // unix domain sockets\n  if (ipcRgx.test(uri)) {\n    ipcs = uri.split(ipcRgx);\n    ret.ipc = ipcs[0] + '.sock';\n\n    // included a database?\n    if (ipcs[1]) {\n      // strip leading / from database name\n      ipcs[1] = ipcs[1].replace(/^\\//, '');\n\n      if (ipcs[1]) {\n        ret.db = ipcs[1];\n      }\n    }\n\n    return ret;\n  }\n\n  // database name\n  parts = uri.split('/');\n  if (parts[1]) ret.db = parts[1];\n\n  // ipv6, [ip]:host\n  if (/^\\[[^\\]]+\\]:\\d+/.test(parts[0])) {\n    ret.host = parts[0].substring(1, parts[0].indexOf(']:'));\n    ret.port = parts[0].substring(parts[0].indexOf(']:') + ']:'.length);\n  } else {\n    // host:port\n    parts = parts[0].split(':');\n    ret.host = parts[0];\n    ret.port = parts[1] || DEFAULT_PORT;\n  }\n\n  return ret;\n}\n\n/**\n * Version\n */\n\nmodule.exports.version = JSON.parse(\n  require('fs').readFileSync(__dirname + '/../package.json', 'utf8')\n).version;\n"]}