{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar Emitter = require('events').EventEmitter;\nvar parser = require('socket.io-parser');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Adapter;\n\n/**\n * Memory adapter constructor.\n *\n * @param {Namespace} nsp\n * @api public\n */\n\nfunction Adapter(nsp){\n  this.nsp = nsp;\n  this.rooms = {};\n  this.sids = {};\n  this.encoder = new parser.Encoder();\n}\n\n/**\n * Inherits from `EventEmitter`.\n */\n\nAdapter.prototype.__proto__ = Emitter.prototype;\n\n/**\n * Adds a socket to a room.\n *\n * @param {String} socket id\n * @param {String} room name\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.add = function(id, room, fn){\n  this.sids[id] = this.sids[id] || {};\n  this.sids[id][room] = true;\n  this.rooms[room] = this.rooms[room] || Room();\n  this.rooms[room].add(id);\n  if (fn) process.nextTick(fn.bind(null, null));\n};\n\n/**\n * Removes a socket from a room.\n *\n * @param {String} socket id\n * @param {String} room name\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.del = function(id, room, fn){\n  this.sids[id] = this.sids[id] || {};\n  delete this.sids[id][room];\n  if (this.rooms.hasOwnProperty(room)) {\n    this.rooms[room].del(id);\n    if (this.rooms[room].length === 0) delete this.rooms[room];\n  }\n\n  if (fn) process.nextTick(fn.bind(null, null));\n};\n\n/**\n * Removes a socket from all rooms it's joined.\n *\n * @param {String} socket id\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.delAll = function(id, fn){\n  var rooms = this.sids[id];\n  if (rooms) {\n    for (var room in rooms) {\n      if (this.rooms.hasOwnProperty(room)) {\n        this.rooms[room].del(id);\n        if (this.rooms[room].length === 0) delete this.rooms[room];\n      }\n    }\n  }\n  delete this.sids[id];\n\n  if (fn) process.nextTick(fn.bind(null, null));\n};\n\n/**\n * Broadcasts a packet.\n *\n * Options:\n *  - `flags` {Object} flags for this packet\n *  - `except` {Array} sids that should be excluded\n *  - `rooms` {Array} list of rooms to broadcast to\n *\n * @param {Object} packet object\n * @api public\n */\n\nAdapter.prototype.broadcast = function(packet, opts){\n  var rooms = opts.rooms || [];\n  var except = opts.except || [];\n  var flags = opts.flags || {};\n  var packetOpts = {\n    preEncoded: true,\n    volatile: flags.volatile,\n    compress: flags.compress\n  };\n  var ids = {};\n  var self = this;\n  var socket;\n\n  packet.nsp = this.nsp.name;\n  this.encoder.encode(packet, function(encodedPackets) {\n    if (rooms.length) {\n      for (var i = 0; i < rooms.length; i++) {\n        var room = self.rooms[rooms[i]];\n        if (!room) continue;\n        var sockets = room.sockets;\n        for (var id in sockets) {\n          if (sockets.hasOwnProperty(id)) {\n            if (ids[id] || ~except.indexOf(id)) continue;\n            socket = self.nsp.connected[id];\n            if (socket) {\n              socket.packet(encodedPackets, packetOpts);\n              ids[id] = true;\n            }\n          }\n        }\n      }\n    } else {\n      for (var id in self.sids) {\n        if (self.sids.hasOwnProperty(id)) {\n          if (~except.indexOf(id)) continue;\n          socket = self.nsp.connected[id];\n          if (socket) socket.packet(encodedPackets, packetOpts);\n        }\n      }\n    }\n  });\n};\n\n/**\n * Gets a list of clients by sid.\n *\n * @param {Array} explicit set of rooms to check.\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.clients = function(rooms, fn){\n  if ('function' == typeof rooms){\n    fn = rooms;\n    rooms = null;\n  }\n\n  rooms = rooms || [];\n\n  var ids = {};\n  var self = this;\n  var sids = [];\n  var socket;\n\n  if (rooms.length) {\n    for (var i = 0; i < rooms.length; i++) {\n      var room = self.rooms[rooms[i]];\n      if (!room) continue;\n      var sockets = room.sockets;\n      for (var id in sockets) {\n        if (sockets.hasOwnProperty(id)) {\n          if (ids[id]) continue;\n          socket = self.nsp.connected[id];\n          if (socket) {\n            sids.push(id);\n            ids[id] = true;\n          }\n        }\n      }\n    }\n  } else {\n    for (var id in self.sids) {\n      if (self.sids.hasOwnProperty(id)) {\n        socket = self.nsp.connected[id];\n        if (socket) sids.push(id);\n      }\n    }\n  }\n\n  if (fn) process.nextTick(fn.bind(null, null, sids));\n};\n\n/**\n * Gets the list of rooms a given client has joined.\n *\n * @param {String} socket id\n * @param {Function} callback\n * @api public\n */\nAdapter.prototype.clientRooms = function(id, fn){\n  var rooms = this.sids[id];\n  if (fn) process.nextTick(fn.bind(null, null, rooms ? Object.keys(rooms) : null));\n};\n\n/**\n* Room constructor.\n*\n* @api private\n*/\n\nfunction Room(){\n  if (!(this instanceof Room)) return new Room();\n  this.sockets = {};\n  this.length = 0;\n}\n\n/**\n * Adds a socket to a room.\n *\n * @param {String} socket id\n * @api private\n */\n\nRoom.prototype.add = function(id){\n  if (!this.sockets.hasOwnProperty(id)) {\n    this.sockets[id] = true;\n    this.length++;\n  }\n};\n\n/**\n * Removes a socket from a room.\n *\n * @param {String} socket id\n * @api private\n */\n\nRoom.prototype.del = function(id){\n  if (this.sockets.hasOwnProperty(id)) {\n    delete this.sockets[id];\n    this.length--;\n  }\n};\n"]}