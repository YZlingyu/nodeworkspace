{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nfunction Kareem() {\n  this._pres = {};\n  this._posts = {};\n}\n\nKareem.prototype.execPre = function(name, context, args, callback) {\n  if (arguments.length === 3) {\n    callback = args;\n    args = [];\n  }\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n  var $args = args;\n\n  if (!numPres) {\n    return process.nextTick(function() {\n      callback(null);\n    });\n  }\n\n  var next = function() {\n    if (currentPre >= numPres) {\n      return;\n    }\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      pre.fn.call(\n        context,\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          ++currentPre;\n          next.apply(context, arguments);\n        },\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          if (--numAsyncPres === 0) {\n            return callback(null);\n          }\n        });\n    } else if (pre.fn.length > 0) {\n      var args = [function(error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n          done = true;\n          return callback(error);\n        }\n\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return callback(null);\n          }\n        }\n\n        next.apply(context, arguments);\n      }];\n      var _args = arguments.length >= 2 ? arguments : [null].concat($args);\n      for (var i = 1; i < _args.length; ++i) {\n        args.push(_args[i]);\n      }\n      pre.fn.apply(context, args);\n    } else {\n      pre.fn.call(context);\n      if (++currentPre >= numPres) {\n        if (asyncPresLeft > 0) {\n          // Leave parallel hooks to run\n          return;\n        } else {\n          return process.nextTick(function() {\n            callback(null);\n          });\n        }\n      }\n      next();\n    }\n  };\n\n  next.apply(null, [null].concat(args));\n};\n\nKareem.prototype.execPreSync = function(name, context) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.call(context);\n  }\n};\n\nKareem.prototype.execPost = function(name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n  var currentPost = 0;\n\n  var firstError = null;\n  if (options && options.error) {\n    firstError = options.error;\n  }\n\n  if (!numPosts) {\n    return process.nextTick(function() {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n\n  var next = function() {\n    var post = posts[currentPost];\n    var numArgs = 0;\n    var argLength = args.length;\n    var newArgs = [];\n    for (var i = 0; i < argLength; ++i) {\n      numArgs += args[i] && args[i]._kareemIgnore ? 0 : 1;\n      if (!args[i] || !args[i]._kareemIgnore) {\n        newArgs.push(args[i]);\n      }\n    }\n\n    if (firstError) {\n      if (post.length === numArgs + 2) {\n        post.apply(context, [firstError].concat(newArgs).concat(function(error) {\n          if (error) {\n            firstError = error;\n          }\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n          next();\n        }));\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n        next();\n      }\n    } else {\n      if (post.length === numArgs + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n        return next();\n      }\n      if (post.length === numArgs + 1) {\n        post.apply(context, newArgs.concat(function(error) {\n          if (error) {\n            firstError = error;\n            return next();\n          }\n\n          if (++currentPost >= numPosts) {\n            return callback.apply(null, [null].concat(args));\n          }\n\n          next();\n        }));\n      } else {\n        post.apply(context, newArgs);\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      }\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPostSync = function(name, context) {\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n\n  for (var i = 0; i < numPosts; ++i) {\n    posts[i].call(context);\n  }\n};\n\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = { error: error };\n    var newArgs = [];\n    // Filter out trailing undefineds\n    for (var i = args.length; i >= 0; --i) {\n      if (newArgs.length > 0 || args[i] !== void 0) {\n        newArgs.unshift(args[i]);\n      }\n    }\n    return instance.execPost(name, context, newArgs, _options, function(error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ?\n      callback(error) :\n      undefined;\n  }\n}\n\nKareem.prototype.wrap = function(name, fn, context, args, options) {\n  var lastArg = (args.length > 0 ? args[args.length - 1] : null);\n  var argsWithoutCb = typeof lastArg === 'function' ?\n    args.slice(0, args.length - 1) :\n    args;\n  var _this = this;\n\n  var useLegacyPost;\n  if (typeof options === 'object') {\n    useLegacyPost = options && options.useLegacyPost;\n  } else {\n    useLegacyPost = options;\n  }\n  options = options || {};\n\n  this.execPre(name, context, args, function(error) {\n    if (error) {\n      var numCallbackParams = options.numCallbackParams || 0;\n      var nulls = [];\n      for (var i = 0; i < numCallbackParams; ++i) {\n        nulls.push(null);\n      }\n      return _handleWrapError(_this, error, name, context, nulls,\n        options, lastArg);\n    }\n\n    var end = (typeof lastArg === 'function' ? args.length - 1 : args.length);\n\n    fn.apply(context, args.slice(0, end).concat(function() {\n      var args = arguments;\n      var argsWithoutError = Array.prototype.slice.call(arguments, 1);\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context,\n          args, options, lastArg);\n      } else {\n        if (useLegacyPost && typeof lastArg === 'function') {\n          lastArg.apply(context, arguments);\n        }\n\n        _this.execPost(name, context, argsWithoutError, function() {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ?\n              lastArg(arguments[0]) :\n              undefined;\n          }\n\n          return typeof lastArg === 'function' && !useLegacyPost ?\n            lastArg.apply(context, arguments) :\n            undefined;\n        });\n      }\n    }));\n  });\n};\n\nKareem.prototype.createWrapper = function(name, fn, context, options) {\n  var _this = this;\n  return function() {\n    var args = Array.prototype.slice.call(arguments);\n    _this.wrap(name, fn, context, args, options);\n  };\n};\n\nKareem.prototype.pre = function(name, isAsync, fn, error) {\n  if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  this._pres[name] = this._pres[name] || [];\n  var pres = this._pres[name];\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  pres.push({ fn: fn, isAsync: isAsync });\n\n  return this;\n};\n\nKareem.prototype.post = function(name, fn) {\n  (this._posts[name] = this._posts[name] || []).push(fn);\n  return this;\n};\n\nKareem.prototype.clone = function() {\n  var n = new Kareem();\n  for (var key in this._pres) {\n    if (!this._pres.hasOwnProperty(key)) {\n      continue;\n    }\n    n._pres[key] = this._pres[key].slice();\n    n._pres[key].numAsync = this._pres[key].numAsync;\n  }\n  for (var key in this._posts) {\n    if (!this._posts.hasOwnProperty(key)) {\n      continue;\n    }\n    n._posts[key] = this._posts[key].slice();\n  }\n\n  return n;\n};\n\nKareem.prototype.merge = function(other) {\n  var ret = this.clone();\n  for (var key in other._pres) {\n    if (!other._pres.hasOwnProperty(key)) {\n      continue;\n    }\n    ret._pres[key] = (ret._pres[key] || []).concat(other._pres[key].slice());\n    ret._pres[key].numAsync += other._pres[key].numAsync;\n  }\n  for (var key in other._posts) {\n    if (!other._posts.hasOwnProperty(key)) {\n      continue;\n    }\n    ret._posts[key] = (ret._posts[key] || []).concat(other._posts[key].slice());\n  }\n\n  return ret;\n};\n\nmodule.exports = Kareem;\n"]}