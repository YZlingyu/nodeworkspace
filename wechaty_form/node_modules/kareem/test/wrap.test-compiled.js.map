{"version":3,"sources":["wrap.test.js"],"names":[],"mappings":"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","file":"wrap.test-compiled.js","sourcesContent":["var assert = require('assert');\nvar Kareem = require('../');\n\ndescribe('wrap()', function() {\n  var hooks;\n\n  beforeEach(function() {\n    hooks = new Kareem();\n  });\n\n  it('handles pre errors', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal(undefined, obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        // Should never get called\n        assert.ok(false);\n        callback(null, o);\n      },\n      obj,\n      args);\n  });\n\n  it('handles pre errors when no callback defined', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        // Should never get called\n        assert.ok(false);\n        callback(null, o);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        done();\n      },\n      25);\n  });\n\n  it('handles errors in wrapped function', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal(undefined, obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        callback('error!');\n      },\n      obj,\n      args);\n  });\n\n  it('handles errors in post', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(obj, callback) {\n      obj.tofu = 'no';\n      callback('error!');\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal('no', obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        callback(null, o);\n      },\n      obj,\n      args);\n  });\n\n  it('defers errors to post hooks if enabled', function(done) {\n    hooks.pre('cook', function(done) {\n      done(new Error('fail'));\n    });\n\n    hooks.post('cook', function(error, res, callback) {\n      callback(new Error('another error occurred'));\n    });\n\n    var args = [];\n    args.push(function(error) {\n      assert.equal(error.message, 'another error occurred');\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        assert.ok(false);\n        callback();\n      },\n      null,\n      args,\n      { useErrorHandlers: true, numCallbackParams: 1 });\n  });\n\n  it('error handlers with no callback', function(done) {\n    hooks.pre('cook', function(done) {\n      done(new Error('fail'));\n    });\n\n    hooks.post('cook', function(error, callback) {\n      assert.equal(error.message, 'fail');\n      done();\n    });\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        assert.ok(false);\n        callback();\n      },\n      null,\n      args,\n      { useErrorHandlers: true });\n  });\n\n  it('error handlers with no error', function(done) {\n    hooks.post('cook', function(error, callback) {\n      callback(new Error('another error occurred'));\n    });\n\n    var args = [];\n    args.push(function(error) {\n      assert.ifError(error);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback();\n      },\n      null,\n      args,\n      { useErrorHandlers: true });\n  });\n\n  it('works with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback(null);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal('no', obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles pre errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback(null);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(undefined, obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles wrapped function errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      obj.waffles = false;\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback('error!');\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(false, obj.waffles);\n        assert.equal(undefined, obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles post errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      obj.waffles = false;\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback('error!');\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback();\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(false, obj.waffles);\n        assert.equal('no', obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('can use legacy post behavior', function(done) {\n    var called = 0;\n    hooks.post('cook', function(callback) {\n      ++called;\n      callback();\n    });\n\n    var args = [function(error) {\n      assert.equal(called, 0);\n\n      setTimeout(function() {\n        assert.equal(called, 1);\n        done();\n      }, 0);\n    }];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback();\n      },\n      null,\n      args,\n      true);\n  });\n});\n"]}