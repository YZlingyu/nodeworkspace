{"version":3,"sources":["readable.asynct.js"],"names":[],"mappings":"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","file":"readable.asynct-compiled.js","sourcesContent":["\nvar es = require('../')\n  , it = require('it-is').style('colour')\n  , u = require('ubelt')\n\nexports ['read an array'] = function (test) {\n\n\n  console.log('readable')\n  return test.end()\n  var readThis = u.map(3, 6, 100, u.id) //array of multiples of 3 < 100\n\n  console.log('readable')\n\n  var reader = \n    es.readable(function (i, callback) {\n      if(i >= readThis.length)\n        return this.emit('end')\n      console.log('readable')\n      callback(null, readThis[i])\n    })\n\n  var writer = es.writeArray(function (err, array){\n    if(err) throw err\n    it(array).deepEqual(readThis)\n    test.done()\n  })\n\n  reader.pipe(writer)\n}\n\nexports ['read an array - async'] = function (test) {\n\n  var readThis = u.map(3, 6, 100, u.id) //array of multiples of 3 < 100\n\n  var reader = \n    es.readable(function (i, callback) {\n      if(i >= readThis.length)\n        return this.emit('end')\n      u.delay(callback)(null, readThis[i])\n    })\n\n  var writer = es.writeArray(function (err, array){\n    if(err) throw err\n    it(array).deepEqual(readThis)\n    test.done()\n  })\n\n  reader.pipe(writer)\n}\n\n\nexports ['emit data then call next() also works'] = function (test) {\n\n  var readThis = u.map(3, 6, 100, u.id) //array of multiples of 3 < 100\n\n  var reader = \n    es.readable(function (i, next) {\n      if(i >= readThis.length)\n        return this.emit('end')\n      this.emit('data', readThis[i])\n      next()\n    })\n\n  var writer = es.writeArray(function (err, array){\n    if(err) throw err\n    it(array).deepEqual(readThis)\n    test.done()     \n  })\n\n  reader.pipe(writer)\n}\n\n\nexports ['callback emits error, then stops'] = function (test) {\n\n  var err = new Error('INTENSIONAL ERROR')\n    , called = 0\n\n  var reader = \n    es.readable(function (i, callback) {\n      if(called++)\n        return\n      callback(err)\n    })\n\n  reader.on('error', function (_err){\n    it(_err).deepEqual(err)\n    u.delay(function() {\n      it(called).equal(1)\n      test.done()\n    }, 50)()\n  })\n}\n\nexports['readable does not call read concurrently'] = function (test) {\n\n  var current = 0\n  var source = es.readable(function(count, cb){\n    current ++\n    if(count > 100)\n      return this.emit('end')\n    u.delay(function(){\n      current --\n      it(current).equal(0)      \n      cb(null, {ok: true, n: count});\n    })();\n  });\n\n  var destination = es.map(function(data, cb){\n    //console.info(data); \n    cb();\n  });\n\n  var all = es.connect(source, destination);\n\n  destination.on('end', test.done)\n}\n\nexports ['does not raise a warning: Recursive process.nextTick detected'] = function (test) {\n    var readThisDelayed;\n\n    u.delay(function () {\n        readThisDelayed = [1, 3, 5];\n    })();\n\n    es.readable(function (count, callback) {\n\n        if (readThisDelayed) {\n            var that = this;\n            readThisDelayed.forEach(function (item) {\n                that.emit('data', item);\n            });\n\n            this.emit('end');\n            test.done();\n        }\n\n        callback();\n    });\n};\n\n//\n// emitting multiple errors is not supported by stream.\n//\n// I do not think that this is a good idea, at least, there should be an option to pipe to \n// continue on error. it makes alot ef sense, if you are using Stream like I am, to be able to emit multiple errors.\n// an error might not necessarily mean the end of the stream. it depends on the error, at least.\n//\n// I will start a thread on the mailing list. I'd rather that than use a custom `pipe` implementation.\n// \n// basically, I want to be able use pipe to transform objects, and if one object is invalid, \n// the next might still be good, so I should get to choose if it's gonna stop.\n// re-enstate this test when this issue progresses.\n//\n// hmm. I could add this to es.connect by deregistering the error listener, \n// but I would rather it be an option in core.\n\n/*\nexports ['emit multiple errors, with 2nd parameter (continueOnError)'] = function (test) {\n\n  var readThis = d.map(1, 100, d.id)\n    , errors = 0\n  var reader = \n    es.readable(function (i, callback) {\n      console.log(i, readThis.length)\n      if(i >= readThis.length)\n        return this.emit('end')\n      if(!(readThis[i] % 7))\n        return callback(readThis[i])\n      callback(null, readThis[i])\n    }, true)\n\n  var writer = es.writeArray(function (err, array) {\n    if(err) throw err\n    it(array).every(function (u){\n      it(u % 7).notEqual(0)      \n    }).property('length', 80)\n    it(errors).equal(14)\n    test.done()     \n  })\n\n  reader.on('error', function (u) {\n    errors ++\n    console.log(u)\n    if('number' !== typeof u)\n      throw u\n\n    it(u % 7).equal(0)\n\n  })\n\n  reader.pipe(writer)\n}\n*/\n\nrequire('./helper')(module)\n"]}