{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar http = require('http');\nvar read = require('fs').readFileSync;\nvar engine = require('engine.io');\nvar client = require('socket.io-client');\nvar clientVersion = require('socket.io-client/package').version;\nvar Client = require('./client');\nvar Emitter = require('events').EventEmitter;\nvar Namespace = require('./namespace');\nvar Adapter = require('socket.io-adapter');\nvar debug = require('debug')('socket.io:server');\nvar url = require('url');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Server;\n\n/**\n * Socket.IO client source.\n */\n\nvar clientSource = undefined;\nvar clientSourceMap = undefined;\n\n/**\n * Server constructor.\n *\n * @param {http.Server|Number|Object} srv http server, port or options\n * @param {Object} [opts]\n * @api public\n */\n\nfunction Server(srv, opts){\n  if (!(this instanceof Server)) return new Server(srv, opts);\n  if ('object' == typeof srv && !srv.listen) {\n    opts = srv;\n    srv = null;\n  }\n  opts = opts || {};\n  this.nsps = {};\n  this.path(opts.path || '/socket.io');\n  this.serveClient(false !== opts.serveClient);\n  this.adapter(opts.adapter || Adapter);\n  this.origins(opts.origins || '*:*');\n  this.sockets = this.of('/');\n  if (srv) this.attach(srv, opts);\n}\n\n/**\n * Server request verification function, that checks for allowed origins\n *\n * @param {http.IncomingMessage} req request\n * @param {Function} fn callback to be called with the result: `fn(err, success)`\n */\n\nServer.prototype.checkRequest = function(req, fn) {\n  var origin = req.headers.origin || req.headers.referer;\n\n  // file:// URLs produce a null Origin which can't be authorized via echo-back\n  if ('null' == origin || null == origin) origin = '*';\n\n  if (!!origin && typeof(this._origins) == 'function') return this._origins(origin, fn);\n  if (this._origins.indexOf('*:*') !== -1) return fn(null, true);\n  if (origin) {\n    try {\n      var parts = url.parse(origin);\n      var defaultPort = 'https:' == parts.protocol ? 443 : 80;\n      parts.port = parts.port != null\n        ? parts.port\n        : defaultPort;\n      var ok =\n        ~this._origins.indexOf(parts.hostname + ':' + parts.port) ||\n        ~this._origins.indexOf(parts.hostname + ':*') ||\n        ~this._origins.indexOf('*:' + parts.port);\n      return fn(null, !!ok);\n    } catch (ex) {\n    }\n  }\n  fn(null, false);\n};\n\n/**\n * Sets/gets whether client code is being served.\n *\n * @param {Boolean} v whether to serve client code\n * @return {Server|Boolean} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.serveClient = function(v){\n  if (!arguments.length) return this._serveClient;\n  this._serveClient = v;\n\n  if (v && !clientSource) {\n    clientSource = read(require.resolve('socket.io-client/dist/socket.io.min.js'), 'utf-8');\n    try {\n      clientSourceMap = read(require.resolve('socket.io-client/dist/socket.io.js.map'), 'utf-8');\n    } catch(err) {\n      debug('could not load sourcemap file');\n    }\n  }\n\n  return this;\n};\n\n/**\n * Old settings for backwards compatibility\n */\n\nvar oldSettings = {\n  \"transports\": \"transports\",\n  \"heartbeat timeout\": \"pingTimeout\",\n  \"heartbeat interval\": \"pingInterval\",\n  \"destroy buffer size\": \"maxHttpBufferSize\"\n};\n\n/**\n * Backwards compatibility.\n *\n * @api public\n */\n\nServer.prototype.set = function(key, val){\n  if ('authorization' == key && val) {\n    this.use(function(socket, next) {\n      val(socket.request, function(err, authorized) {\n        if (err) return next(new Error(err));\n        if (!authorized) return next(new Error('Not authorized'));\n        next();\n      });\n    });\n  } else if ('origins' == key && val) {\n    this.origins(val);\n  } else if ('resource' == key) {\n    this.path(val);\n  } else if (oldSettings[key] && this.eio[oldSettings[key]]) {\n    this.eio[oldSettings[key]] = val;\n  } else {\n    console.error('Option %s is not valid. Please refer to the README.', key);\n  }\n\n  return this;\n};\n\n/**\n * Sets the client serving path.\n *\n * @param {String} v pathname\n * @return {Server|String} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.path = function(v){\n  if (!arguments.length) return this._path;\n  this._path = v.replace(/\\/$/, '');\n  return this;\n};\n\n/**\n * Sets the adapter for rooms.\n *\n * @param {Adapter} v pathname\n * @return {Server|Adapter} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.adapter = function(v){\n  if (!arguments.length) return this._adapter;\n  this._adapter = v;\n  for (var i in this.nsps) {\n    if (this.nsps.hasOwnProperty(i)) {\n      this.nsps[i].initAdapter();\n    }\n  }\n  return this;\n};\n\n/**\n * Sets the allowed origins for requests.\n *\n * @param {String} v origins\n * @return {Server|Adapter} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.origins = function(v){\n  if (!arguments.length) return this._origins;\n\n  this._origins = v;\n  return this;\n};\n\n/**\n * Attaches socket.io to a server or port.\n *\n * @param {http.Server|Number} server or port\n * @param {Object} options passed to engine.io\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.listen =\nServer.prototype.attach = function(srv, opts){\n  if ('function' == typeof srv) {\n    var msg = 'You are trying to attach socket.io to an express ' +\n    'request handler function. Please pass a http.Server instance.';\n    throw new Error(msg);\n  }\n\n  // handle a port as a string\n  if (Number(srv) == srv) {\n    srv = Number(srv);\n  }\n\n  if ('number' == typeof srv) {\n    debug('creating http server and binding to %d', srv);\n    var port = srv;\n    srv = http.Server(function(req, res){\n      res.writeHead(404);\n      res.end();\n    });\n    srv.listen(port);\n\n  }\n\n  // set engine.io path to `/socket.io`\n  opts = opts || {};\n  opts.path = opts.path || this.path();\n  // set origins verification\n  opts.allowRequest = opts.allowRequest || this.checkRequest.bind(this);\n\n  // initialize engine\n  debug('creating engine.io instance with opts %j', opts);\n  this.eio = engine.attach(srv, opts);\n\n  // attach static file serving\n  if (this._serveClient) this.attachServe(srv);\n\n  // Export http server\n  this.httpServer = srv;\n\n  // bind to engine events\n  this.bind(this.eio);\n\n  return this;\n};\n\n/**\n * Attaches the static file serving.\n *\n * @param {Function|http.Server} srv http server\n * @api private\n */\n\nServer.prototype.attachServe = function(srv){\n  debug('attaching client serving req handler');\n  var url = this._path + '/socket.io.js';\n  var urlMap = this._path + '/socket.io.js.map';\n  var evs = srv.listeners('request').slice(0);\n  var self = this;\n  srv.removeAllListeners('request');\n  srv.on('request', function(req, res) {\n    if (0 === req.url.indexOf(urlMap)) {\n      self.serveMap(req, res);\n    } else if (0 === req.url.indexOf(url)) {\n      self.serve(req, res);\n    } else {\n      for (var i = 0; i < evs.length; i++) {\n        evs[i].call(srv, req, res);\n      }\n    }\n  });\n};\n\n/**\n * Handles a request serving `/socket.io.js`\n *\n * @param {http.Request} req\n * @param {http.Response} res\n * @api private\n */\n\nServer.prototype.serve = function(req, res){\n  // Per the standard, ETags must be quoted:\n  // https://tools.ietf.org/html/rfc7232#section-2.3\n  var expectedEtag = '\"' + clientVersion + '\"';\n\n  var etag = req.headers['if-none-match'];\n  if (etag) {\n    if (expectedEtag == etag) {\n      debug('serve client 304');\n      res.writeHead(304);\n      res.end();\n      return;\n    }\n  }\n\n  debug('serve client source');\n  res.setHeader('Content-Type', 'application/javascript');\n  res.setHeader('ETag', expectedEtag);\n  res.setHeader('X-SourceMap', 'socket.io.js.map');\n  res.writeHead(200);\n  res.end(clientSource);\n};\n\n/**\n * Handles a request serving `/socket.io.js.map`\n *\n * @param {http.Request} req\n * @param {http.Response} res\n * @api private\n */\n\nServer.prototype.serveMap = function(req, res){\n  // Per the standard, ETags must be quoted:\n  // https://tools.ietf.org/html/rfc7232#section-2.3\n  var expectedEtag = '\"' + clientVersion + '\"';\n\n  var etag = req.headers['if-none-match'];\n  if (etag) {\n    if (expectedEtag == etag) {\n      debug('serve client 304');\n      res.writeHead(304);\n      res.end();\n      return;\n    }\n  }\n\n  debug('serve client sourcemap');\n  res.setHeader('Content-Type', 'application/json');\n  res.setHeader('ETag', expectedEtag);\n  res.writeHead(200);\n  res.end(clientSourceMap);\n};\n\n/**\n * Binds socket.io to an engine.io instance.\n *\n * @param {engine.Server} engine engine.io (or compatible) server\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.bind = function(engine){\n  this.engine = engine;\n  this.engine.on('connection', this.onconnection.bind(this));\n  return this;\n};\n\n/**\n * Called with each incoming transport connection.\n *\n * @param {engine.Socket} conn\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.onconnection = function(conn){\n  debug('incoming connection with id %s', conn.id);\n  var client = new Client(this, conn);\n  client.connect('/');\n  return this;\n};\n\n/**\n * Looks up a namespace.\n *\n * @param {String} name nsp name\n * @param {Function} [fn] optional, nsp `connection` ev handler\n * @api public\n */\n\nServer.prototype.of = function(name, fn){\n  if (String(name)[0] !== '/') name = '/' + name;\n  \n  var nsp = this.nsps[name];\n  if (!nsp) {\n    debug('initializing namespace %s', name);\n    nsp = new Namespace(this, name);\n    this.nsps[name] = nsp;\n  }\n  if (fn) nsp.on('connect', fn);\n  return nsp;\n};\n\n/**\n * Closes server connection\n *\n * @param {Function} [fn] optional, called as `fn([err])` on error OR all conns closed \n * @api public\n */\n\nServer.prototype.close = function(fn){\n  for (var id in this.nsps['/'].sockets) {\n    if (this.nsps['/'].sockets.hasOwnProperty(id)) {\n      this.nsps['/'].sockets[id].onclose();\n    }\n  }\n\n  this.engine.close();\n\n  if (this.httpServer) {\n    this.httpServer.close(fn);\n  } else {\n    fn && fn();\n  }\n};\n\n/**\n * Expose main namespace (/).\n */\n\nvar emitterMethods = Object.keys(Emitter.prototype).filter(function(key){\n  return typeof Emitter.prototype[key] === 'function';\n});\n\nemitterMethods.concat(['to', 'in', 'use', 'send', 'write', 'clients', 'compress']).forEach(function(fn){\n  Server.prototype[fn] = function(){\n    return this.sockets[fn].apply(this.sockets, arguments);\n  };\n});\n\nNamespace.flags.forEach(function(flag){\n  Object.defineProperty(Server.prototype, flag, {\n    get: function() {\n      this.sockets.flags = this.sockets.flags || {};\n      this.sockets.flags[flag] = true;\n      return this;\n    }\n  });\n});\n\n/**\n * BC with `io.listen`\n */\n\nServer.listen = Server;\n"]}