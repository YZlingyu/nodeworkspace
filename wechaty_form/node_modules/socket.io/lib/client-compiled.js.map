{"version":3,"sources":["client.js"],"names":[],"mappings":"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","file":"client-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar parser = require('socket.io-parser');\nvar debug = require('debug')('socket.io:client');\nvar url = require('url');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Client;\n\n/**\n * Client constructor.\n *\n * @param {Server} server instance\n * @param {Socket} conn\n * @api private\n */\n\nfunction Client(server, conn){\n  this.server = server;\n  this.conn = conn;\n  this.encoder = new parser.Encoder();\n  this.decoder = new parser.Decoder();\n  this.id = conn.id;\n  this.request = conn.request;\n  this.setup();\n  this.sockets = {};\n  this.nsps = {};\n  this.connectBuffer = [];\n}\n\n/**\n * Sets up event listeners.\n *\n * @api private\n */\n\nClient.prototype.setup = function(){\n  this.onclose = this.onclose.bind(this);\n  this.ondata = this.ondata.bind(this);\n  this.onerror = this.onerror.bind(this);\n  this.ondecoded = this.ondecoded.bind(this);\n\n  this.decoder.on('decoded', this.ondecoded);\n  this.conn.on('data', this.ondata);\n  this.conn.on('error', this.onerror);\n  this.conn.on('close', this.onclose);\n};\n\n/**\n * Connects a client to a namespace.\n *\n * @param {String} name namespace\n * @api private\n */\n\nClient.prototype.connect = function(name, query){\n  debug('connecting to namespace %s', name);\n  var nsp = this.server.nsps[name];\n  if (!nsp) {\n    this.packet({ type: parser.ERROR, nsp: name, data : 'Invalid namespace'});\n    return;\n  }\n\n  if ('/' != name && !this.nsps['/']) {\n    this.connectBuffer.push(name);\n    return;\n  }\n\n  var self = this;\n  var socket = nsp.add(this, query, function(){\n    self.sockets[socket.id] = socket;\n    self.nsps[nsp.name] = socket;\n\n    if ('/' == nsp.name && self.connectBuffer.length > 0) {\n      self.connectBuffer.forEach(self.connect, self);\n      self.connectBuffer = [];\n    }\n  });\n};\n\n/**\n * Disconnects from all namespaces and closes transport.\n *\n * @api private\n */\n\nClient.prototype.disconnect = function(){\n  for (var id in this.sockets) {\n    if (this.sockets.hasOwnProperty(id)) {\n      this.sockets[id].disconnect();\n    }\n  }\n  this.sockets = {};\n  this.close();\n};\n\n/**\n * Removes a socket. Called by each `Socket`.\n *\n * @api private\n */\n\nClient.prototype.remove = function(socket){\n  if (this.sockets.hasOwnProperty(socket.id)) {\n    var nsp = this.sockets[socket.id].nsp.name;\n    delete this.sockets[socket.id];\n    delete this.nsps[nsp];\n  } else {\n    debug('ignoring remove for %s', socket.id);\n  }\n};\n\n/**\n * Closes the underlying connection.\n *\n * @api private\n */\n\nClient.prototype.close = function(){\n  if ('open' == this.conn.readyState) {\n    debug('forcing transport close');\n    this.conn.close();\n    this.onclose('forced server close');\n  }\n};\n\n/**\n * Writes a packet to the transport.\n *\n * @param {Object} packet object\n * @param {Object} opts\n * @api private\n */\n\nClient.prototype.packet = function(packet, opts){\n  opts = opts || {};\n  var self = this;\n\n  // this writes to the actual connection\n  function writeToEngine(encodedPackets) {\n    if (opts.volatile && !self.conn.transport.writable) return;\n    for (var i = 0; i < encodedPackets.length; i++) {\n      self.conn.write(encodedPackets[i], { compress: opts.compress });\n    }\n  }\n\n  if ('open' == this.conn.readyState) {\n    debug('writing packet %j', packet);\n    if (!opts.preEncoded) { // not broadcasting, need to encode\n      this.encoder.encode(packet, function (encodedPackets) { // encode, then write results to engine\n        writeToEngine(encodedPackets);\n      });\n    } else { // a broadcast pre-encodes a packet\n      writeToEngine(packet);\n    }\n  } else {\n    debug('ignoring packet write %j', packet);\n  }\n};\n\n/**\n * Called with incoming transport data.\n *\n * @api private\n */\n\nClient.prototype.ondata = function(data){\n  // try/catch is needed for protocol violations (GH-1880)\n  try {\n    this.decoder.add(data);\n  } catch(e) {\n    this.onerror(e);\n  }\n};\n\n/**\n * Called when parser fully decodes a packet.\n *\n * @api private\n */\n\nClient.prototype.ondecoded = function(packet) {\n  if (parser.CONNECT == packet.type) {\n    this.connect(url.parse(packet.nsp).pathname, url.parse(packet.nsp, true).query);\n  } else {\n    var socket = this.nsps[packet.nsp];\n    if (socket) {\n      process.nextTick(function() {\n        socket.onpacket(packet);\n      });\n    } else {\n      debug('no socket for namespace %s', packet.nsp);\n    }\n  }\n};\n\n/**\n * Handles an error.\n *\n * @param {Object} err object\n * @api private\n */\n\nClient.prototype.onerror = function(err){\n  for (var id in this.sockets) {\n    if (this.sockets.hasOwnProperty(id)) {\n      this.sockets[id].onerror(err);\n    }\n  }\n  this.onclose('client error');\n};\n\n/**\n * Called upon transport close.\n *\n * @param {String} reason\n * @api private\n */\n\nClient.prototype.onclose = function(reason){\n  debug('client close with reason %s', reason);\n\n  // ignore a potential subsequent `close` event\n  this.destroy();\n\n  // `nsps` and `sockets` are cleaned up seamlessly\n  for (var id in this.sockets) {\n    if (this.sockets.hasOwnProperty(id)) {\n      this.sockets[id].onclose(reason);\n    }\n  }\n  this.sockets = {};\n\n  this.decoder.destroy(); // clean up decoder\n};\n\n/**\n * Cleans up event listeners.\n *\n * @api private\n */\n\nClient.prototype.destroy = function(){\n  this.conn.removeListener('data', this.ondata);\n  this.conn.removeListener('error', this.onerror);\n  this.conn.removeListener('close', this.onclose);\n  this.decoder.removeListener('decoded', this.ondecoded);\n};\n"]}