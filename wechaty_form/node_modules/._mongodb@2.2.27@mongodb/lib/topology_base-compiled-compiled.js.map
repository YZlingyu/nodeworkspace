{"version":3,"sources":["topology_base-compiled.js"],"names":[],"mappings":"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","file":"topology_base-compiled-compiled.js","sourcesContent":["\"use strict\";\n\nvar MongoError = require('mongodb-core').MongoError,\n    f = require('util').format;\n\n// The store of ops\nvar Store = function (topology, storeOptions) {\n  var self = this;\n  var storedOps = [];\n  storeOptions = storeOptions || { force: false, bufferMaxEntries: -1 };\n\n  // Internal state\n  this.s = {\n    storedOps: storedOps,\n    storeOptions: storeOptions,\n    topology: topology\n  };\n\n  Object.defineProperty(this, 'length', {\n    enumerable: true, get: function () {\n      return self.s.storedOps.length;\n    }\n  });\n};\n\nStore.prototype.add = function (opType, ns, ops, options, callback) {\n  if (this.s.storeOptions.force) {\n    return callback(MongoError.create({ message: \"db closed by application\", driver: true }));\n  }\n\n  if (this.s.storeOptions.bufferMaxEntries == 0) {\n    return callback(MongoError.create({ message: f(\"no connection available for operation and number of stored operation > %s\", this.s.storeOptions.bufferMaxEntries), driver: true }));\n  }\n\n  if (this.s.storeOptions.bufferMaxEntries > 0 && this.s.storedOps.length > this.s.storeOptions.bufferMaxEntries) {\n    while (this.s.storedOps.length > 0) {\n      var op = this.s.storedOps.shift();\n      op.c(MongoError.create({ message: f(\"no connection available for operation and number of stored operation > %s\", this.s.storeOptions.bufferMaxEntries), driver: true }));\n    }\n\n    return;\n  }\n\n  this.s.storedOps.push({ t: opType, n: ns, o: ops, op: options, c: callback });\n};\n\nStore.prototype.addObjectAndMethod = function (opType, object, method, params, callback) {\n  if (this.s.storeOptions.force) {\n    return callback(MongoError.create({ message: \"db closed by application\", driver: true }));\n  }\n\n  if (this.s.storeOptions.bufferMaxEntries == 0) {\n    return callback(MongoError.create({ message: f(\"no connection available for operation and number of stored operation > %s\", this.s.storeOptions.bufferMaxEntries), driver: true }));\n  }\n\n  if (this.s.storeOptions.bufferMaxEntries > 0 && this.s.storedOps.length > this.s.storeOptions.bufferMaxEntries) {\n    while (this.s.storedOps.length > 0) {\n      var op = this.s.storedOps.shift();\n      op.c(MongoError.create({ message: f(\"no connection available for operation and number of stored operation > %s\", this.s.storeOptions.bufferMaxEntries), driver: true }));\n    }\n\n    return;\n  }\n\n  this.s.storedOps.push({ t: opType, m: method, o: object, p: params, c: callback });\n};\n\nStore.prototype.flush = function (err) {\n  while (this.s.storedOps.length > 0) {\n    this.s.storedOps.shift().c(err || MongoError.create({ message: f(\"no connection available for operation\"), driver: true }));\n  }\n};\n\nvar primaryOptions = ['primary', 'primaryPreferred', 'nearest', 'secondaryPreferred'];\nvar secondaryOptions = ['secondary', 'secondaryPreferred'];\n\nStore.prototype.execute = function (options) {\n  options = options || {};\n  // Get current ops\n  var ops = this.s.storedOps;\n  // Reset the ops\n  this.s.storedOps = [];\n\n  // Unpack options\n  var executePrimary = typeof options.executePrimary === 'boolean' ? options.executePrimary : true;\n  var executeSecondary = typeof options.executeSecondary === 'boolean' ? options.executeSecondary : true;\n\n  // Execute all the stored ops\n  while (ops.length > 0) {\n    var op = ops.shift();\n\n    if (op.t == 'cursor') {\n      if (executePrimary && executeSecondary) {\n        op.o[op.m].apply(op.o, op.p);\n      } else if (executePrimary && op.o.options && op.o.options.readPreference && primaryOptions.indexOf(op.o.options.readPreference.mode) != -1) {\n        op.o[op.m].apply(op.o, op.p);\n      } else if (!executePrimary && executeSecondary && op.o.options && op.o.options.readPreference && secondaryOptions.indexOf(op.o.options.readPreference.mode) != -1) {\n        op.o[op.m].apply(op.o, op.p);\n      }\n    } else if (op.t == 'auth') {\n      this.s.topology[op.t].apply(this.s.topology, op.o);\n    } else {\n      if (executePrimary && executeSecondary) {\n        this.s.topology[op.t](op.n, op.o, op.op, op.c);\n      } else if (executePrimary && op.op && op.op.readPreference && primaryOptions.indexOf(op.op.readPreference.mode) != -1) {\n        this.s.topology[op.t](op.n, op.o, op.op, op.c);\n      } else if (!executePrimary && executeSecondary && op.op && op.op.readPreference && secondaryOptions.indexOf(op.op.readPreference.mode) != -1) {\n        this.s.topology[op.t](op.n, op.o, op.op, op.c);\n      }\n    }\n  }\n};\n\nStore.prototype.all = function () {\n  return this.s.storedOps;\n};\n\n// Server capabilities\nvar ServerCapabilities = function (ismaster) {\n  var setup_get_property = function (object, name, value) {\n    Object.defineProperty(object, name, {\n      enumerable: true,\n      get: function () {\n        return value;\n      }\n    });\n  };\n\n  // Capabilities\n  var aggregationCursor = false;\n  var writeCommands = false;\n  var textSearch = false;\n  var authCommands = false;\n  var listCollections = false;\n  var listIndexes = false;\n  var maxNumberOfDocsInBatch = ismaster.maxWriteBatchSize || 1000;\n  var commandsTakeWriteConcern = false;\n  var commandsTakeCollation = false;\n\n  if (ismaster.minWireVersion >= 0) {\n    textSearch = true;\n  }\n\n  if (ismaster.maxWireVersion >= 1) {\n    aggregationCursor = true;\n    authCommands = true;\n  }\n\n  if (ismaster.maxWireVersion >= 2) {\n    writeCommands = true;\n  }\n\n  if (ismaster.maxWireVersion >= 3) {\n    listCollections = true;\n    listIndexes = true;\n  }\n\n  if (ismaster.maxWireVersion >= 5) {\n    commandsTakeWriteConcern = true;\n    commandsTakeCollation = true;\n  }\n\n  // If no min or max wire version set to 0\n  if (ismaster.minWireVersion == null) {\n    ismaster.minWireVersion = 0;\n  }\n\n  if (ismaster.maxWireVersion == null) {\n    ismaster.maxWireVersion = 0;\n  }\n\n  // Map up read only parameters\n  setup_get_property(this, \"hasAggregationCursor\", aggregationCursor);\n  setup_get_property(this, \"hasWriteCommands\", writeCommands);\n  setup_get_property(this, \"hasTextSearch\", textSearch);\n  setup_get_property(this, \"hasAuthCommands\", authCommands);\n  setup_get_property(this, \"hasListCollectionsCommand\", listCollections);\n  setup_get_property(this, \"hasListIndexesCommand\", listIndexes);\n  setup_get_property(this, \"minWireVersion\", ismaster.minWireVersion);\n  setup_get_property(this, \"maxWireVersion\", ismaster.maxWireVersion);\n  setup_get_property(this, \"maxNumberOfDocsInBatch\", maxNumberOfDocsInBatch);\n  setup_get_property(this, \"commandsTakeWriteConcern\", commandsTakeWriteConcern);\n  setup_get_property(this, \"commandsTakeCollation\", commandsTakeCollation);\n};\n\nexports.Store = Store;\nexports.ServerCapabilities = ServerCapabilities;\n\n//# sourceMappingURL=topology_base-compiled.js.map"]}