{"version":3,"sources":["authenticate-compiled.js"],"names":[],"mappings":"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","file":"authenticate-compiled-compiled.js","sourcesContent":["var shallowClone = require('./utils').shallowClone,\n    handleCallback = require('./utils').handleCallback,\n    MongoError = require('mongodb-core').MongoError;\n\nvar authenticate = function (self, username, password, options, callback) {\n  // Did the user destroy the topology\n  if (self.serverConfig && self.serverConfig.isDestroyed()) return callback(new MongoError('topology was destroyed'));\n\n  // the default db to authenticate against is 'self'\n  // if authententicate is called from a retry context, it may be another one, like admin\n  var authdb = options.dbName ? options.dbName : self.databaseName;\n  authdb = self.authSource ? self.authSource : authdb;\n  authdb = options.authdb ? options.authdb : authdb;\n  authdb = options.authSource ? options.authSource : authdb;\n\n  // Callback\n  var _callback = function (err, result) {\n    if (self.listeners('authenticated').length > 0) {\n      self.emit('authenticated', err, result);\n    }\n\n    // Return to caller\n    handleCallback(callback, err, result);\n  };\n\n  // authMechanism\n  var authMechanism = options.authMechanism || '';\n  authMechanism = authMechanism.toUpperCase();\n\n  // If classic auth delegate to auth command\n  if (authMechanism == 'MONGODB-CR') {\n    self.s.topology.auth('mongocr', authdb, username, password, function (err) {\n      if (err) return handleCallback(callback, err, false);\n      _callback(null, true);\n    });\n  } else if (authMechanism == 'PLAIN') {\n    self.s.topology.auth('plain', authdb, username, password, function (err) {\n      if (err) return handleCallback(callback, err, false);\n      _callback(null, true);\n    });\n  } else if (authMechanism == 'MONGODB-X509') {\n    self.s.topology.auth('x509', authdb, username, password, function (err) {\n      if (err) return handleCallback(callback, err, false);\n      _callback(null, true);\n    });\n  } else if (authMechanism == 'SCRAM-SHA-1') {\n    self.s.topology.auth('scram-sha-1', authdb, username, password, function (err) {\n      if (err) return handleCallback(callback, err, false);\n      _callback(null, true);\n    });\n  } else if (authMechanism == 'GSSAPI') {\n    if (process.platform == 'win32') {\n      self.s.topology.auth('sspi', authdb, username, password, options, function (err) {\n        if (err) return handleCallback(callback, err, false);\n        _callback(null, true);\n      });\n    } else {\n      self.s.topology.auth('gssapi', authdb, username, password, options, function (err) {\n        if (err) return handleCallback(callback, err, false);\n        _callback(null, true);\n      });\n    }\n  } else if (authMechanism == 'DEFAULT') {\n    self.s.topology.auth('default', authdb, username, password, function (err) {\n      if (err) return handleCallback(callback, err, false);\n      _callback(null, true);\n    });\n  } else {\n    handleCallback(callback, MongoError.create({ message: f(\"authentication mechanism %s not supported\", options.authMechanism), driver: true }));\n  }\n};\n\nmodule.exports = function (self, username, password, options, callback) {\n  if (typeof options == 'function') callback = options, options = {};\n  // Shallow copy the options\n  options = shallowClone(options);\n\n  // Set default mechanism\n  if (!options.authMechanism) {\n    options.authMechanism = 'DEFAULT';\n  } else if (options.authMechanism != 'GSSAPI' && options.authMechanism != 'DEFAULT' && options.authMechanism != 'MONGODB-CR' && options.authMechanism != 'MONGODB-X509' && options.authMechanism != 'SCRAM-SHA-1' && options.authMechanism != 'PLAIN') {\n    return handleCallback(callback, MongoError.create({ message: \"only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, SCRAM-SHA-1 or MONGODB-CR is supported by authMechanism\", driver: true }));\n  }\n\n  // If we have a callback fallback\n  if (typeof callback == 'function') return authenticate(self, username, password, options, function (err, r) {\n    // Support failed auth method\n    if (err && err.message && err.message.indexOf('saslStart') != -1) err.code = 59;\n    // Reject error\n    if (err) return callback(err, r);\n    callback(null, r);\n  });\n\n  // Return a promise\n  return new self.s.promiseLibrary(function (resolve, reject) {\n    authenticate(self, username, password, options, function (err, r) {\n      // Support failed auth method\n      if (err && err.message && err.message.indexOf('saslStart') != -1) err.code = 59;\n      // Reject error\n      if (err) return reject(err);\n      resolve(r);\n    });\n  });\n};\n\n//# sourceMappingURL=authenticate-compiled.js.map"]}