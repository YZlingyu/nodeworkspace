{"version":3,"sources":["promise_array.js"],"names":[],"mappings":"AAAA;;AACA,OAAO,OAAP,GAAiB,UAAS,OAAT,EAAkB,QAAlB,EAA4B,mBAA5B,EACb,YADa,EACC;AAClB,QAAI,OAAO,QAAQ,WAAR,CAAX;AACA,QAAI,UAAU,KAAK,OAAnB;;AAEA,aAAS,iBAAT,CAA2B,GAA3B,EAAgC;AAC5B,gBAAO,GAAP;AACA,iBAAK,CAAC,CAAN;AAAS,uBAAO,EAAP;AACT,iBAAK,CAAC,CAAN;AAAS,uBAAO,EAAP;AAFT;AAIH;;AAED,aAAS,YAAT,CAAsB,MAAtB,EAA8B;AAC1B,YAAI,UAAU,KAAK,QAAL,GAAgB,IAAI,OAAJ,CAAY,QAAZ,CAA9B;AACA,YAAI,MAAJ;AACA,YAAI,kBAAkB,OAAtB,EAA+B;AAC3B,qBAAS,MAAT;AACA,oBAAQ,cAAR,CAAuB,MAAvB,EAA+B,IAAI,CAAnC;AACH;AACD,aAAK,OAAL,GAAe,MAAf;AACA,aAAK,OAAL,GAAe,CAAf;AACA,aAAK,cAAL,GAAsB,CAAtB;AACA,aAAK,KAAL,CAAW,SAAX,EAAsB,CAAC,CAAvB;AACH;AACD,iBAAa,SAAb,CAAuB,MAAvB,GAAgC,YAAY;AACxC,eAAO,KAAK,OAAZ;AACH,KAFD;;AAIA,iBAAa,SAAb,CAAuB,OAAvB,GAAiC,YAAY;AACzC,eAAO,KAAK,QAAZ;AACH,KAFD;;AAIA,iBAAa,SAAb,CAAuB,KAAvB,GAA+B,SAAS,IAAT,CAAc,CAAd,EAAiB,mBAAjB,EAAsC;AACjE,YAAI,SAAS,oBAAoB,KAAK,OAAzB,EAAkC,KAAK,QAAvC,CAAb;AACA,YAAI,kBAAkB,OAAtB,EAA+B;AAC3B,qBAAS,OAAO,OAAP,EAAT;AACA,iBAAK,OAAL,GAAe,MAAf;AACA,gBAAI,OAAO,YAAP,EAAJ,EAA2B;AACvB,yBAAS,OAAO,MAAP,EAAT;AACA,oBAAI,CAAC,QAAQ,MAAR,CAAL,EAAsB;AAClB,wBAAI,MAAM,IAAI,QAAQ,SAAZ,CAAsB,2FAAtB,CAAV;AACA,yBAAK,cAAL,CAAoB,GAApB;AACA;AACH;AACJ,aAPD,MAOO,IAAI,OAAO,UAAP,EAAJ,EAAyB;AAC5B,uBAAO,KAAP,CACI,IADJ,EAEI,KAAK,OAFT,EAGI,SAHJ,EAII,IAJJ,EAKI,mBALJ;AAOA;AACH,aATM,MASA;AACH,qBAAK,OAAL,CAAa,OAAO,OAAP,EAAb;AACA;AACH;AACJ,SAvBD,MAuBO,IAAI,CAAC,QAAQ,MAAR,CAAL,EAAsB;AACzB,iBAAK,QAAL,CAAc,OAAd,CAAsB,aAAa,2FAAb,EAA0G,OAA1G,EAAtB;AACA;AACH;;AAED,YAAI,OAAO,MAAP,KAAkB,CAAtB,EAAyB;AACrB,gBAAI,wBAAwB,CAAC,CAA7B,EAAgC;AAC5B,qBAAK,kBAAL;AACH,aAFD,MAGK;AACD,qBAAK,QAAL,CAAc,kBAAkB,mBAAlB,CAAd;AACH;AACD;AACH;AACD,YAAI,MAAM,KAAK,eAAL,CAAqB,OAAO,MAA5B,CAAV;AACA,aAAK,OAAL,GAAe,GAAf;AACA,aAAK,OAAL,GAAe,KAAK,gBAAL,KAA0B,IAAI,KAAJ,CAAU,GAAV,CAA1B,GAA2C,KAAK,OAA/D;AACA,YAAI,UAAU,KAAK,QAAnB;AACA,aAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,GAApB,EAAyB,EAAE,CAA3B,EAA8B;AAC1B,gBAAI,aAAa,KAAK,WAAL,EAAjB;AACA,gBAAI,eAAe,oBAAoB,OAAO,CAAP,CAApB,EAA+B,OAA/B,CAAnB;AACA,gBAAI,wBAAwB,OAA5B,EAAqC;AACjC,+BAAe,aAAa,OAAb,EAAf;AACA,oBAAI,UAAJ,EAAgB;AACZ,iCAAa,iBAAb;AACH,iBAFD,MAEO,IAAI,aAAa,UAAb,EAAJ,EAA+B;AAClC,iCAAa,kBAAb,CAAgC,IAAhC,EAAsC,CAAtC;AACH,iBAFM,MAEA,IAAI,aAAa,YAAb,EAAJ,EAAiC;AACpC,yBAAK,iBAAL,CAAuB,aAAa,MAAb,EAAvB,EAA8C,CAA9C;AACH,iBAFM,MAEA;AACH,yBAAK,gBAAL,CAAsB,aAAa,OAAb,EAAtB,EAA8C,CAA9C;AACH;AACJ,aAXD,MAWO,IAAI,CAAC,UAAL,EAAiB;AACpB,qBAAK,iBAAL,CAAuB,YAAvB,EAAqC,CAArC;AACH;AACJ;AACJ,KA7DD;;AA+DA,iBAAa,SAAb,CAAuB,WAAvB,GAAqC,YAAY;AAC7C,eAAO,KAAK,OAAL,KAAiB,IAAxB;AACH,KAFD;;AAIA,iBAAa,SAAb,CAAuB,QAAvB,GAAkC,UAAU,KAAV,EAAiB;AAC/C,aAAK,OAAL,GAAe,IAAf;AACA,aAAK,QAAL,CAAc,QAAd,CAAuB,KAAvB;AACH,KAHD;;AAKA,iBAAa,SAAb,CAAuB,cAAvB,GACA,aAAa,SAAb,CAAuB,OAAvB,GAAiC,UAAU,MAAV,EAAkB;AAC/C,aAAK,OAAL,GAAe,IAAf;AACA,aAAK,QAAL,CAAc,eAAd,CAA8B,MAA9B,EAAsC,KAAtC,EAA6C,IAA7C;AACH,KAJD;;AAMA,iBAAa,SAAb,CAAuB,kBAAvB,GAA4C,UAAU,aAAV,EAAyB,KAAzB,EAAgC;AACxE,aAAK,QAAL,CAAc,SAAd,CAAwB;AACpB,mBAAO,KADa;AAEpB,mBAAO;AAFa,SAAxB;AAIH,KALD;;AAQA,iBAAa,SAAb,CAAuB,iBAAvB,GAA2C,UAAU,KAAV,EAAiB,KAAjB,EAAwB;AAC/D,aAAK,OAAL,CAAa,KAAb,IAAsB,KAAtB;AACA,YAAI,gBAAgB,EAAE,KAAK,cAA3B;AACA,YAAI,iBAAiB,KAAK,OAA1B,EAAmC;AAC/B,iBAAK,QAAL,CAAc,KAAK,OAAnB;AACH;AACJ,KAND;;AAQA,iBAAa,SAAb,CAAuB,gBAAvB,GAA0C,UAAU,MAAV,EAAkB,KAAlB,EAAyB;AAC/D,aAAK,cAAL;AACA,aAAK,OAAL,CAAa,MAAb;AACH,KAHD;;AAKA,iBAAa,SAAb,CAAuB,gBAAvB,GAA0C,YAAY;AAClD,eAAO,IAAP;AACH,KAFD;;AAIA,iBAAa,SAAb,CAAuB,eAAvB,GAAyC,UAAU,GAAV,EAAe;AACpD,eAAO,GAAP;AACH,KAFD;;AAIA,WAAO,YAAP;AACC,CA5ID","file":"promise_array-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection) {\nvar util = require(\"./util.js\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    var parent;\n    if (values instanceof Promise) {\n        parent = values;\n        promise._propagateFrom(parent, 1 | 4);\n    }\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values = values._target();\n        this._values = values;\n        if (values._isFulfilled()) {\n            values = values._value();\n            if (!isArray(values)) {\n                var err = new Promise.TypeError(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\");\n                this.__hardReject__(err);\n                return;\n            }\n        } else if (values._isPending()) {\n            values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n            return;\n        } else {\n            this._reject(values._reason());\n            return;\n        }\n    } else if (!isArray(values)) {\n        this._promise._reject(apiRejection(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\")._reason());\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var promise = this._promise;\n    for (var i = 0; i < len; ++i) {\n        var isResolved = this._isResolved();\n        var maybePromise = tryConvertToPromise(values[i], promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (isResolved) {\n                maybePromise._ignoreRejections();\n            } else if (maybePromise._isPending()) {\n                maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                this._promiseFulfilled(maybePromise._value(), i);\n            } else {\n                this._promiseRejected(maybePromise._reason(), i);\n            }\n        } else if (!isResolved) {\n            this._promiseFulfilled(maybePromise, i);\n        }\n    }\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype.__hardReject__ =\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false, true);\n};\n\nPromiseArray.prototype._promiseProgressed = function (progressValue, index) {\n    this._promise._progress({\n        index: index,\n        value: progressValue\n    });\n};\n\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n    }\n};\n\nPromiseArray.prototype._promiseRejected = function (reason, index) {\n    this._totalResolved++;\n    this._reject(reason);\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n"]}