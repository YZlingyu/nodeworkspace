{"version":3,"sources":["join.js"],"names":[],"mappings":"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","file":"join-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL) {\nvar util = require(\"./util.js\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!false) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var caller = function(count) {\n        var values = [];\n        for (var i = 1; i <= count; ++i) values.push(\"holder.p\" + i);\n        return new Function(\"holder\", \"                                      \\n\\\n            'use strict';                                                    \\n\\\n            var callback = holder.fn;                                        \\n\\\n            return callback(values);                                         \\n\\\n            \".replace(/values/g, values.join(\", \")));\n    };\n    var thenCallbacks = [];\n    var callers = [undefined];\n    for (var i = 1; i <= 5; ++i) {\n        thenCallbacks.push(thenCallback(i));\n        callers.push(caller(i));\n    }\n\n    var Holder = function(total, fn) {\n        this.p1 = this.p2 = this.p3 = this.p4 = this.p5 = null;\n        this.fn = fn;\n        this.total = total;\n        this.now = 0;\n    };\n\n    Holder.prototype.callers = callers;\n    Holder.prototype.checkFulfillment = function(promise) {\n        var now = this.now;\n        now++;\n        var total = this.total;\n        if (now >= total) {\n            var handler = this.callers[total];\n            promise._pushContext();\n            var ret = tryCatch(handler)(this);\n            promise._popContext();\n            if (ret === errorObj) {\n                promise._rejectCallback(ret.e, false, true);\n            } else {\n                promise._resolveCallback(ret);\n            }\n        } else {\n            this.now = now;\n        }\n    };\n\n    var reject = function (reason) {\n        this._reject(reason);\n    };\n}\n}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!false) {\n            if (last < 6 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var holder = new Holder(last, fn);\n                var callbacks = thenCallbacks;\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        if (maybePromise._isPending()) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                        } else if (maybePromise._isFulfilled()) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else {\n                            ret._reject(maybePromise._reason());\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n                return ret;\n            }\n        }\n    }\n    var $_len = arguments.length;var args = new Array($_len); for(var $_i = 0; $_i < $_len; ++$_i) {args[$_i] = arguments[$_i];}\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n"]}