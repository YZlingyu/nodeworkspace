{"version":3,"sources":["finally.js"],"names":[],"mappings":"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","file":"finally-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, NEXT_FILTER, tryConvertToPromise) {\nvar util = require(\"./util.js\");\nvar isPrimitive = util.isPrimitive;\nvar thrower = util.thrower;\n\nfunction returnThis() {\n    return this;\n}\nfunction throwThis() {\n    throw this;\n}\nfunction return$(r) {\n    return function() {\n        return r;\n    };\n}\nfunction throw$(r) {\n    return function() {\n        throw r;\n    };\n}\nfunction promisedFinally(ret, reasonOrValue, isFulfilled) {\n    var then;\n    if (isPrimitive(reasonOrValue)) {\n        then = isFulfilled ? return$(reasonOrValue) : throw$(reasonOrValue);\n    } else {\n        then = isFulfilled ? returnThis : throwThis;\n    }\n    return ret._then(then, thrower, undefined, reasonOrValue, undefined);\n}\n\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundValue())\n                    : handler();\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, reasonOrValue,\n                                    promise.isFulfilled());\n        }\n    }\n\n    if (promise.isRejected()) {\n        NEXT_FILTER.e = reasonOrValue;\n        return NEXT_FILTER;\n    } else {\n        return reasonOrValue;\n    }\n}\n\nfunction tapHandler(value) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundValue(), value)\n                    : handler(value);\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, value, true);\n        }\n    }\n    return value;\n}\n\nPromise.prototype._passThroughHandler = function (handler, isFinally) {\n    if (typeof handler !== \"function\") return this.then();\n\n    var promiseAndHandler = {\n        promise: this,\n        handler: handler\n    };\n\n    return this._then(\n            isFinally ? finallyHandler : tapHandler,\n            isFinally ? finallyHandler : undefined, undefined,\n            promiseAndHandler, undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThroughHandler(handler, true);\n};\n\nPromise.prototype.tap = function (handler) {\n    return this._passThroughHandler(handler, false);\n};\n};\n"]}