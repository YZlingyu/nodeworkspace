{"version":3,"sources":["reduce.js"],"names":[],"mappings":"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","file":"reduce-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL) {\nvar getDomain = Promise._getDomain;\nvar async = require(\"./async.js\");\nvar util = require(\"./util.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nfunction ReductionPromiseArray(promises, fn, accum, _each) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    this._preservedValues = _each === INTERNAL ? [] : null;\n    this._zerothIsAccum = (accum === undefined);\n    this._gotAccum = false;\n    this._reducingIndex = (this._zerothIsAccum ? 1 : 0);\n    this._valuesPhase = undefined;\n    var maybePromise = tryConvertToPromise(accum, this._promise);\n    var rejected = false;\n    var isPromise = maybePromise instanceof Promise;\n    if (isPromise) {\n        maybePromise = maybePromise._target();\n        if (maybePromise._isPending()) {\n            maybePromise._proxyPromiseArray(this, -1);\n        } else if (maybePromise._isFulfilled()) {\n            accum = maybePromise._value();\n            this._gotAccum = true;\n        } else {\n            this._reject(maybePromise._reason());\n            rejected = true;\n        }\n    }\n    if (!(isPromise || this._zerothIsAccum)) this._gotAccum = true;\n    var domain = getDomain();\n    this._callback = domain === null ? fn : domain.bind(fn);\n    this._accum = accum;\n    if (!rejected) async.invoke(init, this, undefined);\n}\nfunction init() {\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._init = function () {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function () {\n    if (this._gotAccum || this._zerothIsAccum) {\n        this._resolve(this._preservedValues !== null\n                        ? [] : this._accum);\n    }\n};\n\nReductionPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    values[index] = value;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var isEach = preservedValues !== null;\n    var gotAccum = this._gotAccum;\n    var valuesPhase = this._valuesPhase;\n    var valuesPhaseIndex;\n    if (!valuesPhase) {\n        valuesPhase = this._valuesPhase = new Array(length);\n        for (valuesPhaseIndex=0; valuesPhaseIndex<length; ++valuesPhaseIndex) {\n            valuesPhase[valuesPhaseIndex] = 0;\n        }\n    }\n    valuesPhaseIndex = valuesPhase[index];\n\n    if (index === 0 && this._zerothIsAccum) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n        valuesPhase[index] = ((valuesPhaseIndex === 0)\n            ? 1 : 2);\n    } else if (index === -1) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n    } else {\n        if (valuesPhaseIndex === 0) {\n            valuesPhase[index] = 1;\n        } else {\n            valuesPhase[index] = 2;\n            this._accum = value;\n        }\n    }\n    if (!gotAccum) return;\n\n    var callback = this._callback;\n    var receiver = this._promise._boundValue();\n    var ret;\n\n    for (var i = this._reducingIndex; i < length; ++i) {\n        valuesPhaseIndex = valuesPhase[i];\n        if (valuesPhaseIndex === 2) {\n            this._reducingIndex = i + 1;\n            continue;\n        }\n        if (valuesPhaseIndex !== 1) return;\n        value = values[i];\n        this._promise._pushContext();\n        if (isEach) {\n            preservedValues.push(value);\n            ret = tryCatch(callback).call(receiver, value, i, length);\n        }\n        else {\n            ret = tryCatch(callback)\n                .call(receiver, this._accum, value, i, length);\n        }\n        this._promise._popContext();\n\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (maybePromise._isPending()) {\n                valuesPhase[i] = 4;\n                return maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                ret = maybePromise._value();\n            } else {\n                return this._reject(maybePromise._reason());\n            }\n        }\n\n        this._reducingIndex = i + 1;\n        this._accum = ret;\n    }\n\n    this._resolve(isEach ? preservedValues : this._accum);\n};\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n};\n"]}