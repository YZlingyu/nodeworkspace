{"version":3,"sources":["polling.js"],"names":[],"mappings":";AACA;;;;AAIA,IAAI,YAAY,QAAQ,cAAR,CAAhB;AACA,IAAI,SAAS,QAAQ,kBAAR,CAAb;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,UAAU,QAAQ,SAAR,CAAd;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,QAAQ,QAAQ,OAAR,EAAiB,gBAAjB,CAAZ;;AAEA,IAAI,qBAAqB;AACvB,QAAM,KAAK,UADY;AAEvB,WAAS,KAAK;AAFS,CAAzB;;AAKA;;;;AAIA,OAAO,OAAP,GAAiB,OAAjB;;AAEA;;;;;;AAMA,SAAS,OAAT,CAAkB,GAAlB,EAAuB;AACrB,YAAU,IAAV,CAAe,IAAf,EAAqB,GAArB;;AAEA,OAAK,YAAL,GAAoB,KAAK,IAAzB;AACA,OAAK,iBAAL,GAAyB,IAAzB;AACA,OAAK,eAAL,GAAuB,IAAvB;AACD;;AAED;;;;;;AAMA,KAAK,QAAL,CAAc,OAAd,EAAuB,SAAvB;;AAEA;;;;;;AAMA,QAAQ,SAAR,CAAkB,IAAlB,GAAyB,SAAzB;;AAEA;;;;;;;AAOA,QAAQ,SAAR,CAAkB,SAAlB,GAA8B,UAAU,GAAV,EAAe;AAC3C,MAAI,MAAM,IAAI,GAAd;;AAEA,MAAI,UAAU,IAAI,MAAlB,EAA0B;AACxB,SAAK,aAAL,CAAmB,GAAnB,EAAwB,GAAxB;AACD,GAFD,MAEO,IAAI,WAAW,IAAI,MAAnB,EAA2B;AAChC,SAAK,aAAL,CAAmB,GAAnB,EAAwB,GAAxB;AACD,GAFM,MAEA;AACL,QAAI,SAAJ,CAAc,GAAd;AACA,QAAI,GAAJ;AACD;AACF,CAXD;;AAaA;;;;;;AAMA,QAAQ,SAAR,CAAkB,aAAlB,GAAkC,UAAU,GAAV,EAAe,GAAf,EAAoB;AACpD,MAAI,KAAK,GAAT,EAAc;AACZ,UAAM,iBAAN;AACA;AACA,SAAK,OAAL,CAAa,qBAAb;AACA,QAAI,SAAJ,CAAc,GAAd;AACA,QAAI,GAAJ;AACA;AACD;;AAED,QAAM,iBAAN;;AAEA,OAAK,GAAL,GAAW,GAAX;AACA,OAAK,GAAL,GAAW,GAAX;;AAEA,MAAI,OAAO,IAAX;;AAEA,WAAS,OAAT,GAAoB;AAClB,SAAK,OAAL,CAAa,oCAAb;AACD;;AAED,WAAS,OAAT,GAAoB;AAClB,QAAI,cAAJ,CAAmB,OAAnB,EAA4B,OAA5B;AACA,SAAK,GAAL,GAAW,KAAK,GAAL,GAAW,IAAtB;AACD;;AAED,MAAI,OAAJ,GAAc,OAAd;AACA,MAAI,EAAJ,CAAO,OAAP,EAAgB,OAAhB;;AAEA,OAAK,QAAL,GAAgB,IAAhB;AACA,OAAK,IAAL,CAAU,OAAV;;AAEA;AACA,MAAI,KAAK,QAAL,IAAiB,KAAK,WAA1B,EAAuC;AACrC,UAAM,8CAAN;AACA,SAAK,IAAL,CAAU,CAAC,EAAE,MAAM,MAAR,EAAD,CAAV;AACD;AACF,CArCD;;AAuCA;;;;;;AAMA,QAAQ,SAAR,CAAkB,aAAlB,GAAkC,UAAU,GAAV,EAAe,GAAf,EAAoB;AACpD,MAAI,KAAK,OAAT,EAAkB;AAChB;AACA,SAAK,OAAL,CAAa,kCAAb;AACA,QAAI,SAAJ,CAAc,GAAd;AACA,QAAI,GAAJ;AACA;AACD;;AAED,MAAI,WAAW,+BAA+B,IAAI,OAAJ,CAAY,cAAZ,CAA9C;;AAEA,OAAK,OAAL,GAAe,GAAf;AACA,OAAK,OAAL,GAAe,GAAf;;AAEA,MAAI,SAAS,WAAW,IAAI,MAAJ,CAAW,CAAX,CAAX,GAA2B,EAAxC;AACA,MAAI,OAAO,IAAX;;AAEA,WAAS,OAAT,GAAoB;AAClB,aAAS,WAAW,IAAI,MAAJ,CAAW,CAAX,CAAX,GAA2B,EAApC;AACA,QAAI,cAAJ,CAAmB,MAAnB,EAA2B,MAA3B;AACA,QAAI,cAAJ,CAAmB,KAAnB,EAA0B,KAA1B;AACA,QAAI,cAAJ,CAAmB,OAAnB,EAA4B,OAA5B;AACA,SAAK,OAAL,GAAe,KAAK,OAAL,GAAe,IAA9B;AACD;;AAED,WAAS,OAAT,GAAoB;AAClB;AACA,SAAK,OAAL,CAAa,4CAAb;AACD;;AAED,WAAS,MAAT,CAAiB,IAAjB,EAAuB;AACrB,QAAI,aAAJ;AACA,QAAI,OAAO,IAAP,KAAgB,QAApB,EAA8B;AAC5B,gBAAU,IAAV;AACA,sBAAgB,OAAO,UAAP,CAAkB,MAAlB,CAAhB;AACD,KAHD,MAGO;AACL,eAAS,OAAO,MAAP,CAAc,CAAC,MAAD,EAAS,IAAT,CAAd,CAAT;AACA,sBAAgB,OAAO,MAAvB;AACD;;AAED,QAAI,gBAAgB,KAAK,iBAAzB,EAA4C;AAC1C,eAAS,EAAT;AACA,UAAI,UAAJ,CAAe,OAAf;AACD;AACF;;AAED,WAAS,KAAT,GAAkB;AAChB,SAAK,MAAL,CAAY,MAAZ;;AAEA,QAAI,UAAU;AACZ;AACA;AACA,sBAAgB,WAHJ;AAIZ,wBAAkB;AAJN,KAAd;;AAOA,QAAI,SAAJ,CAAc,GAAd,EAAmB,KAAK,OAAL,CAAa,GAAb,EAAkB,OAAlB,CAAnB;AACA,QAAI,GAAJ,CAAQ,IAAR;AACA;AACD;;AAED,MAAI,EAAJ,CAAO,OAAP,EAAgB,OAAhB;AACA,MAAI,CAAC,QAAL,EAAe,IAAI,WAAJ,CAAgB,MAAhB;AACf,MAAI,EAAJ,CAAO,MAAP,EAAe,MAAf;AACA,MAAI,EAAJ,CAAO,KAAP,EAAc,KAAd;AACD,CAjED;;AAmEA;;;;;;;AAOA,QAAQ,SAAR,CAAkB,MAAlB,GAA2B,UAAU,IAAV,EAAgB;AACzC,QAAM,eAAN,EAAuB,IAAvB;AACA,MAAI,OAAO,IAAX;AACA,MAAI,WAAW,UAAU,MAAV,EAAkB;AAC/B,QAAI,YAAY,OAAO,IAAvB,EAA6B;AAC3B,YAAM,sBAAN;AACA,WAAK,OAAL;AACA,aAAO,KAAP;AACD;;AAED,SAAK,QAAL,CAAc,MAAd;AACD,GARD;;AAUA,SAAO,aAAP,CAAqB,IAArB,EAA2B,QAA3B;AACD,CAdD;;AAgBA;;;;;;AAMA,QAAQ,SAAR,CAAkB,OAAlB,GAA4B,YAAY;AACtC,MAAI,KAAK,QAAT,EAAmB;AACjB;AACA,SAAK,IAAL,CAAU,CAAC,EAAE,MAAM,MAAR,EAAD,CAAV;AACD;AACD,YAAU,SAAV,CAAoB,OAApB,CAA4B,IAA5B,CAAiC,IAAjC;AACD,CAND;;AAQA;;;;;;;AAOA,QAAQ,SAAR,CAAkB,IAAlB,GAAyB,UAAU,OAAV,EAAmB;AAC1C,OAAK,QAAL,GAAgB,KAAhB;;AAEA,MAAI,KAAK,WAAT,EAAsB;AACpB,UAAM,mCAAN;AACA,YAAQ,IAAR,CAAa,EAAE,MAAM,OAAR,EAAb;AACA,SAAK,WAAL;AACA,SAAK,WAAL,GAAmB,IAAnB;AACD;;AAED,MAAI,OAAO,IAAX;AACA,SAAO,aAAP,CAAqB,OAArB,EAA8B,KAAK,cAAnC,EAAmD,UAAU,IAAV,EAAgB;AACjE,QAAI,WAAW,QAAQ,IAAR,CAAa,UAAU,MAAV,EAAkB;AAC5C,aAAO,OAAO,OAAP,IAAkB,OAAO,OAAP,CAAe,QAAxC;AACD,KAFc,CAAf;AAGA,SAAK,KAAL,CAAW,IAAX,EAAiB,EAAE,UAAU,QAAZ,EAAjB;AACD,GALD;AAMD,CAjBD;;AAmBA;;;;;;;;AAQA,QAAQ,SAAR,CAAkB,KAAlB,GAA0B,UAAU,IAAV,EAAgB,OAAhB,EAAyB;AACjD,QAAM,cAAN,EAAsB,IAAtB;AACA,MAAI,OAAO,IAAX;AACA,OAAK,OAAL,CAAa,IAAb,EAAmB,OAAnB,EAA4B,YAAY;AACtC,SAAK,GAAL,CAAS,OAAT;AACD,GAFD;AAGD,CAND;;AAQA;;;;;;AAMA,QAAQ,SAAR,CAAkB,OAAlB,GAA4B,UAAU,IAAV,EAAgB,OAAhB,EAAyB,QAAzB,EAAmC;AAC7D,MAAI,OAAO,IAAX;;AAEA;AACA,MAAI,WAAW,OAAO,IAAP,KAAgB,QAA/B;AACA,MAAI,cAAc,WACd,2BADc,GAEd,0BAFJ;;AAIA,MAAI,UAAU;AACZ,oBAAgB;AADJ,GAAd;;AAIA,MAAI,CAAC,KAAK,eAAN,IAAyB,CAAC,QAAQ,QAAtC,EAAgD;AAC9C,YAAQ,IAAR;AACA;AACD;;AAED,MAAI,MAAM,WAAW,OAAO,UAAP,CAAkB,IAAlB,CAAX,GAAqC,KAAK,MAApD;AACA,MAAI,MAAM,KAAK,eAAL,CAAqB,SAA/B,EAA0C;AACxC,YAAQ,IAAR;AACA;AACD;;AAED,MAAI,WAAW,QAAQ,KAAK,GAAb,EAAkB,SAAlB,CAA4B,CAAC,MAAD,EAAS,SAAT,CAA5B,CAAf;AACA,MAAI,CAAC,QAAL,EAAe;AACb,YAAQ,IAAR;AACA;AACD;;AAED,OAAK,QAAL,CAAc,IAAd,EAAoB,QAApB,EAA8B,UAAU,GAAV,EAAe,IAAf,EAAqB;AACjD,QAAI,GAAJ,EAAS;AACP,WAAK,GAAL,CAAS,SAAT,CAAmB,GAAnB;AACA,WAAK,GAAL,CAAS,GAAT;AACA,eAAS,GAAT;AACA;AACD;;AAED,YAAQ,kBAAR,IAA8B,QAA9B;AACA,YAAQ,IAAR;AACD,GAVD;;AAYA,WAAS,OAAT,CAAkB,IAAlB,EAAwB;AACtB,YAAQ,gBAAR,IAA4B,aAAa,OAAO,IAApB,GAA2B,OAAO,UAAP,CAAkB,IAAlB,CAA3B,GAAqD,KAAK,MAAtF;AACA,SAAK,GAAL,CAAS,SAAT,CAAmB,GAAnB,EAAwB,KAAK,OAAL,CAAa,KAAK,GAAlB,EAAuB,OAAvB,CAAxB;AACA,SAAK,GAAL,CAAS,GAAT,CAAa,IAAb;AACA;AACD;AACF,CAhDD;;AAkDA;;;;;;AAMA,QAAQ,SAAR,CAAkB,QAAlB,GAA6B,UAAU,IAAV,EAAgB,QAAhB,EAA0B,QAA1B,EAAoC;AAC/D,QAAM,aAAN;;AAEA,MAAI,UAAU,EAAd;AACA,MAAI,QAAQ,CAAZ;;AAEA,qBAAmB,QAAnB,EAA6B,KAAK,eAAlC,EACG,EADH,CACM,OADN,EACe,QADf,EAEG,EAFH,CAEM,MAFN,EAEc,UAAU,KAAV,EAAiB;AAC3B,YAAQ,IAAR,CAAa,KAAb;AACA,aAAS,MAAM,MAAf;AACD,GALH,EAMG,EANH,CAMM,KANN,EAMa,YAAY;AACrB,aAAS,IAAT,EAAe,OAAO,MAAP,CAAc,OAAd,EAAuB,KAAvB,CAAf;AACD,GARH,EASG,GATH,CASO,IATP;AAUD,CAhBD;;AAkBA;;;;;;AAMA,QAAQ,SAAR,CAAkB,OAAlB,GAA4B,UAAU,EAAV,EAAc;AACxC,QAAM,SAAN;;AAEA,MAAI,OAAO,IAAX;AACA,MAAI,iBAAJ;;AAEA,MAAI,KAAK,OAAT,EAAkB;AAChB,UAAM,+BAAN;AACA,SAAK,OAAL,CAAa,OAAb;AACD;;AAED,MAAI,KAAK,QAAT,EAAmB;AACjB,UAAM,yCAAN;AACA,SAAK,IAAL,CAAU,CAAC,EAAE,MAAM,OAAR,EAAD,CAAV;AACA;AACD,GAJD,MAIO,IAAI,KAAK,SAAT,EAAoB;AACzB,UAAM,0CAAN;AACA;AACD,GAHM,MAGA;AACL,UAAM,kDAAN;AACA,SAAK,WAAL,GAAmB,OAAnB;AACA,wBAAoB,WAAW,OAAX,EAAoB,KAAK,YAAzB,CAApB;AACD;;AAED,WAAS,OAAT,GAAoB;AAClB,iBAAa,iBAAb;AACA;AACA,SAAK,OAAL;AACD;AACF,CA7BD;;AA+BA;;;;;;;;AAQA,QAAQ,SAAR,CAAkB,OAAlB,GAA4B,UAAU,GAAV,EAAe,OAAf,EAAwB;AAClD,YAAU,WAAW,EAArB;;AAEA;AACA;AACA,MAAI,KAAK,IAAI,OAAJ,CAAY,YAAZ,CAAT;AACA,MAAI,OAAO,CAAC,GAAG,OAAH,CAAW,OAAX,CAAD,IAAwB,CAAC,GAAG,OAAH,CAAW,UAAX,CAAhC,CAAJ,EAA6D;AAC3D,YAAQ,kBAAR,IAA8B,GAA9B;AACD;;AAED,OAAK,IAAL,CAAU,SAAV,EAAqB,OAArB;AACA,SAAO,OAAP;AACD,CAZD","file":"polling-compiled.js","sourcesContent":["\n/**\n * Module requirements.\n */\n\nvar Transport = require('../transport');\nvar parser = require('engine.io-parser');\nvar zlib = require('zlib');\nvar accepts = require('accepts');\nvar util = require('util');\nvar debug = require('debug')('engine:polling');\n\nvar compressionMethods = {\n  gzip: zlib.createGzip,\n  deflate: zlib.createDeflate\n};\n\n/**\n * Exports the constructor.\n */\n\nmodule.exports = Polling;\n\n/**\n * HTTP polling constructor.\n *\n * @api public.\n */\n\nfunction Polling (req) {\n  Transport.call(this, req);\n\n  this.closeTimeout = 30 * 1000;\n  this.maxHttpBufferSize = null;\n  this.httpCompression = null;\n}\n\n/**\n * Inherits from Transport.\n *\n * @api public.\n */\n\nutil.inherits(Polling, Transport);\n\n/**\n * Transport name\n *\n * @api public\n */\n\nPolling.prototype.name = 'polling';\n\n/**\n * Overrides onRequest.\n *\n * @param {http.IncomingMessage}\n * @api private\n */\n\nPolling.prototype.onRequest = function (req) {\n  var res = req.res;\n\n  if ('GET' === req.method) {\n    this.onPollRequest(req, res);\n  } else if ('POST' === req.method) {\n    this.onDataRequest(req, res);\n  } else {\n    res.writeHead(500);\n    res.end();\n  }\n};\n\n/**\n * The client sends a request awaiting for us to send data.\n *\n * @api private\n */\n\nPolling.prototype.onPollRequest = function (req, res) {\n  if (this.req) {\n    debug('request overlap');\n    // assert: this.res, '.req and .res should be (un)set together'\n    this.onError('overlap from client');\n    res.writeHead(500);\n    res.end();\n    return;\n  }\n\n  debug('setting request');\n\n  this.req = req;\n  this.res = res;\n\n  var self = this;\n\n  function onClose () {\n    self.onError('poll connection closed prematurely');\n  }\n\n  function cleanup () {\n    req.removeListener('close', onClose);\n    self.req = self.res = null;\n  }\n\n  req.cleanup = cleanup;\n  req.on('close', onClose);\n\n  this.writable = true;\n  this.emit('drain');\n\n  // if we're still writable but had a pending close, trigger an empty send\n  if (this.writable && this.shouldClose) {\n    debug('triggering empty send to append close packet');\n    this.send([{ type: 'noop' }]);\n  }\n};\n\n/**\n * The client sends a request with data.\n *\n * @api private\n */\n\nPolling.prototype.onDataRequest = function (req, res) {\n  if (this.dataReq) {\n    // assert: this.dataRes, '.dataReq and .dataRes should be (un)set together'\n    this.onError('data request overlap from client');\n    res.writeHead(500);\n    res.end();\n    return;\n  }\n\n  var isBinary = 'application/octet-stream' === req.headers['content-type'];\n\n  this.dataReq = req;\n  this.dataRes = res;\n\n  var chunks = isBinary ? new Buffer(0) : '';\n  var self = this;\n\n  function cleanup () {\n    chunks = isBinary ? new Buffer(0) : '';\n    req.removeListener('data', onData);\n    req.removeListener('end', onEnd);\n    req.removeListener('close', onClose);\n    self.dataReq = self.dataRes = null;\n  }\n\n  function onClose () {\n    cleanup();\n    self.onError('data request connection closed prematurely');\n  }\n\n  function onData (data) {\n    var contentLength;\n    if (typeof data === 'string') {\n      chunks += data;\n      contentLength = Buffer.byteLength(chunks);\n    } else {\n      chunks = Buffer.concat([chunks, data]);\n      contentLength = chunks.length;\n    }\n\n    if (contentLength > self.maxHttpBufferSize) {\n      chunks = '';\n      req.connection.destroy();\n    }\n  }\n\n  function onEnd () {\n    self.onData(chunks);\n\n    var headers = {\n      // text/html is required instead of text/plain to avoid an\n      // unwanted download dialog on certain user-agents (GH-43)\n      'Content-Type': 'text/html',\n      'Content-Length': 2\n    };\n\n    res.writeHead(200, self.headers(req, headers));\n    res.end('ok');\n    cleanup();\n  }\n\n  req.on('close', onClose);\n  if (!isBinary) req.setEncoding('utf8');\n  req.on('data', onData);\n  req.on('end', onEnd);\n};\n\n/**\n * Processes the incoming data payload.\n *\n * @param {String} encoded payload\n * @api private\n */\n\nPolling.prototype.onData = function (data) {\n  debug('received \"%s\"', data);\n  var self = this;\n  var callback = function (packet) {\n    if ('close' === packet.type) {\n      debug('got xhr close packet');\n      self.onClose();\n      return false;\n    }\n\n    self.onPacket(packet);\n  };\n\n  parser.decodePayload(data, callback);\n};\n\n/**\n * Overrides onClose.\n *\n * @api private\n */\n\nPolling.prototype.onClose = function () {\n  if (this.writable) {\n    // close pending poll request\n    this.send([{ type: 'noop' }]);\n  }\n  Transport.prototype.onClose.call(this);\n};\n\n/**\n * Writes a packet payload.\n *\n * @param {Object} packet\n * @api private\n */\n\nPolling.prototype.send = function (packets) {\n  this.writable = false;\n\n  if (this.shouldClose) {\n    debug('appending close packet to payload');\n    packets.push({ type: 'close' });\n    this.shouldClose();\n    this.shouldClose = null;\n  }\n\n  var self = this;\n  parser.encodePayload(packets, this.supportsBinary, function (data) {\n    var compress = packets.some(function (packet) {\n      return packet.options && packet.options.compress;\n    });\n    self.write(data, { compress: compress });\n  });\n};\n\n/**\n * Writes data as response to poll request.\n *\n * @param {String} data\n * @param {Object} options\n * @api private\n */\n\nPolling.prototype.write = function (data, options) {\n  debug('writing \"%s\"', data);\n  var self = this;\n  this.doWrite(data, options, function () {\n    self.req.cleanup();\n  });\n};\n\n/**\n * Performs the write.\n *\n * @api private\n */\n\nPolling.prototype.doWrite = function (data, options, callback) {\n  var self = this;\n\n  // explicit UTF-8 is required for pages not served under utf\n  var isString = typeof data === 'string';\n  var contentType = isString\n    ? 'text/plain; charset=UTF-8'\n    : 'application/octet-stream';\n\n  var headers = {\n    'Content-Type': contentType\n  };\n\n  if (!this.httpCompression || !options.compress) {\n    respond(data);\n    return;\n  }\n\n  var len = isString ? Buffer.byteLength(data) : data.length;\n  if (len < this.httpCompression.threshold) {\n    respond(data);\n    return;\n  }\n\n  var encoding = accepts(this.req).encodings(['gzip', 'deflate']);\n  if (!encoding) {\n    respond(data);\n    return;\n  }\n\n  this.compress(data, encoding, function (err, data) {\n    if (err) {\n      self.res.writeHead(500);\n      self.res.end();\n      callback(err);\n      return;\n    }\n\n    headers['Content-Encoding'] = encoding;\n    respond(data);\n  });\n\n  function respond (data) {\n    headers['Content-Length'] = 'string' === typeof data ? Buffer.byteLength(data) : data.length;\n    self.res.writeHead(200, self.headers(self.req, headers));\n    self.res.end(data);\n    callback();\n  }\n};\n\n/**\n * Comparesses data.\n *\n * @api private\n */\n\nPolling.prototype.compress = function (data, encoding, callback) {\n  debug('compressing');\n\n  var buffers = [];\n  var nread = 0;\n\n  compressionMethods[encoding](this.httpCompression)\n    .on('error', callback)\n    .on('data', function (chunk) {\n      buffers.push(chunk);\n      nread += chunk.length;\n    })\n    .on('end', function () {\n      callback(null, Buffer.concat(buffers, nread));\n    })\n    .end(data);\n};\n\n/**\n * Closes the transport.\n *\n * @api private\n */\n\nPolling.prototype.doClose = function (fn) {\n  debug('closing');\n\n  var self = this;\n  var closeTimeoutTimer;\n\n  if (this.dataReq) {\n    debug('aborting ongoing data request');\n    this.dataReq.destroy();\n  }\n\n  if (this.writable) {\n    debug('transport writable - closing right away');\n    this.send([{ type: 'close' }]);\n    onClose();\n  } else if (this.discarded) {\n    debug('transport discarded - closing right away');\n    onClose();\n  } else {\n    debug('transport not writable - buffering orderly close');\n    this.shouldClose = onClose;\n    closeTimeoutTimer = setTimeout(onClose, this.closeTimeout);\n  }\n\n  function onClose () {\n    clearTimeout(closeTimeoutTimer);\n    fn();\n    self.onClose();\n  }\n};\n\n/**\n * Returns headers for a response.\n *\n * @param {http.IncomingMessage} request\n * @param {Object} extra headers\n * @api private\n */\n\nPolling.prototype.headers = function (req, headers) {\n  headers = headers || {};\n\n  // prevent XSS warnings on IE\n  // https://github.com/LearnBoost/socket.io/pull/1333\n  var ua = req.headers['user-agent'];\n  if (ua && (~ua.indexOf(';MSIE') || ~ua.indexOf('Trident/'))) {\n    headers['X-XSS-Protection'] = '0';\n  }\n\n  this.emit('headers', headers);\n  return headers;\n};\n"]}