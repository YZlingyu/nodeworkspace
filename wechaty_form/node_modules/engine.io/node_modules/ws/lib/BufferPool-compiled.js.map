{"version":3,"sources":["BufferPool.js"],"names":[],"mappings":"AAAA;;;;;;AAMA,IAAI,OAAO,QAAQ,MAAR,CAAX;;AAEA,SAAS,UAAT,CAAoB,WAApB,EAAiC,YAAjC,EAA+C,cAA/C,EAA+D;AAC7D,MAAI,gBAAgB,UAAhB,KAA+B,KAAnC,EAA0C;AACxC,UAAM,IAAI,SAAJ,CAAc,kCAAd,CAAN;AACD;;AAED,MAAI,OAAO,WAAP,KAAuB,UAA3B,EAAuC;AACrC,qBAAiB,YAAjB;AACA,mBAAe,WAAf;AACA,kBAAc,CAAd;AACD,GAJD,MAKK,IAAI,OAAO,WAAP,KAAuB,WAA3B,EAAwC;AAC3C,kBAAc,CAAd;AACD;AACD,OAAK,aAAL,GAAqB,CAAC,gBAAgB,UAAS,EAAT,EAAa,IAAb,EAAmB;AACvD,WAAO,GAAG,IAAH,GAAU,IAAjB;AACD,GAFoB,EAElB,IAFkB,CAEb,IAFa,EAEP,IAFO,CAArB;AAGA,OAAK,eAAL,GAAuB,CAAC,kBAAkB,UAAS,EAAT,EAAa;AACrD,WAAO,WAAP;AACD,GAFsB,EAEpB,IAFoB,CAEf,IAFe,EAET,IAFS,CAAvB;AAGA,OAAK,OAAL,GAAe,cAAc,IAAI,MAAJ,CAAW,WAAX,CAAd,GAAwC,IAAvD;AACA,OAAK,OAAL,GAAe,CAAf;AACA,OAAK,KAAL,GAAa,CAAb;AACA,OAAK,aAAL,GAAqB,CAArB;AACA,OAAK,gBAAL,CAAsB,MAAtB,EAA8B,YAAU;AACtC,WAAO,KAAK,OAAL,IAAgB,IAAhB,GAAuB,CAAvB,GAA2B,KAAK,OAAL,CAAa,MAA/C;AACD,GAFD;AAGA,OAAK,gBAAL,CAAsB,MAAtB,EAA8B,YAAU;AACtC,WAAO,KAAK,KAAZ;AACD,GAFD;AAGD;;AAED,WAAW,SAAX,CAAqB,GAArB,GAA2B,UAAS,MAAT,EAAiB;AAC1C,MAAI,KAAK,OAAL,IAAgB,IAAhB,IAAwB,KAAK,OAAL,GAAe,MAAf,GAAwB,KAAK,OAAL,CAAa,MAAjE,EAAyE;AACvE,QAAI,SAAS,IAAI,MAAJ,CAAW,KAAK,aAAL,CAAmB,MAAnB,CAAX,CAAb;AACA,SAAK,OAAL,GAAe,MAAf;AACA,SAAK,OAAL,GAAe,CAAf;AACD;AACD,OAAK,KAAL,IAAc,MAAd;AACA,MAAI,MAAM,KAAK,OAAL,CAAa,KAAb,CAAmB,KAAK,OAAxB,EAAiC,KAAK,OAAL,GAAe,MAAhD,CAAV;AACA,OAAK,OAAL,IAAgB,MAAhB;AACA,SAAO,GAAP;AACD,CAVD;;AAYA,WAAW,SAAX,CAAqB,KAArB,GAA6B,UAAS,cAAT,EAAyB;AACpD,MAAI,MAAM,KAAK,eAAL,EAAV;AACA,MAAI,MAAM,KAAK,IAAf,EAAqB,KAAK,aAAL,IAAsB,CAAtB;AACrB,MAAI,kBAAkB,KAAK,aAAL,GAAqB,CAAC,CAA5C,EAA+C;AAC7C,SAAK,aAAL,GAAqB,CAArB;AACA,SAAK,OAAL,GAAe,MAAM,IAAI,MAAJ,CAAW,GAAX,CAAN,GAAwB,IAAvC;AACD;AACD,OAAK,OAAL,GAAe,CAAf;AACA,OAAK,KAAL,GAAa,CAAb;AACD,CATD;;AAWA,OAAO,OAAP,GAAiB,UAAjB","file":"BufferPool-compiled.js","sourcesContent":["/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar util = require('util');\n\nfunction BufferPool(initialSize, growStrategy, shrinkStrategy) {\n  if (this instanceof BufferPool === false) {\n    throw new TypeError(\"Classes can't be function-called\");\n  }\n\n  if (typeof initialSize === 'function') {\n    shrinkStrategy = growStrategy;\n    growStrategy = initialSize;\n    initialSize = 0;\n  }\n  else if (typeof initialSize === 'undefined') {\n    initialSize = 0;\n  }\n  this._growStrategy = (growStrategy || function(db, size) {\n    return db.used + size;\n  }).bind(null, this);\n  this._shrinkStrategy = (shrinkStrategy || function(db) {\n    return initialSize;\n  }).bind(null, this);\n  this._buffer = initialSize ? new Buffer(initialSize) : null;\n  this._offset = 0;\n  this._used = 0;\n  this._changeFactor = 0;\n  this.__defineGetter__('size', function(){\n    return this._buffer == null ? 0 : this._buffer.length;\n  });\n  this.__defineGetter__('used', function(){\n    return this._used;\n  });\n}\n\nBufferPool.prototype.get = function(length) {\n  if (this._buffer == null || this._offset + length > this._buffer.length) {\n    var newBuf = new Buffer(this._growStrategy(length));\n    this._buffer = newBuf;\n    this._offset = 0;\n  }\n  this._used += length;\n  var buf = this._buffer.slice(this._offset, this._offset + length);\n  this._offset += length;\n  return buf;\n}\n\nBufferPool.prototype.reset = function(forceNewBuffer) {\n  var len = this._shrinkStrategy();\n  if (len < this.size) this._changeFactor -= 1;\n  if (forceNewBuffer || this._changeFactor < -2) {\n    this._changeFactor = 0;\n    this._buffer = len ? new Buffer(len) : null;\n  }\n  this._offset = 0;\n  this._used = 0;\n}\n\nmodule.exports = BufferPool;\n"]}