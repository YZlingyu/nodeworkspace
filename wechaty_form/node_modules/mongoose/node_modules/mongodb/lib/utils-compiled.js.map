{"version":3,"sources":["utils.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,aAAa,QAAQ,cAAR,EAAwB,UAAzC;AAAA,IACE,iBAAiB,QAAQ,mBAAR,CADnB;AAAA,IAEE,qBAAqB,QAAQ,cAAR,EAAwB,cAF/C;;AAIA,IAAI,eAAe,UAAS,GAAT,EAAc;AAC/B,MAAI,OAAO,EAAX;AACA,OAAI,IAAI,IAAR,IAAgB,GAAhB,EAAqB,KAAK,IAAL,IAAa,IAAI,IAAJ,CAAb;AACrB,SAAO,IAAP;AACD,CAJD;;AAMA;AACA,IAAI,oBAAoB,UAAS,OAAT,EAAkB;AACxC,MAAI,IAAI,IAAR;AACA,MAAG,QAAQ,cAAX,EAA2B;AACzB,QAAI,QAAQ,cAAZ;AACD,GAFD,MAEO;AACL,WAAO,OAAP;AACD;;AAED,MAAG,aAAa,cAAhB,EAAgC;AAC9B,YAAQ,cAAR,GAAyB,IAAI,kBAAJ,CAAuB,EAAE,IAAzB,EAA+B,EAAE,IAAjC,EAAuC,EAAC,qBAAqB,EAAE,mBAAxB,EAAvC,CAAzB;AACD,GAFD,MAEO,IAAG,OAAO,CAAP,IAAY,QAAf,EAAyB;AAC9B,YAAQ,cAAR,GAAyB,IAAI,kBAAJ,CAAuB,CAAvB,CAAzB;AACD,GAFM,MAEA,IAAG,KAAK,EAAE,aAAa,cAAf,CAAL,IAAuC,OAAO,CAAP,IAAY,QAAtD,EAAgE;AACrE,QAAI,OAAO,EAAE,IAAF,IAAU,EAAE,UAAvB;AACA,QAAI,QAAQ,OAAO,IAAP,IAAe,QAA3B,EAAqC;AACnC,cAAQ,cAAR,GAAyB,IAAI,kBAAJ,CAAuB,IAAvB,EAA6B,EAAE,IAA/B,EAAqC,EAAC,qBAAqB,EAAE,mBAAxB,EAArC,CAAzB;AACD;AACF;;AAED,SAAO,OAAP;AACD,CApBD;;AAsBA;AACA,IAAI,oBAAoB,UAAS,GAAT,EAAc,IAAd,EAAoB,KAApB,EAA2B;AACjD,SAAO,cAAP,CAAsB,GAAtB,EAA2B,IAA3B,EAAiC;AAC/B,gBAAW,IADoB;AAE/B,SAAK,YAAW;AACd,aAAO,KAAP;AACD;AAJ8B,GAAjC;AAMD,CAPD;;AASA,IAAI,kBAAkB,QAAQ,eAAR,GAA0B,UAAS,aAAT,EAAwB;AACtE,MAAI,QAAQ,CAAC,KAAK,aAAN,EAAqB,WAArB,EAAZ;;AAEA,UAAQ,KAAR;AACE,SAAK,WAAL;AACA,SAAK,KAAL;AACA,SAAK,GAAL;AACE,aAAO,CAAP;AACF,SAAK,YAAL;AACA,SAAK,MAAL;AACA,SAAK,IAAL;AACE,aAAO,CAAC,CAAR;AACF;AACE,YAAM,IAAI,KAAJ,CAAU,8CACA,yCADA,GAEA,uCAFV,CAAN;AAVJ;AAcD,CAjBD;;AAmBA,IAAI,uBAAuB,QAAQ,oBAAR,GAA+B,UAAS,SAAT,EAAoB;AAC5E,MAAI,UAAU,EAAd;AACA,MAAG,aAAa,IAAhB,EAAsB,OAAO,IAAP;AACtB,MAAI,MAAM,OAAN,CAAc,SAAd,CAAJ,EAA8B;AAC5B,QAAG,UAAU,MAAV,KAAqB,CAAxB,EAA2B;AACzB,aAAO,IAAP;AACD;;AAED,SAAI,IAAI,IAAI,CAAZ,EAAe,IAAI,UAAU,MAA7B,EAAqC,GAArC,EAA0C;AACxC,UAAG,UAAU,CAAV,EAAa,WAAb,IAA4B,MAA/B,EAAuC;AACrC,gBAAQ,UAAU,CAAV,CAAR,IAAwB,CAAxB;AACD,OAFD,MAEO;AACL,gBAAQ,UAAU,CAAV,EAAa,CAAb,CAAR,IAA2B,gBAAgB,UAAU,CAAV,EAAa,CAAb,CAAhB,CAA3B;AACD;AACF;AACF,GAZD,MAYO,IAAG,aAAa,IAAb,IAAqB,OAAO,SAAP,IAAoB,QAA5C,EAAsD;AAC3D,cAAU,SAAV;AACD,GAFM,MAEA,IAAI,OAAO,SAAP,IAAoB,QAAxB,EAAkC;AACvC,YAAQ,SAAR,IAAqB,CAArB;AACD,GAFM,MAEA;AACL,UAAM,IAAI,KAAJ,CAAU,8CACd,8EADI,CAAN;AAED;;AAED,SAAO,OAAP;AACD,CAzBD;;AA2BA,IAAI,sBAAsB,SAAS,mBAAT,CAA8B,cAA9B,EAA8C;AACtE,MAAG,aAAa,OAAO,cAAvB,EAAuC;AACrC,UAAM,MAAM,kCAAN,CAAN;AACD;;AAED,MAAG,CAAC,cAAD,IAAmB,eAAe,OAAf,CAAuB,IAAvB,KAAgC,CAAC,CAAvD,EAA0D;AACxD,UAAM,MAAM,kCAAN,CAAN;AACD;;AAED,MAAG,eAAe,OAAf,CAAuB,GAAvB,KAA+B,CAAC,CAAhC,IACC,eAAe,KAAf,CAAqB,4BAArB,KAAsD,IAD1D,EACgE;AAC9D,UAAM,MAAM,uCAAN,CAAN;AACD;;AAED,MAAG,eAAe,KAAf,CAAqB,SAArB,KAAmC,IAAtC,EAA4C;AAC1C,UAAM,MAAM,iDAAN,CAAN;AACD;;AAED;AACA,MAAG,CAAC,CAAC,CAAC,eAAe,OAAf,CAAuB,MAAvB,CAAN,EAAsC;AACpC,UAAM,IAAI,KAAJ,CAAU,kDAAV,CAAN;AACD;AACF,CAtBD;;AAwBA,IAAI,iBAAiB,UAAS,QAAT,EAAmB,GAAnB,EAAwB,MAAxB,EAAgC,MAAhC,EAAwC;AAC3D,MAAI;AACF,QAAG,YAAY,IAAf,EAAqB;AACrB,QAAG,QAAH,EAAa;AACX,aAAO,SAAS,SAAS,GAAT,EAAc,MAAd,EAAsB,MAAtB,CAAT,GAA0C,SAAS,GAAT,EAAc,MAAd,CAAjD;AACD;AACF,GALD,CAKE,OAAM,GAAN,EAAW;AACX,YAAQ,QAAR,CAAiB,YAAW;AAAE,YAAM,GAAN;AAAY,KAA1C;AACA,WAAO,KAAP;AACD;;AAED,SAAO,IAAP;AACD,CAZD;;AAcA;;;;;AAKA,IAAI,UAAU,UAAS,KAAT,EAAgB;AAC5B,MAAI,iBAAiB,KAArB,EAA4B,OAAO,KAAP;;AAE5B,MAAI,MAAM,MAAM,GAAN,IAAa,MAAM,MAAnB,IAA6B,MAAM,UAAnC,IAAiD,KAA3D;AACA,MAAI,IAAI,WAAW,MAAX,CAAkB,EAAC,SAAS,GAAV,EAAe,QAAO,IAAtB,EAAlB,CAAR;;AAEA;AACA,MAAI,OAAO,OAAO,KAAP,IAAgB,QAAhB,GACP,OAAO,IAAP,CAAY,KAAZ,CADO,GAEP,EAFJ;;AAIA,OAAI,IAAI,IAAI,CAAZ,EAAe,IAAI,KAAK,MAAxB,EAAgC,GAAhC,EAAqC;AACnC,QAAI;AACF,QAAE,KAAK,CAAL,CAAF,IAAa,MAAM,KAAK,CAAL,CAAN,CAAb;AACD,KAFD,CAEE,OAAM,GAAN,EAAW;AACX;AACD;AACF;;AAED,SAAO,CAAP;AACD,CApBD;;AAsBA;;;AAGA,IAAI,qBAAqB,SAAS,kBAAT,CAA4B,IAA5B,EAAkC;AACzD,MAAI,YAAY,IAAhB;;AAEA,MAAG,OAAO,IAAP,IAAe,QAAlB,EAA4B;AAC1B,gBAAY,IAAZ;AACD,GAFD,MAEO,IAAG,MAAM,OAAN,CAAc,IAAd,CAAH,EAAwB;AAC7B,gBAAY,EAAZ;;AAEA,SAAK,OAAL,CAAa,UAAS,KAAT,EAAgB;AAC3B,gBAAU,KAAV,IAAmB,CAAnB;AACD,KAFD;AAGD,GANM,MAMA,IAAG,QAAQ,IAAR,IAAgB,OAAO,IAAP,IAAe,QAAlC,EAA4C;AACjD,gBAAY,EAAZ;AACA,SAAK,IAAI,IAAT,IAAiB,IAAjB,EAAuB;AACrB,gBAAU,IAAV,IAAkB,KAAK,IAAL,CAAlB;AACD;AACF;;AAED,SAAO,SAAP;AACD,CAnBD;;AAqBA;;;;;;AAMA,IAAI,oBAAoB,UAAS,WAAT,EAAsB;AAC5C,MAAI,YAAY,EAAhB;AACA,MAAI,UAAU,EAAd;AACA,MAAI,IAAJ;;AAEA;AACA,MAAG,YAAY,OAAO,WAAtB,EAAmC;AACjC;AACA,YAAQ,IAAR,CAAa,cAAc,GAAd,GAAoB,CAAjC;AACA,cAAU,WAAV,IAAyB,CAAzB;AACD,GAJD,MAIO,IAAG,MAAM,OAAN,CAAc,WAAd,CAAH,EAA+B;AACpC,gBAAY,OAAZ,CAAoB,UAAS,CAAT,EAAY;AAC9B,UAAG,YAAY,OAAO,CAAtB,EAAyB;AACvB;AACA,gBAAQ,IAAR,CAAa,IAAI,GAAJ,GAAU,CAAvB;AACA,kBAAU,CAAV,IAAe,CAAf;AACD,OAJD,MAIO,IAAG,MAAM,OAAN,CAAc,CAAd,CAAH,EAAqB;AAC1B;AACA,gBAAQ,IAAR,CAAa,EAAE,CAAF,IAAO,GAAP,IAAc,EAAE,CAAF,KAAQ,CAAtB,CAAb;AACA,kBAAU,EAAE,CAAF,CAAV,IAAkB,EAAE,CAAF,KAAQ,CAA1B;AACD,OAJM,MAIA,IAAG,SAAS,CAAT,CAAH,EAAgB;AACrB;AACA,eAAO,OAAO,IAAP,CAAY,CAAZ,CAAP;AACA,aAAK,OAAL,CAAa,UAAS,CAAT,EAAY;AACvB,kBAAQ,IAAR,CAAa,IAAI,GAAJ,GAAU,EAAE,CAAF,CAAvB;AACA,oBAAU,CAAV,IAAe,EAAE,CAAF,CAAf;AACD,SAHD;AAID,OAPM,MAOA;AACL;AACD;AACF,KAnBD;AAoBD,GArBM,MAqBA,IAAG,SAAS,WAAT,CAAH,EAA0B;AAC/B;AACA,WAAO,OAAO,IAAP,CAAY,WAAZ,CAAP;AACA,SAAK,OAAL,CAAa,UAAS,GAAT,EAAc;AACzB,cAAQ,IAAR,CAAa,MAAM,GAAN,GAAY,YAAY,GAAZ,CAAzB;AACA,gBAAU,GAAV,IAAiB,YAAY,GAAZ,CAAjB;AACD,KAHD;AAID;;AAED,SAAO;AACL,UAAM,QAAQ,IAAR,CAAa,GAAb,CADD,EACoB,MAAM,IAD1B,EACgC,WAAW;AAD3C,GAAP;AAGD,CA3CD;;AA6CA,IAAI,WAAW,QAAQ,QAAR,GAAmB,UAAU,GAAV,EAAe;AAC/C,SAAO,qBAAqB,OAAO,SAAP,CAAiB,QAAjB,CAA0B,IAA1B,CAA+B,GAA/B,CAA5B;AACD,CAFD;;AAIA,IAAI,eAAe,UAAS,WAAT,EAAsB,OAAtB,EAA+B;AAChD,MAAI,eAAe,EAAnB;AACA,cAAY,OAAZ,CAAoB,UAAS,CAAT,EAAY;AAC9B,iBAAa,CAAb,IAAkB,QAAQ,CAAR,CAAlB;AACD,GAFD;;AAIA,SAAO,YAAP;AACD,CAPD;;AASA,IAAI,kBAAkB,UAAS,OAAT,EAAkB,OAAlB,EAA2B,OAA3B,EAAoC;AACxD,OAAI,IAAI,IAAR,IAAgB,OAAhB,EAAyB;AACvB,QAAG,QAAQ,IAAR,KAAiB,IAApB,EAA0B,QAAQ,IAAR,IAAgB,QAAQ,IAAR,CAAhB;AAC3B;;AAED,SAAO,OAAP;AACD,CAND;;AAQA,IAAI,eAAe,UAAS,MAAT,EAAiB,MAAjB,EAAyB;AAC1C,OAAI,IAAI,IAAR,IAAgB,MAAhB,EAAwB;AACtB,WAAO,IAAP,IAAe,OAAO,IAAP,CAAf;AACD;;AAED,SAAO,MAAP;AACD,CAND;;AAQA;AACA,IAAI,mBAAmB,UAAS,MAAT,EAAiB,MAAjB,EAAyB;AAC9C,MAAI,eAAe;AACjB;AACA,aAAS,IAFQ,EAEF,UAAU,KAFR,EAEe,eAAe,oBAF9B,EAEoD,UAAU,KAF9D;AAGjB,eAAW,MAHM,EAGE,WAAW,YAHb;AAIjB;AACA,uBAAmB,eALF,EAKmB,oBAAoB,mBALvC;AAMjB;AACA,kBAAc,SAPG,EAOQ,WAAW,SAPnB,EAO8B,gCAAgC,mBAP9D;AAQjB,4BAAwB,gCARP;AASjB;AACA,2BAAuB;AAVN,GAAnB;;AAaA,OAAI,IAAI,IAAR,IAAgB,MAAhB,EAAwB;AACtB,QAAG,aAAa,IAAb,CAAH,EAAuB;AACrB,aAAO,aAAa,IAAb,CAAP,IAA6B,OAAO,IAAP,CAA7B;AACD,KAFD,MAEO;AACL,aAAO,IAAP,IAAe,OAAO,IAAP,CAAf;AACD;AACF;;AAED,SAAO,MAAP;AACD,CAvBD;;AAyBA,IAAI,gBAAgB,UAAS,OAAT,EAAkB,KAAlB,EAAyB;AAC3C,MAAI,gBAAiB,EAArB;;AAEA,OAAI,IAAI,IAAR,IAAgB,OAAhB,EAAyB;AACvB,QAAG,MAAM,OAAN,CAAc,IAAd,KAAuB,CAAC,CAA3B,EAA8B,cAAc,IAAd,IAAsB,QAAQ,IAAR,CAAtB;AAC/B;;AAED;AACA,SAAO,aAAP;AACD,CATD;;AAWA;AACA,IAAI,SAAS,OAAO,MAAP,GAAgB,OAAO,MAAvB,GAAgC,SAAS,MAAT,CAAgB,MAAhB,EAAwB;AACnE,MAAI,WAAW,SAAX,IAAwB,WAAW,IAAvC,EAA6C;AAC3C,UAAM,IAAI,SAAJ,CAAc,yCAAd,CAAN;AACD;;AAED,MAAI,KAAK,OAAO,MAAP,CAAT;AACA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,UAAU,MAA9B,EAAsC,GAAtC,EAA2C;AACzC,QAAI,aAAa,UAAU,CAAV,CAAjB;AACA,QAAI,eAAe,SAAf,IAA4B,eAAe,IAA/C,EAAqD;AACnD;AACD;;AAED,QAAI,YAAY,OAAO,IAAP,CAAY,OAAO,UAAP,CAAZ,CAAhB;AACA,SAAK,IAAI,YAAY,CAAhB,EAAmB,MAAM,UAAU,MAAxC,EAAgD,YAAY,GAA5D,EAAiE,WAAjE,EAA8E;AAC5E,UAAI,UAAU,UAAU,SAAV,CAAd;AACA,UAAI,OAAO,OAAO,wBAAP,CAAgC,UAAhC,EAA4C,OAA5C,CAAX;AACA,UAAI,SAAS,SAAT,IAAsB,KAAK,UAA/B,EAA2C;AACzC,WAAG,OAAH,IAAc,WAAW,OAAX,CAAd;AACD;AACF;AACF;AACD,SAAO,EAAP;AACD,CAtBD;;AAwBA;AACA,IAAI,mBAAmB,CAAC,GAAD,EAAM,GAAN,EAAW,UAAX,EAAuB,OAAvB,CAAvB;;AAEA;AACA,IAAI,8BAA8B,UAAS,aAAT,EAAwB,aAAxB,EAAuC,IAAvC,EAA6C,iBAA7C,EAAgE;AAChG;AACA,OAAI,IAAI,IAAI,CAAZ,EAAe,IAAI,KAAK,MAAxB,EAAgC,GAAhC,EAAqC;AACnC,QAAG,CAAC,cAAc,KAAK,CAAL,CAAd,CAAD,IAA2B,cAAc,KAAK,CAAL,CAAd,KAA0B,SAAxD,EAAmE;AACjE,oBAAc,KAAK,CAAL,CAAd,IAAyB,cAAc,KAAK,CAAL,CAAd,CAAzB;AACD;AACF;;AAED;AACA,MAAG,CAAC,iBAAJ,EAAuB,OAAO,aAAP;;AAEvB;AACA,MAAI,QAAQ,KAAZ;AACA,OAAI,IAAI,IAAI,CAAZ,EAAe,IAAI,iBAAiB,MAApC,EAA4C,GAA5C,EAAiD;AAC/C,QAAG,cAAc,iBAAiB,CAAjB,CAAd,CAAH,EAAuC;AACrC,cAAQ,IAAR;AACA;AACD;AACF;;AAED,MAAG,CAAC,KAAJ,EAAW;AACT,SAAI,IAAI,IAAI,CAAZ,EAAe,IAAI,iBAAiB,MAApC,EAA4C,GAA5C,EAAiD;AAC/C,UAAG,cAAc,iBAAiB,CAAjB,CAAd,CAAH,EAAuC;AACrC,sBAAc,iBAAiB,CAAjB,CAAd,IAAqC,cAAc,iBAAiB,CAAjB,CAAd,CAArC;AACD;AACF;AACF;;AAED,SAAO,aAAP;AACD,CA7BD;;AA+BA,QAAQ,aAAR,GAAwB,aAAxB;AACA,QAAQ,YAAR,GAAuB,YAAvB;AACA,QAAQ,gBAAR,GAA2B,gBAA3B;AACA,QAAQ,YAAR,GAAuB,YAAvB;AACA,QAAQ,iBAAR,GAA4B,iBAA5B;AACA,QAAQ,mBAAR,GAA8B,mBAA9B;AACA,QAAQ,OAAR,GAAkB,OAAlB;AACA,QAAQ,oBAAR,GAA+B,oBAA/B;AACA,QAAQ,iBAAR,GAA4B,iBAA5B;AACA,QAAQ,kBAAR,GAA6B,kBAA7B;AACA,QAAQ,cAAR,GAAyB,cAAzB;AACA,QAAQ,eAAR,GAA0B,eAA1B;AACA,QAAQ,QAAR,GAAmB,QAAnB;AACA,QAAQ,YAAR,GAAuB,YAAvB;AACA,QAAQ,UAAR,GAAqB,gBAArB;AACA,QAAQ,MAAR,GAAiB,MAAjB;AACA,QAAQ,2BAAR,GAAsC,2BAAtC;AACA,QAAQ,iBAAR,GAA4B,iBAA5B","file":"utils-compiled.js","sourcesContent":["\"use strict\";\n\nvar MongoError = require('mongodb-core').MongoError,\n  ReadPreference = require('./read_preference'),\n  CoreReadPreference = require('mongodb-core').ReadPreference;\n\nvar shallowClone = function(obj) {\n  var copy = {};\n  for(var name in obj) copy[name] = obj[name];\n  return copy;\n}\n\n// Figure out the read preference\nvar getReadPreference = function(options) {\n  var r = null\n  if(options.readPreference) {\n    r = options.readPreference\n  } else {\n    return options;\n  }\n\n  if(r instanceof ReadPreference) {\n    options.readPreference = new CoreReadPreference(r.mode, r.tags, {maxStalenessSeconds: r.maxStalenessSeconds});\n  } else if(typeof r == 'string') {\n    options.readPreference = new CoreReadPreference(r);\n  } else if(r && !(r instanceof ReadPreference) && typeof r == 'object') {\n    var mode = r.mode || r.preference;\n    if (mode && typeof mode == 'string') {\n      options.readPreference = new CoreReadPreference(mode, r.tags, {maxStalenessSeconds: r.maxStalenessSeconds});\n    }\n  }\n\n  return options;\n}\n\n// Set simple property\nvar getSingleProperty = function(obj, name, value) {\n  Object.defineProperty(obj, name, {\n    enumerable:true,\n    get: function() {\n      return value\n    }\n  });\n}\n\nvar formatSortValue = exports.formatSortValue = function(sortDirection) {\n  var value = (\"\" + sortDirection).toLowerCase();\n\n  switch (value) {\n    case 'ascending':\n    case 'asc':\n    case '1':\n      return 1;\n    case 'descending':\n    case 'desc':\n    case '-1':\n      return -1;\n    default:\n      throw new Error(\"Illegal sort clause, must be of the form \"\n                    + \"[['field1', '(ascending|descending)'], \"\n                    + \"['field2', '(ascending|descending)']]\");\n  }\n};\n\nvar formattedOrderClause = exports.formattedOrderClause = function(sortValue) {\n  var orderBy = {};\n  if(sortValue == null) return null;\n  if (Array.isArray(sortValue)) {\n    if(sortValue.length === 0) {\n      return null;\n    }\n\n    for(var i = 0; i < sortValue.length; i++) {\n      if(sortValue[i].constructor == String) {\n        orderBy[sortValue[i]] = 1;\n      } else {\n        orderBy[sortValue[i][0]] = formatSortValue(sortValue[i][1]);\n      }\n    }\n  } else if(sortValue != null && typeof sortValue == 'object') {\n    orderBy = sortValue;\n  } else if (typeof sortValue == 'string') {\n    orderBy[sortValue] = 1;\n  } else {\n    throw new Error(\"Illegal sort clause, must be of the form \" +\n      \"[['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]\");\n  }\n\n  return orderBy;\n};\n\nvar checkCollectionName = function checkCollectionName (collectionName) {\n  if('string' !== typeof collectionName) {\n    throw Error(\"collection name must be a String\");\n  }\n\n  if(!collectionName || collectionName.indexOf('..') != -1) {\n    throw Error(\"collection names cannot be empty\");\n  }\n\n  if(collectionName.indexOf('$') != -1 &&\n      collectionName.match(/((^\\$cmd)|(oplog\\.\\$main))/) == null) {\n    throw Error(\"collection names must not contain '$'\");\n  }\n\n  if(collectionName.match(/^\\.|\\.$/) != null) {\n    throw Error(\"collection names must not start or end with '.'\");\n  }\n\n  // Validate that we are not passing 0x00 in the colletion name\n  if(!!~collectionName.indexOf(\"\\x00\")) {\n    throw new Error(\"collection names cannot contain a null character\");\n  }\n};\n\nvar handleCallback = function(callback, err, value1, value2) {\n  try {\n    if(callback == null) return;\n    if(callback) {\n      return value2 ? callback(err, value1, value2) :  callback(err, value1);\n    }\n  } catch(err) {\n    process.nextTick(function() { throw err; });\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Wrap a Mongo error document in an Error instance\n * @ignore\n * @api private\n */\nvar toError = function(error) {\n  if (error instanceof Error) return error;\n\n  var msg = error.err || error.errmsg || error.errMessage || error;\n  var e = MongoError.create({message: msg, driver:true});\n\n  // Get all object keys\n  var keys = typeof error == 'object'\n    ? Object.keys(error)\n    : [];\n\n  for(var i = 0; i < keys.length; i++) {\n    try {\n      e[keys[i]] = error[keys[i]];\n    } catch(err) {\n      // continue\n    }\n  }\n\n  return e;\n}\n\n/**\n * @ignore\n */\nvar normalizeHintField = function normalizeHintField(hint) {\n  var finalHint = null;\n\n  if(typeof hint == 'string') {\n    finalHint = hint;\n  } else if(Array.isArray(hint)) {\n    finalHint = {};\n\n    hint.forEach(function(param) {\n      finalHint[param] = 1;\n    });\n  } else if(hint != null && typeof hint == 'object') {\n    finalHint = {};\n    for (var name in hint) {\n      finalHint[name] = hint[name];\n    }\n  }\n\n  return finalHint;\n};\n\n/**\n * Create index name based on field spec\n *\n * @ignore\n * @api private\n */\nvar parseIndexOptions = function(fieldOrSpec) {\n  var fieldHash = {};\n  var indexes = [];\n  var keys;\n\n  // Get all the fields accordingly\n  if('string' == typeof fieldOrSpec) {\n    // 'type'\n    indexes.push(fieldOrSpec + '_' + 1);\n    fieldHash[fieldOrSpec] = 1;\n  } else if(Array.isArray(fieldOrSpec)) {\n    fieldOrSpec.forEach(function(f) {\n      if('string' == typeof f) {\n        // [{location:'2d'}, 'type']\n        indexes.push(f + '_' + 1);\n        fieldHash[f] = 1;\n      } else if(Array.isArray(f)) {\n        // [['location', '2d'],['type', 1]]\n        indexes.push(f[0] + '_' + (f[1] || 1));\n        fieldHash[f[0]] = f[1] || 1;\n      } else if(isObject(f)) {\n        // [{location:'2d'}, {type:1}]\n        keys = Object.keys(f);\n        keys.forEach(function(k) {\n          indexes.push(k + '_' + f[k]);\n          fieldHash[k] = f[k];\n        });\n      } else {\n        // undefined (ignore)\n      }\n    });\n  } else if(isObject(fieldOrSpec)) {\n    // {location:'2d', type:1}\n    keys = Object.keys(fieldOrSpec);\n    keys.forEach(function(key) {\n      indexes.push(key + '_' + fieldOrSpec[key]);\n      fieldHash[key] = fieldOrSpec[key];\n    });\n  }\n\n  return {\n    name: indexes.join(\"_\"), keys: keys, fieldHash: fieldHash\n  }\n}\n\nvar isObject = exports.isObject = function (arg) {\n  return '[object Object]' == Object.prototype.toString.call(arg)\n}\n\nvar debugOptions = function(debugFields, options) {\n  var finaloptions = {};\n  debugFields.forEach(function(n) {\n    finaloptions[n] = options[n];\n  });\n\n  return finaloptions;\n}\n\nvar decorateCommand = function(command, options, exclude) {\n  for(var name in options) {\n    if(exclude[name] == null) command[name] = options[name];\n  }\n\n  return command;\n}\n\nvar mergeOptions = function(target, source) {\n  for(var name in source) {\n    target[name] = source[name];\n  }\n\n  return target;\n}\n\n// Merge options with translation\nvar translateOptions = function(target, source) {\n  var translations = {\n    // SSL translation options\n    'sslCA': 'ca', 'sslCRL': 'crl', 'sslValidate': 'rejectUnauthorized', 'sslKey': 'key', \n    'sslCert': 'cert', 'sslPass': 'passphrase',\n    // SocketTimeout translation options\n    'socketTimeoutMS': 'socketTimeout', 'connectTimeoutMS': 'connectionTimeout',\n    // Replicaset options\n    'replicaSet': 'setName', 'rs_name': 'setName', 'secondaryAcceptableLatencyMS': 'acceptableLatency',\n    'connectWithNoPrimary': 'secondaryOnlyConnectionAllowed',\n    // Mongos options\n    'acceptableLatencyMS': 'localThresholdMS'\n  }\n\n  for(var name in source) {\n    if(translations[name]) {\n      target[translations[name]] = source[name];\n    } else {\n      target[name] = source[name];\n    }\n  }\n\n  return target;\n}\n\nvar filterOptions = function(options, names) {\n  var filterOptions =  {};\n\n  for(var name in options) {\n    if(names.indexOf(name) != -1) filterOptions[name] = options[name];\n  }\n\n  // Filtered options\n  return filterOptions;\n}\n\n// Object.assign method or polyfille\nvar assign = Object.assign ? Object.assign : function assign(target) {\n  if (target === undefined || target === null) {\n    throw new TypeError('Cannot convert first argument to object');\n  }\n\n  var to = Object(target);\n  for (var i = 1; i < arguments.length; i++) {\n    var nextSource = arguments[i];\n    if (nextSource === undefined || nextSource === null) {\n      continue;\n    }\n\n    var keysArray = Object.keys(Object(nextSource));\n    for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {\n      var nextKey = keysArray[nextIndex];\n      var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);\n      if (desc !== undefined && desc.enumerable) {\n        to[nextKey] = nextSource[nextKey];\n      }\n    }\n  }\n  return to;\n}\n\n// Write concern keys\nvar writeConcernKeys = ['w', 'j', 'wtimeout', 'fsync'];\n\n// Merge the write concern options\nvar mergeOptionsAndWriteConcern = function(targetOptions, sourceOptions, keys, mergeWriteConcern) {\n  // Mix in any allowed options\n  for(var i = 0; i < keys.length; i++) {\n    if(!targetOptions[keys[i]] && sourceOptions[keys[i]] != undefined) {\n      targetOptions[keys[i]] = sourceOptions[keys[i]];\n    }\n  }\n\n  // No merging of write concern\n  if(!mergeWriteConcern) return targetOptions;\n\n  // Found no write Concern options\n  var found = false;\n  for(var i = 0; i < writeConcernKeys.length; i++) {\n    if(targetOptions[writeConcernKeys[i]]) {\n      found = true; \n      break;\n    }\n  }\n\n  if(!found) {\n    for(var i = 0; i < writeConcernKeys.length; i++) {\n      if(sourceOptions[writeConcernKeys[i]]) {\n        targetOptions[writeConcernKeys[i]] = sourceOptions[writeConcernKeys[i]];\n      }\n    }    \n  }\n\n  return targetOptions;\n}\n\nexports.filterOptions = filterOptions;\nexports.mergeOptions = mergeOptions;\nexports.translateOptions = translateOptions;\nexports.shallowClone = shallowClone;\nexports.getSingleProperty = getSingleProperty;\nexports.checkCollectionName = checkCollectionName;\nexports.toError = toError;\nexports.formattedOrderClause = formattedOrderClause;\nexports.parseIndexOptions = parseIndexOptions;\nexports.normalizeHintField = normalizeHintField;\nexports.handleCallback = handleCallback;\nexports.decorateCommand = decorateCommand;\nexports.isObject = isObject;\nexports.debugOptions = debugOptions;\nexports.MAX_JS_INT = 0x20000000000000;\nexports.assign = assign;\nexports.mergeOptionsAndWriteConcern = mergeOptionsAndWriteConcern;\nexports.getReadPreference = getReadPreference;\n"]}