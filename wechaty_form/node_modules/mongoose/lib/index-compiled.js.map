{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\n/*!\n * Module dependencies.\n */\n\nvar Schema = require('./schema'),\n    SchemaType = require('./schematype'),\n    VirtualType = require('./virtualtype'),\n    STATES = require('./connectionstate'),\n    Types = require('./types'),\n    Query = require('./query'),\n    Model = require('./model'),\n    Document = require('./document'),\n    utils = require('./utils'),\n    format = utils.toCollectionName,\n    pkg = require('../package.json');\n\nvar querystring = require('querystring');\nvar saveSubdocs = require('./plugins/saveSubdocs');\nvar validateBeforeSave = require('./plugins/validateBeforeSave');\n\nvar Aggregate = require('./aggregate');\nvar PromiseProvider = require('./promise_provider');\n\n/**\n * Mongoose constructor.\n *\n * The exports object of the `mongoose` module is an instance of this class.\n * Most apps will only use this one instance.\n *\n * @api public\n */\n\nfunction Mongoose() {\n  this.connections = [];\n  this.plugins = [];\n  this.models = {};\n  this.modelSchemas = {};\n  // default global options\n  this.options = {\n    pluralization: true\n  };\n  var conn = this.createConnection(); // default connection\n  conn.models = this.models;\n}\n\n/**\n * Expose connection states for user-land\n *\n */\nMongoose.prototype.STATES = STATES;\n\n/**\n * Sets mongoose options\n *\n * ####Example:\n *\n *     mongoose.set('test', value) // sets the 'test' option to `value`\n *\n *     mongoose.set('debug', true) // enable logging collection methods + arguments to the console\n *\n *     mongoose.set('debug', function(collectionName, methodName, arg1, arg2...) {}); // use custom function to log collection methods + arguments\n *\n * @param {String} key\n * @param {String|Function} value\n * @api public\n */\n\nMongoose.prototype.set = function(key, value) {\n  if (arguments.length === 1) {\n    return this.options[key];\n  }\n\n  this.options[key] = value;\n  return this;\n};\nMongoose.prototype.set.$hasSideEffects = true;\n\n/**\n * Gets mongoose options\n *\n * ####Example:\n *\n *     mongoose.get('test') // returns the 'test' value\n *\n * @param {String} key\n * @method get\n * @api public\n */\n\nMongoose.prototype.get = Mongoose.prototype.set;\n\n/*!\n * ReplSet connection string check.\n */\n\nvar rgxReplSet = /^.+,.+$/;\n\n/**\n * Checks if ?replicaSet query parameter is specified in URI\n *\n * ####Example:\n *\n *     checkReplicaSetInUri('localhost:27000?replicaSet=rs0'); // true\n *\n * @param {String} uri\n * @return {boolean}\n * @api private\n */\n\nvar checkReplicaSetInUri = function(uri) {\n  if (!uri) {\n    return false;\n  }\n\n  var queryStringStart = uri.indexOf('?');\n  var isReplicaSet = false;\n  if (queryStringStart !== -1) {\n    try {\n      var obj = querystring.parse(uri.substr(queryStringStart + 1));\n      if (obj && obj.replicaSet) {\n        isReplicaSet = true;\n      }\n    } catch (e) {\n      return false;\n    }\n  }\n\n  return isReplicaSet;\n};\n\n/**\n * Creates a Connection instance.\n *\n * Each `connection` instance maps to a single database. This method is helpful when mangaging multiple db connections.\n *\n * If arguments are passed, they are proxied to either [Connection#open](#connection_Connection-open) or [Connection#openSet](#connection_Connection-openSet) appropriately. This means we can pass `db`, `server`, and `replset` options to the driver. _Note that the `safe` option specified in your schema will overwrite the `safe` db option specified here unless you set your schemas `safe` option to `undefined`. See [this](/docs/guide.html#safe) for more information._\n *\n * _Options passed take precedence over options included in connection strings._\n *\n * ####Example:\n *\n *     // with mongodb:// URI\n *     db = mongoose.createConnection('mongodb://user:pass@localhost:port/database');\n *\n *     // and options\n *     var opts = { db: { native_parser: true }}\n *     db = mongoose.createConnection('mongodb://user:pass@localhost:port/database', opts);\n *\n *     // replica sets\n *     db = mongoose.createConnection('mongodb://user:pass@localhost:port,anotherhost:port,yetanother:port/database');\n *\n *     // and options\n *     var opts = { replset: { strategy: 'ping', rs_name: 'testSet' }}\n *     db = mongoose.createConnection('mongodb://user:pass@localhost:port,anotherhost:port,yetanother:port/database', opts);\n *\n *     // with [host, database_name[, port] signature\n *     db = mongoose.createConnection('localhost', 'database', port)\n *\n *     // and options\n *     var opts = { server: { auto_reconnect: false }, user: 'username', pass: 'mypassword' }\n *     db = mongoose.createConnection('localhost', 'database', port, opts)\n *\n *     // initialize now, connect later\n *     db = mongoose.createConnection();\n *     db.open('localhost', 'database', port, [opts]);\n *\n * @param {String} [uri] a mongodb:// URI\n * @param {Object} [options] options to pass to the driver\n * @param {Object} [options.config] mongoose-specific options\n * @param {Boolean} [options.config.autoIndex] set to false to disable automatic index creation for all models associated with this connection.\n * @see Connection#open #connection_Connection-open\n * @see Connection#openSet #connection_Connection-openSet\n * @return {Connection} the created Connection object\n * @api public\n */\n\nMongoose.prototype.createConnection = function(uri, options) {\n  var conn = new Connection(this);\n  this.connections.push(conn);\n\n  var rsOption = options && (options.replset || options.replSet);\n  if (arguments.length) {\n    if (rgxReplSet.test(arguments[0]) || checkReplicaSetInUri(arguments[0])) {\n      conn._openSetWithoutPromise.apply(conn, arguments);\n    } else if (rsOption &&\n        (rsOption.replicaSet || rsOption.rs_name)) {\n      conn._openSetWithoutPromise.apply(conn, arguments);\n    } else {\n      conn._openWithoutPromise.apply(conn, arguments);\n    }\n  }\n\n  return conn;\n};\nMongoose.prototype.createConnection.$hasSideEffects = true;\n\n/**\n * Opens the default mongoose connection.\n *\n * If arguments are passed, they are proxied to either\n * [Connection#open](#connection_Connection-open) or\n * [Connection#openSet](#connection_Connection-openSet) appropriately.\n *\n * _Options passed take precedence over options included in connection strings._\n *\n * ####Example:\n *\n *     mongoose.connect('mongodb://user:pass@localhost:port/database');\n *\n *     // replica sets\n *     var uri = 'mongodb://user:pass@localhost:port,anotherhost:port,yetanother:port/mydatabase';\n *     mongoose.connect(uri);\n *\n *     // with options\n *     mongoose.connect(uri, options);\n *\n *     // connecting to multiple mongos\n *     var uri = 'mongodb://hostA:27501,hostB:27501';\n *     var opts = { mongos: true };\n *     mongoose.connect(uri, opts);\n *\n *     // optional callback that gets fired when initial connection completed\n *     var uri = 'mongodb://nonexistent.domain:27000';\n *     mongoose.connect(uri, function(error) {\n *       // if error is truthy, the initial connection failed.\n *     })\n *\n * @param {String} uri(s)\n * @param {Object} [options]\n * @param {Function} [callback]\n * @see Mongoose#createConnection #index_Mongoose-createConnection\n * @api public\n * @return {MongooseThenable} pseudo-promise wrapper around this\n */\n\nMongoose.prototype.connect = function() {\n  var conn = this.connection;\n  if (rgxReplSet.test(arguments[0]) || checkReplicaSetInUri(arguments[0])) {\n    return new MongooseThenable(this, conn.openSet.apply(conn, arguments));\n  }\n\n  return new MongooseThenable(this, conn.open.apply(conn, arguments));\n};\nMongoose.prototype.connect.$hasSideEffects = true;\n\n/**\n * Disconnects all connections.\n *\n * @param {Function} [fn] called after all connection close.\n * @return {MongooseThenable} pseudo-promise wrapper around this\n * @api public\n */\n\nMongoose.prototype.disconnect = function(fn) {\n  var error;\n  this.connections.forEach(function(conn) {\n    conn.close(function(err) {\n      if (error) {\n        return;\n      }\n      if (err) {\n        error = err;\n      }\n    });\n  });\n\n  var Promise = PromiseProvider.get();\n  return new MongooseThenable(this, new Promise.ES6(function(resolve, reject) {\n    fn && fn(error);\n    if (error) {\n      reject(error);\n      return;\n    }\n    resolve();\n  }));\n};\nMongoose.prototype.disconnect.$hasSideEffects = true;\n\n/**\n * Defines a model or retrieves it.\n *\n * Models defined on the `mongoose` instance are available to all connection created by the same `mongoose` instance.\n *\n * ####Example:\n *\n *     var mongoose = require('mongoose');\n *\n *     // define an Actor model with this mongoose instance\n *     mongoose.model('Actor', new Schema({ name: String }));\n *\n *     // create a new connection\n *     var conn = mongoose.createConnection(..);\n *\n *     // retrieve the Actor model\n *     var Actor = conn.model('Actor');\n *\n * _When no `collection` argument is passed, Mongoose produces a collection name by passing the model `name` to the [utils.toCollectionName](#utils_exports.toCollectionName) method. This method pluralizes the name. If you don't like this behavior, either pass a collection name or set your schemas collection name option._\n *\n * ####Example:\n *\n *     var schema = new Schema({ name: String }, { collection: 'actor' });\n *\n *     // or\n *\n *     schema.set('collection', 'actor');\n *\n *     // or\n *\n *     var collectionName = 'actor'\n *     var M = mongoose.model('Actor', schema, collectionName)\n *\n * @param {String|Function} name model name or class extending Model\n * @param {Schema} [schema]\n * @param {String} [collection] name (optional, inferred from model name)\n * @param {Boolean} [skipInit] whether to skip initialization (defaults to false)\n * @api public\n */\n\nMongoose.prototype.model = function(name, schema, collection, skipInit) {\n  var model;\n  if (typeof name === 'function') {\n    model = name;\n    name = model.name;\n    if (!(model.prototype instanceof Model)) {\n      throw new mongoose.Error('The provided class ' + name + ' must extend Model');\n    }\n  }\n\n  if (typeof schema === 'string') {\n    collection = schema;\n    schema = false;\n  }\n\n  if (utils.isObject(schema) && !(schema.instanceOfSchema)) {\n    schema = new Schema(schema);\n  }\n  if (schema && !schema.instanceOfSchema) {\n    throw new Error('The 2nd parameter to `mongoose.model()` should be a ' +\n      'schema or a POJO');\n  }\n\n  if (typeof collection === 'boolean') {\n    skipInit = collection;\n    collection = null;\n  }\n\n  // handle internal options from connection.model()\n  var options;\n  if (skipInit && utils.isObject(skipInit)) {\n    options = skipInit;\n    skipInit = true;\n  } else {\n    options = {};\n  }\n\n  // look up schema for the collection.\n  if (!this.modelSchemas[name]) {\n    if (schema) {\n      // cache it so we only apply plugins once\n      this.modelSchemas[name] = schema;\n    } else {\n      throw new mongoose.Error.MissingSchemaError(name);\n    }\n  }\n\n  if (schema) {\n    // Reverse order because these both unshift()\n    if (!schema._plugins.saveSubdocs) {\n      schema.plugin(saveSubdocs);\n    }\n    if (!schema._plugins.validateBeforeSave) {\n      schema.plugin(validateBeforeSave);\n    }\n    this._applyPlugins(schema);\n  }\n\n  var sub;\n\n  // connection.model() may be passing a different schema for\n  // an existing model name. in this case don't read from cache.\n  if (this.models[name] && options.cache !== false) {\n    if (schema && schema.instanceOfSchema && schema !== this.models[name].schema) {\n      throw new mongoose.Error.OverwriteModelError(name);\n    }\n\n    if (collection) {\n      // subclass current model with alternate collection\n      model = this.models[name];\n      schema = model.prototype.schema;\n      sub = model.__subclass(this.connection, schema, collection);\n      // do not cache the sub model\n      return sub;\n    }\n\n    return this.models[name];\n  }\n\n  // ensure a schema exists\n  if (!schema) {\n    schema = this.modelSchemas[name];\n    if (!schema) {\n      throw new mongoose.Error.MissingSchemaError(name);\n    }\n  }\n\n  // Apply relevant \"global\" options to the schema\n  if (!('pluralization' in schema.options)) schema.options.pluralization = this.options.pluralization;\n\n\n  if (!collection) {\n    collection = schema.get('collection') || format(name, schema.options);\n  }\n\n  var connection = options.connection || this.connection;\n  model = this.Model.compile(model || name, schema, collection, connection, this);\n\n  if (!skipInit) {\n    model.init();\n  }\n\n  if (options.cache === false) {\n    return model;\n  }\n\n  this.models[name] = model;\n  return this.models[name];\n};\nMongoose.prototype.model.$hasSideEffects = true;\n\n/**\n * Returns an array of model names created on this instance of Mongoose.\n *\n * ####Note:\n *\n * _Does not include names of models created using `connection.model()`._\n *\n * @api public\n * @return {Array}\n */\n\nMongoose.prototype.modelNames = function() {\n  var names = Object.keys(this.models);\n  return names;\n};\nMongoose.prototype.modelNames.$hasSideEffects = true;\n\n/**\n * Applies global plugins to `schema`.\n *\n * @param {Schema} schema\n * @api private\n */\n\nMongoose.prototype._applyPlugins = function(schema) {\n  if (schema.$globalPluginsApplied) {\n    return;\n  }\n  var i;\n  var len;\n  for (i = 0, len = this.plugins.length; i < len; ++i) {\n    schema.plugin(this.plugins[i][0], this.plugins[i][1]);\n  }\n  schema.$globalPluginsApplied = true;\n  for (i = 0, len = schema.childSchemas.length; i < len; ++i) {\n    this._applyPlugins(schema.childSchemas[i]);\n  }\n};\nMongoose.prototype._applyPlugins.$hasSideEffects = true;\n\n/**\n * Declares a global plugin executed on all Schemas.\n *\n * Equivalent to calling `.plugin(fn)` on each Schema you create.\n *\n * @param {Function} fn plugin callback\n * @param {Object} [opts] optional options\n * @return {Mongoose} this\n * @see plugins ./plugins.html\n * @api public\n */\n\nMongoose.prototype.plugin = function(fn, opts) {\n  this.plugins.push([fn, opts]);\n  return this;\n};\nMongoose.prototype.plugin.$hasSideEffects = true;\n\n/**\n * The default connection of the mongoose module.\n *\n * ####Example:\n *\n *     var mongoose = require('mongoose');\n *     mongoose.connect(...);\n *     mongoose.connection.on('error', cb);\n *\n * This is the connection used by default for every model created using [mongoose.model](#index_Mongoose-model).\n *\n * @property connection\n * @return {Connection}\n * @api public\n */\n\nMongoose.prototype.__defineGetter__('connection', function() {\n  return this.connections[0];\n});\n\nMongoose.prototype.__defineSetter__('connection', function(v) {\n  this.connections[0] = v;\n});\n\n/*!\n * Driver depentend APIs\n */\n\nvar driver = global.MONGOOSE_DRIVER_PATH || './drivers/node-mongodb-native';\n\n/*!\n * Connection\n */\n\nvar Connection = require(driver + '/connection');\n\n/*!\n * Collection\n */\n\nvar Collection = require(driver + '/collection');\n\n/**\n * The Mongoose Aggregate constructor\n *\n * @method Aggregate\n * @api public\n */\n\nMongoose.prototype.Aggregate = Aggregate;\n\n/**\n * The Mongoose Collection constructor\n *\n * @method Collection\n * @api public\n */\n\nMongoose.prototype.Collection = Collection;\n\n/**\n * The Mongoose [Connection](#connection_Connection) constructor\n *\n * @method Connection\n * @api public\n */\n\nMongoose.prototype.Connection = Connection;\n\n/**\n * The Mongoose version\n *\n * @property version\n * @api public\n */\n\nMongoose.prototype.version = pkg.version;\n\n/**\n * The Mongoose constructor\n *\n * The exports of the mongoose module is an instance of this class.\n *\n * ####Example:\n *\n *     var mongoose = require('mongoose');\n *     var mongoose2 = new mongoose.Mongoose();\n *\n * @method Mongoose\n * @api public\n */\n\nMongoose.prototype.Mongoose = Mongoose;\n\n/**\n * The Mongoose [Schema](#schema_Schema) constructor\n *\n * ####Example:\n *\n *     var mongoose = require('mongoose');\n *     var Schema = mongoose.Schema;\n *     var CatSchema = new Schema(..);\n *\n * @method Schema\n * @api public\n */\n\nMongoose.prototype.Schema = Schema;\n\n/**\n * The Mongoose [SchemaType](#schematype_SchemaType) constructor\n *\n * @method SchemaType\n * @api public\n */\n\nMongoose.prototype.SchemaType = SchemaType;\n\n/**\n * The various Mongoose SchemaTypes.\n *\n * ####Note:\n *\n * _Alias of mongoose.Schema.Types for backwards compatibility._\n *\n * @property SchemaTypes\n * @see Schema.SchemaTypes #schema_Schema.Types\n * @api public\n */\n\nMongoose.prototype.SchemaTypes = Schema.Types;\n\n/**\n * The Mongoose [VirtualType](#virtualtype_VirtualType) constructor\n *\n * @method VirtualType\n * @api public\n */\n\nMongoose.prototype.VirtualType = VirtualType;\n\n/**\n * The various Mongoose Types.\n *\n * ####Example:\n *\n *     var mongoose = require('mongoose');\n *     var array = mongoose.Types.Array;\n *\n * ####Types:\n *\n * - [ObjectId](#types-objectid-js)\n * - [Buffer](#types-buffer-js)\n * - [SubDocument](#types-embedded-js)\n * - [Array](#types-array-js)\n * - [DocumentArray](#types-documentarray-js)\n *\n * Using this exposed access to the `ObjectId` type, we can construct ids on demand.\n *\n *     var ObjectId = mongoose.Types.ObjectId;\n *     var id1 = new ObjectId;\n *\n * @property Types\n * @api public\n */\n\nMongoose.prototype.Types = Types;\n\n/**\n * The Mongoose [Query](#query_Query) constructor.\n *\n * @method Query\n * @api public\n */\n\nMongoose.prototype.Query = Query;\n\n/**\n * The Mongoose [Promise](#promise_Promise) constructor.\n *\n * @method Promise\n * @api public\n */\n\nObject.defineProperty(Mongoose.prototype, 'Promise', {\n  get: function() {\n    return PromiseProvider.get();\n  },\n  set: function(lib) {\n    PromiseProvider.set(lib);\n  }\n});\n\n/**\n * Storage layer for mongoose promises\n *\n * @method PromiseProvider\n * @api public\n */\n\nMongoose.prototype.PromiseProvider = PromiseProvider;\n\n/**\n * The Mongoose [Model](#model_Model) constructor.\n *\n * @method Model\n * @api public\n */\n\nMongoose.prototype.Model = Model;\n\n/**\n * The Mongoose [Document](#document-js) constructor.\n *\n * @method Document\n * @api public\n */\n\nMongoose.prototype.Document = Document;\n\n/**\n * The Mongoose DocumentProvider constructor.\n *\n * @method DocumentProvider\n * @api public\n */\n\nMongoose.prototype.DocumentProvider = require('./document_provider');\n\n/**\n * The [MongooseError](#error_MongooseError) constructor.\n *\n * @method Error\n * @api public\n */\n\nMongoose.prototype.Error = require('./error');\n\n/**\n * The Mongoose CastError constructor\n *\n * @method CastError\n * @param {String} type The name of the type\n * @param {Any} value The value that failed to cast\n * @param {String} path The path `a.b.c` in the doc where this cast error occurred\n * @param {Error} [reason] The original error that was thrown\n * @api public\n */\n\nMongoose.prototype.CastError = require('./error/cast');\n\n/**\n * The [node-mongodb-native](https://github.com/mongodb/node-mongodb-native) driver Mongoose uses.\n *\n * @property mongo\n * @api public\n */\n\nMongoose.prototype.mongo = require('mongodb');\n\n/**\n * The [mquery](https://github.com/aheckmann/mquery) query builder Mongoose uses.\n *\n * @property mquery\n * @api public\n */\n\nMongoose.prototype.mquery = require('mquery');\n\n/**\n * Wraps the given Mongoose instance into a thenable (pseudo-promise). This\n * is so `connect()` and `disconnect()` can return a thenable while maintaining\n * backwards compatibility.\n *\n * @api private\n */\n\nfunction MongooseThenable(mongoose, promise) {\n  var _this = this;\n  for (var key in mongoose) {\n    if (typeof mongoose[key] === 'function' && mongoose[key].$hasSideEffects) {\n      (function(key) {\n        _this[key] = function() {\n          return mongoose[key].apply(mongoose, arguments);\n        };\n      })(key);\n    } else if (['connection', 'connections'].indexOf(key) !== -1) {\n      _this[key] = mongoose[key];\n    }\n  }\n  this.$opPromise = promise;\n}\n\nMongooseThenable.prototype = new Mongoose;\n\n/**\n * Ability to use mongoose object as a pseudo-promise so `.connect().then()`\n * and `.disconnect().then()` are viable.\n *\n * @param {Function} onFulfilled\n * @param {Function} onRejected\n * @return {Promise}\n * @api private\n */\n\nMongooseThenable.prototype.then = function(onFulfilled, onRejected) {\n  var Promise = PromiseProvider.get();\n  if (!this.$opPromise) {\n    return new Promise.ES6(function(resolve, reject) {\n      reject(new Error('Can only call `.then()` if connect() or disconnect() ' +\n        'has been called'));\n    }).then(onFulfilled, onRejected);\n  }\n  this.$opPromise.$hasHandler = true;\n  return this.$opPromise.then(onFulfilled, onRejected);\n};\n\n/**\n * Ability to use mongoose object as a pseudo-promise so `.connect().then()`\n * and `.disconnect().then()` are viable.\n *\n * @param {Function} onFulfilled\n * @param {Function} onRejected\n * @return {Promise}\n * @api private\n */\n\nMongooseThenable.prototype.catch = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\n/*!\n * The exports object is an instance of Mongoose.\n *\n * @api public\n */\n\nvar mongoose = module.exports = exports = new Mongoose;\n"]}