{"version":3,"sources":["common.js"],"names":[],"mappings":"AAAA;;AAEA;;;;AAIA,IAAI,WAAW,QAAQ,mBAAR,CAAf;AACA,IAAI,QAAQ,QAAQ,UAAR,CAAZ;;AAEA,QAAQ,OAAR,GAAkB,OAAlB;AACA,QAAQ,aAAR,GAAwB,aAAxB;;AAEA;;;;AAIA,SAAS,OAAT,CAAiB,MAAjB,EAAyB,IAAzB,EAA+B,OAA/B,EAAwC;AACtC,MAAI,IAAJ;AACA,MAAI,UAAU,MAAM,gBAAN,CAAuB,MAAvB,CAAV,IAA4C,CAAC,OAAO,QAAP,CAAgB,MAAhB,CAAjD,EAA0E;AACxE,WAAO,OAAO,IAAP,CAAY,OAAO,QAAP,CAAgB,EAAE,WAAW,KAAb,EAAoB,UAAU,KAA9B,EAAhB,CAAZ,CAAP;AACD,GAFD,MAEO;AACL,WAAO,OAAO,IAAP,CAAY,UAAU,EAAtB,CAAP;AACD;;AAED,MAAI,UAAU,KAAK,MAAnB;AACA,MAAI,SAAS,EAAb;AACA,SAAO,OAAO,OAAO,GAAd,GAAoB,EAA3B;;AAEA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,OAApB,EAA6B,EAAE,CAA/B,EAAkC;AAChC,QAAI,MAAM,KAAK,CAAL,CAAV;AACA,QAAI,MAAM,OAAO,GAAP,CAAV;AACA,WAAO,OAAO,GAAd,IAAqB,GAArB;AACA,QAAI,cAAc,GAAd,CAAJ,EAAwB;AACtB,UAAI,WAAW,QAAQ,UAAnB,IAAiC,MAAM,OAAN,CAAc,GAAd,CAArC,EAAyD;AACvD;AACD;AACD,UAAI,OAAO,QAAQ,GAAR,EAAa,OAAO,GAApB,CAAX;AACA,WAAK,IAAI,CAAT,IAAc,IAAd,EAAoB;AAClB,eAAO,CAAP,IAAY,KAAK,CAAL,CAAZ;AACD;AACD,UAAI,MAAM,OAAN,CAAc,GAAd,CAAJ,EAAwB;AACtB,eAAO,OAAO,GAAd,IAAqB,GAArB;AACD;AACF;AACF;;AAED,SAAO,MAAP;AACD;;AAED;;;;AAIA,SAAS,aAAT,CAAuB,MAAvB,EAA+B,IAA/B,EAAqC,MAArC,EAA6C;AAC3C,MAAI,OAAO,OAAO,IAAP,CAAY,UAAU,EAAtB,CAAX;AACA,MAAI,UAAU,KAAK,MAAnB;AACA,WAAS,UAAU,EAAnB;AACA,SAAO,OAAO,OAAO,GAAd,GAAoB,EAA3B;;AAEA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,OAApB,EAA6B,EAAE,CAA/B,EAAkC;AAChC,QAAI,MAAM,KAAK,CAAL,CAAV;AACA,QAAI,MAAM,OAAO,GAAP,CAAV;;AAEA,WAAO,OAAO,GAAd,IAAqB,IAArB;AACA,QAAI,MAAM,gBAAN,CAAuB,GAAvB,KAA+B,CAAC,OAAO,QAAP,CAAgB,GAAhB,CAApC,EAA0D;AACxD,YAAM,IAAI,QAAJ,CAAa,EAAE,WAAW,KAAb,EAAoB,UAAU,KAA9B,EAAb,CAAN;AACD;AACD,QAAI,cAAc,GAAd,CAAJ,EAAwB;AACtB,oBAAc,GAAd,EAAmB,OAAO,GAA1B,EAA+B,MAA/B;AACD;AACF;;AAED,SAAO,MAAP;AACD;;AAED;;;;AAIA,SAAS,aAAT,CAAuB,GAAvB,EAA4B;AAC1B,SAAO,OACL,OAAO,GAAP,KAAe,QADV,IAEL,EAAE,eAAe,IAAjB,CAFK,IAGL,EAAE,eAAe,QAAjB,CAHK,KAIJ,CAAC,MAAM,OAAN,CAAc,GAAd,CAAD,IAAuB,IAAI,MAAJ,GAAa,CAJhC,KAKL,EAAE,eAAe,MAAjB,CALF;AAMD","file":"common-compiled.js","sourcesContent":["'use strict';\n\n/*!\n * Module dependencies.\n */\n\nvar ObjectId = require('../types/objectid');\nvar utils = require('../utils');\n\nexports.flatten = flatten;\nexports.modifiedPaths = modifiedPaths;\n\n/*!\n * ignore\n */\n\nfunction flatten(update, path, options) {\n  var keys;\n  if (update && utils.isMongooseObject(update) && !Buffer.isBuffer(update)) {\n    keys = Object.keys(update.toObject({ transform: false, virtuals: false }));\n  } else {\n    keys = Object.keys(update || {});\n  }\n\n  var numKeys = keys.length;\n  var result = {};\n  path = path ? path + '.' : '';\n\n  for (var i = 0; i < numKeys; ++i) {\n    var key = keys[i];\n    var val = update[key];\n    result[path + key] = val;\n    if (shouldFlatten(val)) {\n      if (options && options.skipArrays && Array.isArray(val)) {\n        continue;\n      }\n      var flat = flatten(val, path + key);\n      for (var k in flat) {\n        result[k] = flat[k];\n      }\n      if (Array.isArray(val)) {\n        result[path + key] = val;\n      }\n    }\n  }\n\n  return result;\n}\n\n/*!\n * ignore\n */\n\nfunction modifiedPaths(update, path, result) {\n  var keys = Object.keys(update || {});\n  var numKeys = keys.length;\n  result = result || {};\n  path = path ? path + '.' : '';\n\n  for (var i = 0; i < numKeys; ++i) {\n    var key = keys[i];\n    var val = update[key];\n\n    result[path + key] = true;\n    if (utils.isMongooseObject(val) && !Buffer.isBuffer(val)) {\n      val = val.toObject({ transform: false, virtuals: false });\n    }\n    if (shouldFlatten(val)) {\n      modifiedPaths(val, path + key, result);\n    }\n  }\n\n  return result;\n}\n\n/*!\n * ignore\n */\n\nfunction shouldFlatten(val) {\n  return val &&\n    typeof val === 'object' &&\n    !(val instanceof Date) &&\n    !(val instanceof ObjectId) &&\n    (!Array.isArray(val) || val.length > 0) &&\n    !(val instanceof Buffer);\n}\n"]}