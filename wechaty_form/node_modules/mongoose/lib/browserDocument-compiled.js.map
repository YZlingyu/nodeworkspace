{"version":3,"sources":["browserDocument.js"],"names":[],"mappings":"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","file":"browserDocument-compiled.js","sourcesContent":["/*!\n * Module dependencies.\n */\n\nvar NodeJSDocument = require('./document');\nvar EventEmitter = require('events').EventEmitter;\nvar MongooseError = require('./error');\nvar Schema = require('./schema');\nvar ObjectId = require('./types/objectid');\nvar utils = require('./utils');\nvar ValidationError = MongooseError.ValidationError;\nvar InternalCache = require('./internal');\nvar PromiseProvider = require('./promise_provider');\nvar VersionError = require('./error').VersionError;\n\nvar Embedded;\n\n/**\n * Document constructor.\n *\n * @param {Object} obj the values to set\n * @param {Object} [fields] optional object containing the fields which were selected in the query returning this document and any populated paths data\n * @param {Boolean} [skipId] bool, should we auto create an ObjectId _id\n * @inherits NodeJS EventEmitter http://nodejs.org/api/events.html#events_class_events_eventemitter\n * @event `init`: Emitted on a document after it has was retrieved from the db and fully hydrated by Mongoose.\n * @event `save`: Emitted when the document is successfully saved\n * @api private\n */\n\nfunction Document(obj, schema, fields, skipId, skipInit) {\n  if (!(this instanceof Document)) {\n    return new Document(obj, schema, fields, skipId, skipInit);\n  }\n\n\n  if (utils.isObject(schema) && !schema.instanceOfSchema) {\n    schema = new Schema(schema);\n  }\n\n  // When creating EmbeddedDocument, it already has the schema and he doesn't need the _id\n  schema = this.schema || schema;\n\n  // Generate ObjectId if it is missing, but it requires a scheme\n  if (!this.schema && schema.options._id) {\n    obj = obj || {};\n\n    if (obj._id === undefined) {\n      obj._id = new ObjectId();\n    }\n  }\n\n  if (!schema) {\n    throw new MongooseError.MissingSchemaError();\n  }\n\n  this.$__setSchema(schema);\n\n  this.$__ = new InternalCache;\n  this.$__.emitter = new EventEmitter();\n  this.isNew = true;\n  this.errors = undefined;\n\n  if (typeof fields === 'boolean') {\n    this.$__.strictMode = fields;\n    fields = undefined;\n  } else {\n    this.$__.strictMode = this.schema.options && this.schema.options.strict;\n    this.$__.selected = fields;\n  }\n\n  var required = this.schema.requiredPaths();\n  for (var i = 0; i < required.length; ++i) {\n    this.$__.activePaths.require(required[i]);\n  }\n\n  this.$__.emitter.setMaxListeners(0);\n  this._doc = this.$__buildDoc(obj, fields, skipId);\n\n  if (!skipInit && obj) {\n    this.init(obj);\n  }\n\n  this.$__registerHooksFromSchema();\n\n  // apply methods\n  for (var m in schema.methods) {\n    this[m] = schema.methods[m];\n  }\n  // apply statics\n  for (var s in schema.statics) {\n    this[s] = schema.statics[s];\n  }\n}\n\n/*!\n * Inherit from the NodeJS document\n */\n\nDocument.prototype = Object.create(NodeJSDocument.prototype);\nDocument.prototype.constructor = Document;\n\n/*!\n * Browser doc exposes the event emitter API\n */\n\nDocument.$emitter = new EventEmitter();\n\nutils.each(\n    ['on', 'once', 'emit', 'listeners', 'removeListener', 'setMaxListeners',\n      'removeAllListeners', 'addListener'],\n    function(emitterFn) {\n      Document[emitterFn] = function() {\n        return Document.$emitter[emitterFn].apply(Document.$emitter, arguments);\n      };\n    });\n\n/*!\n * Executes methods queued from the Schema definition\n *\n * @api private\n * @method $__registerHooksFromSchema\n * @deprecated\n * @memberOf Document\n */\n\nDocument.prototype.$__registerHooksFromSchema = function() {\n  Embedded = Embedded || require('./types/embedded');\n  var Promise = PromiseProvider.get();\n\n  var _this = this;\n  var q = _this.schema && _this.schema.callQueue;\n  var toWrapEl;\n  var len;\n  var i;\n  var j;\n  var pointCut;\n  var keys;\n  if (!q.length) {\n    return _this;\n  }\n\n  // we are only interested in 'pre' hooks, and group by point-cut\n  var toWrap = { post: [] };\n  var pair;\n\n  for (i = 0; i < q.length; ++i) {\n    pair = q[i];\n    if (pair[0] !== 'pre' && pair[0] !== 'post' && pair[0] !== 'on') {\n      _this[pair[0]].apply(_this, pair[1]);\n      continue;\n    }\n    var args = [].slice.call(pair[1]);\n    pointCut = pair[0] === 'on' ? 'post' : args[0];\n    if (!(pointCut in toWrap)) {\n      toWrap[pointCut] = {post: [], pre: []};\n    }\n    if (pair[0] === 'post') {\n      toWrap[pointCut].post.push(args);\n    } else if (pair[0] === 'on') {\n      toWrap[pointCut].push(args);\n    } else {\n      toWrap[pointCut].pre.push(args);\n    }\n  }\n\n  // 'post' hooks are simpler\n  len = toWrap.post.length;\n  toWrap.post.forEach(function(args) {\n    _this.on.apply(_this, args);\n  });\n  delete toWrap.post;\n\n  // 'init' should be synchronous on subdocuments\n  if (toWrap.init && _this instanceof Embedded) {\n    if (toWrap.init.pre) {\n      toWrap.init.pre.forEach(function(args) {\n        _this.$pre.apply(_this, args);\n      });\n    }\n    if (toWrap.init.post) {\n      toWrap.init.post.forEach(function(args) {\n        _this.$post.apply(_this, args);\n      });\n    }\n    delete toWrap.init;\n  } else if (toWrap.set) {\n    // Set hooks also need to be sync re: gh-3479\n    if (toWrap.set.pre) {\n      toWrap.set.pre.forEach(function(args) {\n        _this.$pre.apply(_this, args);\n      });\n    }\n    if (toWrap.set.post) {\n      toWrap.set.post.forEach(function(args) {\n        _this.$post.apply(_this, args);\n      });\n    }\n    delete toWrap.set;\n  }\n\n  keys = Object.keys(toWrap);\n  len = keys.length;\n  for (i = 0; i < len; ++i) {\n    pointCut = keys[i];\n    // this is so we can wrap everything into a promise;\n    var newName = ('$__original_' + pointCut);\n    if (!_this[pointCut]) {\n      continue;\n    }\n    _this[newName] = _this[pointCut];\n    _this[pointCut] = (function(_newName) {\n      return function wrappedPointCut() {\n        var args = [].slice.call(arguments);\n        var lastArg = args.pop();\n        var fn;\n        var originalError = new Error();\n        var $results;\n        if (lastArg && typeof lastArg !== 'function') {\n          args.push(lastArg);\n        } else {\n          fn = lastArg;\n        }\n\n        var promise = new Promise.ES6(function(resolve, reject) {\n          args.push(function(error) {\n            if (error) {\n              // gh-2633: since VersionError is very generic, take the\n              // stack trace of the original save() function call rather\n              // than the async trace\n              if (error instanceof VersionError) {\n                error.stack = originalError.stack;\n              }\n              _this.$__handleReject(error);\n              reject(error);\n              return;\n            }\n\n            // There may be multiple results and promise libs other than\n            // mpromise don't support passing multiple values to `resolve()`\n            $results = Array.prototype.slice.call(arguments, 1);\n            resolve.apply(promise, $results);\n          });\n\n          _this[_newName].apply(_this, args);\n        });\n        if (fn) {\n          if (_this.constructor.$wrapCallback) {\n            fn = _this.constructor.$wrapCallback(fn);\n          }\n          return promise.then(\n            function() {\n              process.nextTick(function() {\n                fn.apply(null, [null].concat($results));\n              });\n            },\n            function(error) {\n              process.nextTick(function() {\n                fn(error);\n              });\n            });\n        }\n        return promise;\n      };\n    })(newName);\n\n    toWrapEl = toWrap[pointCut];\n    var _len = toWrapEl.pre.length;\n    args;\n    for (j = 0; j < _len; ++j) {\n      args = toWrapEl.pre[j];\n      args[0] = newName;\n      _this.$pre.apply(_this, args);\n    }\n\n    _len = toWrapEl.post.length;\n    for (j = 0; j < _len; ++j) {\n      args = toWrapEl.post[j];\n      args[0] = newName;\n      _this.$post.apply(_this, args);\n    }\n  }\n  return _this;\n};\n\n/*!\n * Module exports.\n */\n\nDocument.ValidationError = ValidationError;\nmodule.exports = exports = Document;\n"]}