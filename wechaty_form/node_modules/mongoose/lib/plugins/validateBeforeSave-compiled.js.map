{"version":3,"sources":["validateBeforeSave.js"],"names":[],"mappings":"AAAA;;AAEA;;;;AAIA,OAAO,OAAP,GAAiB,UAAS,MAAT,EAAiB;AAChC,SAAO,QAAP,CAAgB,kBAAhB,GAAqC,IAArC;;AAEA,SAAO,SAAP,CAAiB,OAAjB,CAAyB,CAAC,KAAD,EAAQ,CAAC,MAAD,EAAS,UAAS,IAAT,EAAe,OAAf,EAAwB;AAChE,QAAI,QAAQ,IAAZ;AACA;AACA,QAAI,KAAK,aAAT,EAAwB;AACtB,aAAO,MAAP;AACD;;AAED,QAAI,8BAA8B,WAC7B,OAAO,OAAP,KAAmB,QADU,IAE7B,wBAAwB,OAF7B;;AAIA,QAAI,cAAJ;AACA,QAAI,2BAAJ,EAAiC;AAC/B,uBAAiB,CAAC,CAAC,QAAQ,kBAA3B;AACD,KAFD,MAEO;AACL,uBAAiB,KAAK,MAAL,CAAY,OAAZ,CAAoB,kBAArC;AACD;;AAED;AACA,QAAI,cAAJ,EAAoB;AAClB;AACA;AACA,UAAI,KAAK,oBAAT,EAA+B;AAC7B,aAAK,oBAAL,CAA0B,EAAC,aAAa,IAAd,EAA1B,EAA+C,UAAS,KAAT,EAAgB;AAC7D,iBAAO,MAAM,MAAN,CAAa,CAAb,CAAe,KAAf,CAAqB,QAArB,CAA8B,YAA9B,EAA4C,KAA5C,EAAmD,CAAC,KAAD,CAAnD,EAA4D,EAAE,OAAO,KAAT,EAA5D,EAA8E,UAAS,KAAT,EAAgB;AACnG,iBAAK,KAAL;AACD,WAFM,CAAP;AAGD,SAJD;AAKD,OAND,MAMO;AACL,aAAK,QAAL,CAAc,EAAC,aAAa,IAAd,EAAd,EAAmC,UAAS,KAAT,EAAgB;AACjD,iBAAO,MAAM,MAAN,CAAa,CAAb,CAAe,KAAf,CAAqB,QAArB,CAA8B,YAA9B,EAA4C,KAA5C,EAAmD,CAAE,KAAF,CAAnD,EAA6D,EAAE,OAAO,KAAT,EAA7D,EAA+E,UAAS,KAAT,EAAgB;AACpG,iBAAK,KAAL;AACD,WAFM,CAAP;AAGD,SAJD;AAKD;AACF,KAhBD,MAgBO;AACL;AACD;AACF,GAtCgC,CAAR,CAAzB;AAuCD,CA1CD","file":"validateBeforeSave-compiled.js","sourcesContent":["'use strict';\n\n/*!\n * ignore\n */\n\nmodule.exports = function(schema) {\n  schema._plugins.validateBeforeSave = true;\n\n  schema.callQueue.unshift(['pre', ['save', function(next, options) {\n    var _this = this;\n    // Nested docs have their own presave\n    if (this.ownerDocument) {\n      return next();\n    }\n\n    var hasValidateBeforeSaveOption = options &&\n        (typeof options === 'object') &&\n        ('validateBeforeSave' in options);\n\n    var shouldValidate;\n    if (hasValidateBeforeSaveOption) {\n      shouldValidate = !!options.validateBeforeSave;\n    } else {\n      shouldValidate = this.schema.options.validateBeforeSave;\n    }\n\n    // Validate\n    if (shouldValidate) {\n      // HACK: use $__original_validate to avoid promises so bluebird doesn't\n      // complain\n      if (this.$__original_validate) {\n        this.$__original_validate({__noPromise: true}, function(error) {\n          return _this.schema.s.hooks.execPost('save:error', _this, [_this], { error: error }, function(error) {\n            next(error);\n          });\n        });\n      } else {\n        this.validate({__noPromise: true}, function(error) {\n          return _this.schema.s.hooks.execPost('save:error', _this, [ _this], { error: error }, function(error) {\n            next(error);\n          });\n        });\n      }\n    } else {\n      next();\n    }\n  }]]);\n};\n"]}