{"version":3,"sources":["simple-map.asynct.js"],"names":[],"mappings":"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","file":"simple-map.asynct-compiled.js","sourcesContent":["'use strict';\n\nvar map = require('../')\n  , it = require('it-is')\n  , u = require('ubelt')\n  , spec = require('stream-spec')\n  , from = require('from')\n  , Stream = require('stream')\n  , es = require('event-stream')\n\n//REFACTOR THIS TEST TO USE es.readArray and es.writeArray\n\nfunction writeArray(array, stream) {\n\n  array.forEach( function (j) {\n    stream.write(j)\n  })\n  stream.end()\n\n}\n\nfunction readStream(stream, done) {\n\n  var array = [] \n  stream.on('data', function (data) {\n    array.push(data)\n  })\n  stream.on('error', done)\n  stream.on('end', function (data) {\n    done(null, array)\n  })\n\n} \n\n//call sink on each write,\n//and complete when finished.\n\nfunction pauseStream (prob, delay) { \n  var pauseIf = (\n      'number' == typeof prob \n    ? function () {\n        return Math.random() < prob\n      } \n    : 'function' == typeof prob \n    ? prob\n    : 0.1\n  )\n  var delayer = ( \n      !delay \n    ? process.nextTick\n    : 'number' == typeof delay \n    ? function (next) { setTimeout(next, delay) }\n    : delay\n  )   \n\n  return es.through(function (data) {    \n    if(!this.paused && pauseIf()) {\n      console.log('PAUSE STREAM PAUSING')\n      this.pause()\n      var self = this\n      delayer(function () {\n        console.log('PAUSE STREAM RESUMING')\n        self.resume()\n      })\n    }\n    console.log(\"emit ('data', \" + data + ')')\n    this.emit('data', data) \n  })\n}\n\nexports ['simple map applied to a stream'] = function (test) {\n\n  var input = [1,2,3,7,5,3,1,9,0,2,4,6]\n  //create event stream from\n\n  var doubler = map(function (data, cb) {\n    cb(null, data * 2)\n  })\n\n  spec(doubler).through().validateOnExit()\n\n  //a map is only a middle man, so it is both readable and writable\n  \n  it(doubler).has({\n    readable: true,\n    writable: true,   \n  })\n\n  readStream(doubler, function (err, output) {\n    it(output).deepEqual(input.map(function (j) {\n      return j * 2\n    }))\n//    process.nextTick(x.validate)\n    test.done()\n  })\n  \n  writeArray(input, doubler)\n  \n}\n\nexports ['stream comes back in the correct order'] = function (test) {\n  var input = [3, 2, 1]\n\n  var delayer = map(function(data, cb){\n    setTimeout(function () {\n      cb(null, data)\n    }, 100 * data)\n  })\n\n  readStream(delayer, function (err, output) {\n    it(output).deepEqual(input)\n    test.done()\n  })\n\n  writeArray(input, delayer)\n}\n\nexports ['continues on error event with failures `true`'] = function (test) {\n  var input = [1, 2, 3]\n\n  var delayer = map(function(data, cb){\n    cb(new Error('Something gone wrong'), data)\n  }, { failures: true })\n\n  readStream(delayer, function (err, output) {\n    it(output).deepEqual(input)\n    test.done()\n  })\n\n  writeArray(input, delayer)\n}\n\nexports['pipe two maps together'] = function (test) {\n\n  var input = [1,2,3,7,5,3,1,9,0,2,4,6]\n  //create event stream from\n  function dd (data, cb) {\n    cb(null, data * 2)\n  }\n  var doubler1 = map(dd), doubler2 = map(dd)\n\n  doubler1.pipe(doubler2)\n  \n  spec(doubler1).through().validateOnExit()\n  spec(doubler2).through().validateOnExit()\n\n  readStream(doubler2, function (err, output) {\n    it(output).deepEqual(input.map(function (j) {\n      return j * 4\n    }))\n    test.done()\n  })\n  \n  writeArray(input, doubler1)\n\n}\n\n//next:\n//\n// test pause, resume and drian.\n//\n\n// then make a pipe joiner:\n//\n// plumber (evStr1, evStr2, evStr3, evStr4, evStr5)\n//\n// will return a single stream that write goes to the first \n\nexports ['map will not call end until the callback'] = function (test) {\n\n  var ticker = map(function (data, cb) {\n    process.nextTick(function () {\n      cb(null, data * 2)\n    })\n  })\n\n  spec(ticker).through().validateOnExit()\n\n  ticker.write('x')\n  ticker.end() \n\n  ticker.on('end', function () {\n    test.done()\n  })\n}\n\nexports ['emit failures with opts.failures === `ture`'] = function (test) {\n\n  var err = new Error('INTENSIONAL ERROR')\n    , mapper = \n  map(function () {\n    throw err\n  }, { failures: true })\n\n  mapper.on('failure', function (_err) {\n    it(_err).equal(err)  \n    test.done()\n  })\n\n  mapper.write('hello')\n\n}\n\nexports ['emit error thrown'] = function (test) {\n\n  var err = new Error('INTENSIONAL ERROR')\n    , mapper = \n  map(function () {\n    throw err\n  })\n\n  mapper.on('error', function (_err) {\n    it(_err).equal(err)  \n    test.done()\n  })\n\n  mapper.write('hello')\n\n}\n\nexports ['emit error calledback'] = function (test) {\n\n  var err = new Error('INTENSIONAL ERROR')\n    , mapper = \n  map(function (data, callback) {\n    callback(err)\n  })\n\n  mapper.on('error', function (_err) {\n    it(_err).equal(err)  \n    test.done()\n  })\n\n  mapper.write('hello')\n\n}\n\nexports ['do not emit drain if not paused'] = function (test) {\n\n  var maps = map(function (data, callback) {\n    u.delay(callback)(null, 1)\n    return true\n  })\n  \n  spec(maps).through().pausable().validateOnExit()\n\n  maps.on('drain', function () {\n    it(false).ok('should not emit drain unless the stream is paused')\n  })\n\n  it(maps.write('hello')).equal(true)\n  it(maps.write('hello')).equal(true)\n  it(maps.write('hello')).equal(true)\n  setTimeout(function () {maps.end()},10)\n  maps.on('end', test.done)\n}\n\nexports ['emits drain if paused, when all '] = function (test) {\n  var active = 0\n  var drained = false\n  var maps = map(function (data, callback) {\n    active ++\n    u.delay(function () {\n      active --\n      callback(null, 1)\n    })()\n    console.log('WRITE', false)\n    return false\n  })\n\n  spec(maps).through().validateOnExit()\n\n  maps.on('drain', function () {\n    drained = true\n    it(active).equal(0, 'should emit drain when all maps are done')\n  })\n\n  it(maps.write('hello')).equal(false)\n  it(maps.write('hello')).equal(false)\n  it(maps.write('hello')).equal(false)\n\n  process.nextTick(function () {maps.end()},10)\n\n  maps.on('end', function () {\n    console.log('end')\n    it(drained).ok('shoud have emitted drain before end')\n    test.done() \n  })\n\n}\n\nexports ['map applied to a stream with filtering'] = function (test) {\n\n  var input = [1,2,3,7,5,3,1,9,0,2,4,6]\n\n  var doubler = map(function (data, callback) {\n    if (data % 2)\n      callback(null, data * 2)\n    else\n      callback()\n  })\n  \n  readStream(doubler, function (err, output) {\n    it(output).deepEqual(input.filter(function (j) {\n      return j % 2\n    }).map(function (j) {\n      return j * 2\n    }))\n    test.done()\n  })\n  \n  spec(doubler).through().validateOnExit()\n\n  writeArray(input, doubler)\n  \n}\n\n\n"]}