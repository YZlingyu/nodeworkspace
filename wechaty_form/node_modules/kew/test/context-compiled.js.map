{"version":3,"sources":["context.js"],"names":[],"mappings":"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","file":"context-compiled.js","sourcesContent":["var Q = require('../kew')\n\n// test that contexts are propogated based on position\nexports.testContextWithDelay = function (test) {\n\n\tQ.resolve(true)\n\t  .setContext({id: 1})\n\t  .then(function (val, context) {\n\t  \ttest.equal(context.id, 1, 'Should return the first context')\n\t  \treturn Q.delay(500)\n\t  })\n\t  .setContext({id: 2})\n\t  .then(function (val, context) {\n\t  \ttest.equal(context.id, 2, 'Should return the second context')\n\t  \treturn Q.delay(500)\n\t  })\n\t  .clearContext()\n\t  .then(function (val, context) {\n\t  \ttest.equal(typeof context, 'undefined', 'Should return an undefined context')\n\t  \treturn Q.delay(500)\n\t  })\n\t  .setContext({id: 3})\n\t  .fin(test.done)\n}\n\n// test adding and removing contexts\nexports.testGeneralContextFlow = function (test) {\n\tQ.resolve(true)\n\t\t// test no context exists\n\t  .then(function (val, context) {\n\t  \ttest.equal(typeof context, 'undefined', 'Context should be undefined')\n\t  \tthrow new Error()\n\t  })\n\t  .fail(function (e, context) {\n\t  \ttest.equal(typeof context, 'undefined', 'Context should be undefined')\n\t  })\n\n\t  // set the context and mutate it\n\t  .setContext({counter: 1})\n\t  .then(function (val, context) {\n\t  \ttest.equal(context.counter, 1, 'Counter should be 1')\n\t  \tcontext.counter++\n\t  })\n\t  .then(function (val, context) {\n\t  \ttest.equal(context.counter, 2, 'Counter should be 2')\n\t  \tcontext.counter++\n\t  \tthrow new Error()\n\t  })\n\t  .fail(function (e, context) {\n\t  \ttest.equal(context.counter, 3, 'Counter should be 3')\n\t  })\n\n\t  // return a context\n\t  .then(function (val, context) {\n\t  \treturn Q.resolve(false)\n\t  \t  .setContext({counter: 0})\n\t  })\n\t  .then(function (val, context) {\n\t  \ttest.equal(context.counter, 0, 'Counter should be 0')\n\t  \tthrow new Error()\n\t  })\n\t  .fail(function (e, context) {\n\t  \ttest.equal(context.counter, 0, 'Counter should be 0')\n\t  })\n\n\t  // returning a promise with a cleared context won't clear the parent context\n\t  .then(function (val, context) {\n\t  \treturn Q.resolve(false).clearContext()\n\t  })\n\t  .then(function (val, context) {\n\t  \ttest.equal(context.counter, 0, 'Counter should be 0')\n\t  \tthrow new Error()\n\t  })\n\t  .fail(function (e, context) {\n\t  \ttest.equal(context.counter, 0, 'Counter should be 0')\n\t  })\n\n\t  // test that clearing the context works\n\t  .clearContext()\n\t  .then(function (val, context) {\n\t  \ttest.equal(typeof context, 'undefined', 'Context should be undefined')\n\t  \tthrow new Error()\n\t  })\n\t  .fail(function (e, context) {\n\t  \ttest.equal(typeof context, 'undefined', 'Context should be undefined')\n\t  })\n\n\t  .fin(test.done)\n}"]}