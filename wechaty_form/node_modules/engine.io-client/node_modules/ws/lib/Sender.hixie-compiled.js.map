{"version":3,"sources":["Sender.hixie.js"],"names":[],"mappings":"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","file":"Sender.hixie-compiled.js","sourcesContent":["/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar events = require('events')\n  , util = require('util')\n  , EventEmitter = events.EventEmitter;\n\n/**\n * Hixie Sender implementation\n */\n\nfunction Sender(socket) {\n  if (this instanceof Sender === false) {\n    throw new TypeError(\"Classes can't be function-called\");\n  }\n\n  events.EventEmitter.call(this);\n\n  this.socket = socket;\n  this.continuationFrame = false;\n  this.isClosed = false;\n}\n\nmodule.exports = Sender;\n\n/**\n * Inherits from EventEmitter.\n */\n\nutil.inherits(Sender, events.EventEmitter);\n\n/**\n * Frames and writes data.\n *\n * @api public\n */\n\nSender.prototype.send = function(data, options, cb) {\n  if (this.isClosed) return;\n\n  var isString = typeof data == 'string'\n    , length = isString ? Buffer.byteLength(data) : data.length\n    , lengthbytes = (length > 127) ? 2 : 1 // assume less than 2**14 bytes\n    , writeStartMarker = this.continuationFrame == false\n    , writeEndMarker = !options || !(typeof options.fin != 'undefined' && !options.fin)\n    , buffer = new Buffer((writeStartMarker ? ((options && options.binary) ? (1 + lengthbytes) : 1) : 0) + length + ((writeEndMarker && !(options && options.binary)) ? 1 : 0))\n    , offset = writeStartMarker ? 1 : 0;\n\n  if (writeStartMarker) {\n    if (options && options.binary) {\n      buffer.write('\\x80', 'binary');\n      // assume length less than 2**14 bytes\n      if (lengthbytes > 1)\n        buffer.write(String.fromCharCode(128+length/128), offset++, 'binary');\n      buffer.write(String.fromCharCode(length&0x7f), offset++, 'binary');\n    } else\n      buffer.write('\\x00', 'binary');\n  }\n\n  if (isString) buffer.write(data, offset, 'utf8');\n  else data.copy(buffer, offset, 0);\n\n  if (writeEndMarker) {\n    if (options && options.binary) {\n      // sending binary, not writing end marker\n    } else\n      buffer.write('\\xff', offset + length, 'binary');\n    this.continuationFrame = false;\n  }\n  else this.continuationFrame = true;\n\n  try {\n    this.socket.write(buffer, 'binary', cb);\n  } catch (e) {\n    this.error(e.toString());\n  }\n};\n\n/**\n * Sends a close instruction to the remote party.\n *\n * @api public\n */\n\nSender.prototype.close = function(code, data, mask, cb) {\n  if (this.isClosed) return;\n  this.isClosed = true;\n  try {\n    if (this.continuationFrame) this.socket.write(new Buffer([0xff], 'binary'));\n    this.socket.write(new Buffer([0xff, 0x00]), 'binary', cb);\n  } catch (e) {\n    this.error(e.toString());\n  }\n};\n\n/**\n * Sends a ping message to the remote party. Not available for hixie.\n *\n * @api public\n */\n\nSender.prototype.ping = function(data, options) {};\n\n/**\n * Sends a pong message to the remote party. Not available for hixie.\n *\n * @api public\n */\n\nSender.prototype.pong = function(data, options) {};\n\n/**\n * Handles an error\n *\n * @api private\n */\n\nSender.prototype.error = function (reason) {\n  this.emit('error', reason);\n  return this;\n};\n"]}