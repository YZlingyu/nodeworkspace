{"version":3,"sources":["commands.js"],"names":[],"mappings":"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","file":"commands-compiled.js","sourcesContent":["\"use strict\";\n\nvar retrieveBSON = require('../connection/utils').retrieveBSON;\nvar BSON = retrieveBSON();\nvar Long = BSON.Long;\n\n// Incrementing request id\nvar _requestId = 0;\n\n// Wire command operation ids\nvar OP_QUERY = 2004;\nvar OP_GETMORE = 2005;\nvar OP_KILL_CURSORS = 2007;\n\n// Query flags\nvar OPTS_TAILABLE_CURSOR = 2;\nvar OPTS_SLAVE = 4;\nvar OPTS_OPLOG_REPLAY = 8;\nvar OPTS_NO_CURSOR_TIMEOUT = 16;\nvar OPTS_AWAIT_DATA = 32;\nvar OPTS_EXHAUST = 64;\nvar OPTS_PARTIAL = 128;\n\n// Response flags\nvar CURSOR_NOT_FOUND = 0;\nvar QUERY_FAILURE = 2;\nvar SHARD_CONFIG_STALE = 4;\nvar AWAIT_CAPABLE = 8;\n\n/**************************************************************\n * QUERY\n **************************************************************/\nvar Query = function(bson, ns, query, options) {\n  var self = this;\n  // Basic options needed to be passed in\n  if(ns == null) throw new Error(\"ns must be specified for query\");\n  if(query == null) throw new Error(\"query must be specified for query\");\n\n  // Validate that we are not passing 0x00 in the collection name\n  if(!!~ns.indexOf(\"\\x00\")) {\n    throw new Error(\"namespace cannot contain a null character\");\n  }\n\n  // Basic options\n  this.bson = bson;\n  this.ns = ns;\n  this.query = query;\n\n  // Ensure empty options\n  this.options = options || {};\n\n  // Additional options\n  this.numberToSkip = options.numberToSkip || 0;\n  this.numberToReturn = options.numberToReturn || 0;\n  this.returnFieldSelector = options.returnFieldSelector || null;\n  this.requestId = Query.getRequestId();\n\n  // Serialization option\n  this.serializeFunctions = typeof options.serializeFunctions == 'boolean' ? options.serializeFunctions : false;\n  this.ignoreUndefined = typeof options.ignoreUndefined == 'boolean' ? options.ignoreUndefined : false;\n  this.maxBsonSize = options.maxBsonSize || 1024 * 1024 * 16;\n  this.checkKeys = typeof options.checkKeys == 'boolean' ? options.checkKeys : true;\n  this.batchSize = self.numberToReturn;\n\n  // Flags\n  this.tailable = false;\n  this.slaveOk = typeof options.slaveOk == 'boolean'? options.slaveOk : false;\n  this.oplogReplay = false;\n  this.noCursorTimeout = false;\n  this.awaitData = false;\n  this.exhaust = false;\n  this.partial = false;\n}\n\n//\n// Assign a new request Id\nQuery.prototype.incRequestId = function() {\n  this.requestId = _requestId++;\n}\n\n//\n// Assign a new request Id\nQuery.nextRequestId = function() {\n  return _requestId + 1;\n}\n\n//\n// Uses a single allocated buffer for the process, avoiding multiple memory allocations\nQuery.prototype.toBin = function() {\n  var self = this;\n  var buffers = [];\n  var projection = null;\n\n  // Set up the flags\n  var flags = 0;\n  if(this.tailable) {\n    flags |= OPTS_TAILABLE_CURSOR;\n  }\n\n  if(this.slaveOk) {\n    flags |= OPTS_SLAVE;\n  }\n\n  if(this.oplogReplay) {\n    flags |= OPTS_OPLOG_REPLAY;\n  }\n\n  if(this.noCursorTimeout) {\n    flags |= OPTS_NO_CURSOR_TIMEOUT;\n  }\n\n  if(this.awaitData) {\n    flags |= OPTS_AWAIT_DATA;\n  }\n\n  if(this.exhaust) {\n    flags |= OPTS_EXHAUST;\n  }\n\n  if(this.partial) {\n    flags |= OPTS_PARTIAL;\n  }\n\n  // If batchSize is different to self.numberToReturn\n  if(self.batchSize != self.numberToReturn) self.numberToReturn = self.batchSize;\n\n  // Allocate write protocol header buffer\n  var header = new Buffer(\n    4 * 4 // Header\n    + 4   // Flags\n    + Buffer.byteLength(self.ns) + 1 // namespace\n    + 4 // numberToSkip\n    + 4 // numberToReturn\n  );\n\n  // Add header to buffers\n  buffers.push(header);\n\n  // Serialize the query\n  var query = self.bson.serialize(this.query, {\n    checkKeys: this.checkKeys,\n    serializeFunctions: this.serializeFunctions,\n    ignoreUndefined: this.ignoreUndefined,\n  });\n\n  // Add query document\n  buffers.push(query);\n\n  if(self.returnFieldSelector && Object.keys(self.returnFieldSelector).length > 0) {\n    // Serialize the projection document\n    projection = self.bson.serialize(this.returnFieldSelector, {\n      checkKeys: this.checkKeys,\n      serializeFunctions: this.serializeFunctions,\n      ignoreUndefined: this.ignoreUndefined,\n    });\n    // Add projection document\n    buffers.push(projection);\n  }\n\n  // Total message size\n  var totalLength = header.length + query.length + (projection ? projection.length : 0);\n\n  // Set up the index\n  var index = 4;\n\n  // Write total document length\n  header[3] = (totalLength >> 24) & 0xff;\n  header[2] = (totalLength >> 16) & 0xff;\n  header[1] = (totalLength >> 8) & 0xff;\n  header[0] = (totalLength) & 0xff;\n\n  // Write header information requestId\n  header[index + 3] = (this.requestId >> 24) & 0xff;\n  header[index + 2] = (this.requestId >> 16) & 0xff;\n  header[index + 1] = (this.requestId >> 8) & 0xff;\n  header[index] = (this.requestId) & 0xff;\n  index = index + 4;\n\n  // Write header information responseTo\n  header[index + 3] = (0 >> 24) & 0xff;\n  header[index + 2] = (0 >> 16) & 0xff;\n  header[index + 1] = (0 >> 8) & 0xff;\n  header[index] = (0) & 0xff;\n  index = index + 4;\n\n  // Write header information OP_QUERY\n  header[index + 3] = (OP_QUERY >> 24) & 0xff;\n  header[index + 2] = (OP_QUERY >> 16) & 0xff;\n  header[index + 1] = (OP_QUERY >> 8) & 0xff;\n  header[index] = (OP_QUERY) & 0xff;\n  index = index + 4;\n\n  // Write header information flags\n  header[index + 3] = (flags >> 24) & 0xff;\n  header[index + 2] = (flags >> 16) & 0xff;\n  header[index + 1] = (flags >> 8) & 0xff;\n  header[index] = (flags) & 0xff;\n  index = index + 4;\n\n  // Write collection name\n  index = index + header.write(this.ns, index, 'utf8') + 1;\n  header[index - 1] = 0;\n\n  // Write header information flags numberToSkip\n  header[index + 3] = (this.numberToSkip >> 24) & 0xff;\n  header[index + 2] = (this.numberToSkip >> 16) & 0xff;\n  header[index + 1] = (this.numberToSkip >> 8) & 0xff;\n  header[index] = (this.numberToSkip) & 0xff;\n  index = index + 4;\n\n  // Write header information flags numberToReturn\n  header[index + 3] = (this.numberToReturn >> 24) & 0xff;\n  header[index + 2] = (this.numberToReturn >> 16) & 0xff;\n  header[index + 1] = (this.numberToReturn >> 8) & 0xff;\n  header[index] = (this.numberToReturn) & 0xff;\n  index = index + 4;\n\n  // Return the buffers\n  return buffers;\n}\n\nQuery.getRequestId = function() {\n  return ++_requestId;\n}\n\n/**************************************************************\n * GETMORE\n **************************************************************/\nvar GetMore = function(bson, ns, cursorId, opts) {\n  opts = opts || {};\n  this.numberToReturn = opts.numberToReturn || 0;\n  this.requestId = _requestId++;\n  this.bson = bson;\n  this.ns = ns;\n  this.cursorId = cursorId;\n}\n\n//\n// Uses a single allocated buffer for the process, avoiding multiple memory allocations\nGetMore.prototype.toBin = function() {\n  var length = 4 + Buffer.byteLength(this.ns) + 1 + 4 + 8 + (4 * 4);\n  // Create command buffer\n  var index = 0;\n  // Allocate buffer\n  var _buffer = new Buffer(length);\n\n  // Write header information\n  // index = write32bit(index, _buffer, length);\n  _buffer[index + 3] = (length >> 24) & 0xff;\n  _buffer[index + 2] = (length >> 16) & 0xff;\n  _buffer[index + 1] = (length >> 8) & 0xff;\n  _buffer[index] = (length) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, requestId);\n  _buffer[index + 3] = (this.requestId >> 24) & 0xff;\n  _buffer[index + 2] = (this.requestId >> 16) & 0xff;\n  _buffer[index + 1] = (this.requestId >> 8) & 0xff;\n  _buffer[index] = (this.requestId) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, 0);\n  _buffer[index + 3] = (0 >> 24) & 0xff;\n  _buffer[index + 2] = (0 >> 16) & 0xff;\n  _buffer[index + 1] = (0 >> 8) & 0xff;\n  _buffer[index] = (0) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, OP_GETMORE);\n  _buffer[index + 3] = (OP_GETMORE >> 24) & 0xff;\n  _buffer[index + 2] = (OP_GETMORE >> 16) & 0xff;\n  _buffer[index + 1] = (OP_GETMORE >> 8) & 0xff;\n  _buffer[index] = (OP_GETMORE) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, 0);\n  _buffer[index + 3] = (0 >> 24) & 0xff;\n  _buffer[index + 2] = (0 >> 16) & 0xff;\n  _buffer[index + 1] = (0 >> 8) & 0xff;\n  _buffer[index] = (0) & 0xff;\n  index = index + 4;\n\n  // Write collection name\n  index = index + _buffer.write(this.ns, index, 'utf8') + 1;\n  _buffer[index - 1] = 0;\n\n  // Write batch size\n  // index = write32bit(index, _buffer, numberToReturn);\n  _buffer[index + 3] = (this.numberToReturn >> 24) & 0xff;\n  _buffer[index + 2] = (this.numberToReturn >> 16) & 0xff;\n  _buffer[index + 1] = (this.numberToReturn >> 8) & 0xff;\n  _buffer[index] = (this.numberToReturn) & 0xff;\n  index = index + 4;\n\n  // Write cursor id\n  // index = write32bit(index, _buffer, cursorId.getLowBits());\n  _buffer[index + 3] = (this.cursorId.getLowBits() >> 24) & 0xff;\n  _buffer[index + 2] = (this.cursorId.getLowBits() >> 16) & 0xff;\n  _buffer[index + 1] = (this.cursorId.getLowBits() >> 8) & 0xff;\n  _buffer[index] = (this.cursorId.getLowBits()) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, cursorId.getHighBits());\n  _buffer[index + 3] = (this.cursorId.getHighBits() >> 24) & 0xff;\n  _buffer[index + 2] = (this.cursorId.getHighBits() >> 16) & 0xff;\n  _buffer[index + 1] = (this.cursorId.getHighBits() >> 8) & 0xff;\n  _buffer[index] = (this.cursorId.getHighBits()) & 0xff;\n  index = index + 4;\n\n  // Return buffer\n  return _buffer;\n}\n\n/**************************************************************\n * KILLCURSOR\n **************************************************************/\nvar KillCursor = function(bson, cursorIds) {\n  this.requestId = _requestId++;\n  this.cursorIds = cursorIds;\n}\n\n//\n// Uses a single allocated buffer for the process, avoiding multiple memory allocations\nKillCursor.prototype.toBin = function() {\n  var length = 4 + 4 + (4 * 4) + (this.cursorIds.length * 8);\n\n  // Create command buffer\n  var index = 0;\n  var _buffer = new Buffer(length);\n\n  // Write header information\n  // index = write32bit(index, _buffer, length);\n  _buffer[index + 3] = (length >> 24) & 0xff;\n  _buffer[index + 2] = (length >> 16) & 0xff;\n  _buffer[index + 1] = (length >> 8) & 0xff;\n  _buffer[index] = (length) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, requestId);\n  _buffer[index + 3] = (this.requestId >> 24) & 0xff;\n  _buffer[index + 2] = (this.requestId >> 16) & 0xff;\n  _buffer[index + 1] = (this.requestId >> 8) & 0xff;\n  _buffer[index] = (this.requestId) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, 0);\n  _buffer[index + 3] = (0 >> 24) & 0xff;\n  _buffer[index + 2] = (0 >> 16) & 0xff;\n  _buffer[index + 1] = (0 >> 8) & 0xff;\n  _buffer[index] = (0) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, OP_KILL_CURSORS);\n  _buffer[index + 3] = (OP_KILL_CURSORS >> 24) & 0xff;\n  _buffer[index + 2] = (OP_KILL_CURSORS >> 16) & 0xff;\n  _buffer[index + 1] = (OP_KILL_CURSORS >> 8) & 0xff;\n  _buffer[index] = (OP_KILL_CURSORS) & 0xff;\n  index = index + 4;\n\n  // index = write32bit(index, _buffer, 0);\n  _buffer[index + 3] = (0 >> 24) & 0xff;\n  _buffer[index + 2] = (0 >> 16) & 0xff;\n  _buffer[index + 1] = (0 >> 8) & 0xff;\n  _buffer[index] = (0) & 0xff;\n  index = index + 4;\n\n  // Write batch size\n  // index = write32bit(index, _buffer, this.cursorIds.length);\n  _buffer[index + 3] = (this.cursorIds.length >> 24) & 0xff;\n  _buffer[index + 2] = (this.cursorIds.length >> 16) & 0xff;\n  _buffer[index + 1] = (this.cursorIds.length >> 8) & 0xff;\n  _buffer[index] = (this.cursorIds.length) & 0xff;\n  index = index + 4;\n\n  // Write all the cursor ids into the array\n  for(var i = 0; i < this.cursorIds.length; i++) {\n    // Write cursor id\n    // index = write32bit(index, _buffer, cursorIds[i].getLowBits());\n    _buffer[index + 3] = (this.cursorIds[i].getLowBits() >> 24) & 0xff;\n    _buffer[index + 2] = (this.cursorIds[i].getLowBits() >> 16) & 0xff;\n    _buffer[index + 1] = (this.cursorIds[i].getLowBits() >> 8) & 0xff;\n    _buffer[index] = (this.cursorIds[i].getLowBits()) & 0xff;\n    index = index + 4;\n\n    // index = write32bit(index, _buffer, cursorIds[i].getHighBits());\n    _buffer[index + 3] = (this.cursorIds[i].getHighBits() >> 24) & 0xff;\n    _buffer[index + 2] = (this.cursorIds[i].getHighBits() >> 16) & 0xff;\n    _buffer[index + 1] = (this.cursorIds[i].getHighBits() >> 8) & 0xff;\n    _buffer[index] = (this.cursorIds[i].getHighBits()) & 0xff;\n    index = index + 4;\n  }\n\n  // Return buffer\n  return _buffer;\n}\n\nvar Response = function(bson, data, opts) {\n  opts = opts || {promoteLongs: true, promoteValues: true, promoteBuffers: false};\n  this.parsed = false;\n\n  //\n  // Parse Header\n  //\n  this.index = 0;\n  this.raw = data;\n  this.data = data;\n  this.bson = bson;\n  this.opts = opts;\n\n  // Read the message length\n  this.length = data[this.index] | data[this.index + 1] << 8 | data[this.index + 2] << 16 | data[this.index + 3] << 24;\n  this.index = this.index + 4;\n\n  // Fetch the request id for this reply\n  this.requestId = data[this.index] | data[this.index + 1] << 8 | data[this.index + 2] << 16 | data[this.index + 3] << 24;\n  this.index = this.index + 4;\n\n  // Fetch the id of the request that triggered the response\n  this.responseTo = data[this.index] | data[this.index + 1] << 8 | data[this.index + 2] << 16 | data[this.index + 3] << 24;\n  this.index = this.index + 4;\n\n  // Skip op-code field\n  this.index = this.index + 4;\n\n  // Unpack flags\n  this.responseFlags = data[this.index] | data[this.index + 1] << 8 | data[this.index + 2] << 16 | data[this.index + 3] << 24;\n  this.index = this.index + 4;\n\n  // Unpack the cursor\n  var lowBits = data[this.index] | data[this.index + 1] << 8 | data[this.index + 2] << 16 | data[this.index + 3] << 24;\n  this.index = this.index + 4;\n  var highBits = data[this.index] | data[this.index + 1] << 8 | data[this.index + 2] << 16 | data[this.index + 3] << 24;\n  this.index = this.index + 4;\n  // Create long object\n  this.cursorId = new Long(lowBits, highBits);\n\n  // Unpack the starting from\n  this.startingFrom = data[this.index] | data[this.index + 1] << 8 | data[this.index + 2] << 16 | data[this.index + 3] << 24;\n  this.index = this.index + 4;\n\n  // Unpack the number of objects returned\n  this.numberReturned = data[this.index] | data[this.index + 1] << 8 | data[this.index + 2] << 16 | data[this.index + 3] << 24;\n  this.index = this.index + 4;\n\n  // Preallocate document array\n  this.documents = new Array(this.numberReturned);\n\n  // Flag values\n  this.cursorNotFound = (this.responseFlags & CURSOR_NOT_FOUND) != 0;\n  this.queryFailure = (this.responseFlags & QUERY_FAILURE) != 0;\n  this.shardConfigStale = (this.responseFlags & SHARD_CONFIG_STALE) != 0;\n  this.awaitCapable = (this.responseFlags & AWAIT_CAPABLE) != 0;\n  this.promoteLongs = typeof opts.promoteLongs == 'boolean' ? opts.promoteLongs : true;\n  this.promoteValues = typeof opts.promoteValues == 'boolean' ? opts.promoteValues : true;\n  this.promoteBuffers = typeof opts.promoteBuffers == 'boolean' ? opts.promoteBuffers : false;\n}\n\nResponse.prototype.isParsed = function() {\n  return this.parsed;\n}\n\nResponse.prototype.parse = function(options) {\n  // Don't parse again if not needed\n  if(this.parsed) return;\n  options = options || {};\n\n  // Allow the return of raw documents instead of parsing\n  var raw = options.raw || false;\n  var documentsReturnedIn = options.documentsReturnedIn || null;\n  var promoteLongs = typeof options.promoteLongs == 'boolean'\n    ? options.promoteLongs\n    : this.opts.promoteLongs;\n  var promoteValues = typeof options.promoteValues == 'boolean'\n    ? options.promoteValues\n    : this.opts.promoteValues;\n  var promoteBuffers = typeof options.promoteBuffers == 'boolean'\n    ? options.promoteBuffers\n    : this.opts.promoteBuffers\n  var bsonSize, _options;\n\n  // Set up the options\n  _options = {\n    promoteLongs: promoteLongs,\n    promoteValues: promoteValues,\n    promoteBuffers: promoteBuffers\n  };\n\n  //\n  // Single document and documentsReturnedIn set\n  //\n  if(this.numberReturned == 1 && documentsReturnedIn != null && raw) {\n    // Calculate the bson size\n    bsonSize = this.data[this.index] | this.data[this.index + 1] << 8 | this.data[this.index + 2] << 16 | this.data[this.index + 3] << 24;\n    // Slice out the buffer containing the command result document\n    var document = this.data.slice(this.index, this.index + bsonSize);\n    // Set up field we wish to keep as raw\n    var fieldsAsRaw = {}\n    fieldsAsRaw[documentsReturnedIn] = true;\n    _options.fieldsAsRaw = fieldsAsRaw;\n\n    // Deserialize but keep the array of documents in non-parsed form\n    var doc = this.bson.deserialize(document, _options);\n\n    // Get the documents\n    this.documents = doc.cursor[documentsReturnedIn];\n    this.numberReturned = this.documents.length;\n    // Ensure we have a Long valie cursor id\n    this.cursorId = typeof doc.cursor.id == 'number'\n      ? Long.fromNumber(doc.cursor.id)\n      : doc.cursor.id;\n\n    // Adjust the index\n    this.index = this.index + bsonSize;\n\n    // Set as parsed\n    this.parsed = true\n    return;\n  }\n\n  //\n  // Parse Body\n  //\n  for(var i = 0; i < this.numberReturned; i++) {\n    bsonSize = this.data[this.index] | this.data[this.index + 1] << 8 | this.data[this.index + 2] << 16 | this.data[this.index + 3] << 24;\n\n    // If we have raw results specified slice the return document\n    if(raw) {\n      this.documents[i] = this.data.slice(this.index, this.index + bsonSize);\n    } else {\n      this.documents[i] = this.bson.deserialize(this.data.slice(this.index, this.index + bsonSize), _options);\n    }\n\n    // Adjust the index\n    this.index = this.index + bsonSize;\n  }\n\n  // Set parsed\n  this.parsed = true;\n}\n\nmodule.exports = {\n    Query: Query\n  , GetMore: GetMore\n  , Response: Response\n  , KillCursor: KillCursor\n}\n"]}