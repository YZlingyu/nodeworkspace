{"version":3,"sources":["socket.js"],"names":[],"mappings":"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","file":"socket-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar parser = require('socket.io-parser');\nvar Emitter = require('component-emitter');\nvar toArray = require('to-array');\nvar on = require('./on');\nvar bind = require('component-bind');\nvar debug = require('debug')('socket.io-client:socket');\nvar hasBin = require('has-binary');\n\n/**\n * Module exports.\n */\n\nmodule.exports = exports = Socket;\n\n/**\n * Internal events (blacklisted).\n * These events can't be emitted by the user.\n *\n * @api private\n */\n\nvar events = {\n  connect: 1,\n  connect_error: 1,\n  connect_timeout: 1,\n  connecting: 1,\n  disconnect: 1,\n  error: 1,\n  reconnect: 1,\n  reconnect_attempt: 1,\n  reconnect_failed: 1,\n  reconnect_error: 1,\n  reconnecting: 1,\n  ping: 1,\n  pong: 1\n};\n\n/**\n * Shortcut to `Emitter#emit`.\n */\n\nvar emit = Emitter.prototype.emit;\n\n/**\n * `Socket` constructor.\n *\n * @api public\n */\n\nfunction Socket (io, nsp, opts) {\n  this.io = io;\n  this.nsp = nsp;\n  this.json = this; // compat\n  this.ids = 0;\n  this.acks = {};\n  this.receiveBuffer = [];\n  this.sendBuffer = [];\n  this.connected = false;\n  this.disconnected = true;\n  if (opts && opts.query) {\n    this.query = opts.query;\n  }\n  if (this.io.autoConnect) this.open();\n}\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Socket.prototype);\n\n/**\n * Subscribe to open, close and packet events\n *\n * @api private\n */\n\nSocket.prototype.subEvents = function () {\n  if (this.subs) return;\n\n  var io = this.io;\n  this.subs = [\n    on(io, 'open', bind(this, 'onopen')),\n    on(io, 'packet', bind(this, 'onpacket')),\n    on(io, 'close', bind(this, 'onclose'))\n  ];\n};\n\n/**\n * \"Opens\" the socket.\n *\n * @api public\n */\n\nSocket.prototype.open =\nSocket.prototype.connect = function () {\n  if (this.connected) return this;\n\n  this.subEvents();\n  this.io.open(); // ensure open\n  if ('open' === this.io.readyState) this.onopen();\n  this.emit('connecting');\n  return this;\n};\n\n/**\n * Sends a `message` event.\n *\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.send = function () {\n  var args = toArray(arguments);\n  args.unshift('message');\n  this.emit.apply(this, args);\n  return this;\n};\n\n/**\n * Override `emit`.\n * If the event is in `events`, it's emitted normally.\n *\n * @param {String} event name\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.emit = function (ev) {\n  if (events.hasOwnProperty(ev)) {\n    emit.apply(this, arguments);\n    return this;\n  }\n\n  var args = toArray(arguments);\n  var parserType = parser.EVENT; // default\n  if (hasBin(args)) { parserType = parser.BINARY_EVENT; } // binary\n  var packet = { type: parserType, data: args };\n\n  packet.options = {};\n  packet.options.compress = !this.flags || false !== this.flags.compress;\n\n  // event ack callback\n  if ('function' === typeof args[args.length - 1]) {\n    debug('emitting packet with ack id %d', this.ids);\n    this.acks[this.ids] = args.pop();\n    packet.id = this.ids++;\n  }\n\n  if (this.connected) {\n    this.packet(packet);\n  } else {\n    this.sendBuffer.push(packet);\n  }\n\n  delete this.flags;\n\n  return this;\n};\n\n/**\n * Sends a packet.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.packet = function (packet) {\n  packet.nsp = this.nsp;\n  this.io.packet(packet);\n};\n\n/**\n * Called upon engine `open`.\n *\n * @api private\n */\n\nSocket.prototype.onopen = function () {\n  debug('transport is open - connecting');\n\n  // write connect packet if necessary\n  if ('/' !== this.nsp) {\n    if (this.query) {\n      this.packet({type: parser.CONNECT, query: this.query});\n    } else {\n      this.packet({type: parser.CONNECT});\n    }\n  }\n};\n\n/**\n * Called upon engine `close`.\n *\n * @param {String} reason\n * @api private\n */\n\nSocket.prototype.onclose = function (reason) {\n  debug('close (%s)', reason);\n  this.connected = false;\n  this.disconnected = true;\n  delete this.id;\n  this.emit('disconnect', reason);\n};\n\n/**\n * Called with socket packet.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onpacket = function (packet) {\n  if (packet.nsp !== this.nsp) return;\n\n  switch (packet.type) {\n    case parser.CONNECT:\n      this.onconnect();\n      break;\n\n    case parser.EVENT:\n      this.onevent(packet);\n      break;\n\n    case parser.BINARY_EVENT:\n      this.onevent(packet);\n      break;\n\n    case parser.ACK:\n      this.onack(packet);\n      break;\n\n    case parser.BINARY_ACK:\n      this.onack(packet);\n      break;\n\n    case parser.DISCONNECT:\n      this.ondisconnect();\n      break;\n\n    case parser.ERROR:\n      this.emit('error', packet.data);\n      break;\n  }\n};\n\n/**\n * Called upon a server event.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onevent = function (packet) {\n  var args = packet.data || [];\n  debug('emitting event %j', args);\n\n  if (null != packet.id) {\n    debug('attaching ack callback to event');\n    args.push(this.ack(packet.id));\n  }\n\n  if (this.connected) {\n    emit.apply(this, args);\n  } else {\n    this.receiveBuffer.push(args);\n  }\n};\n\n/**\n * Produces an ack callback to emit with an event.\n *\n * @api private\n */\n\nSocket.prototype.ack = function (id) {\n  var self = this;\n  var sent = false;\n  return function () {\n    // prevent double callbacks\n    if (sent) return;\n    sent = true;\n    var args = toArray(arguments);\n    debug('sending ack %j', args);\n\n    var type = hasBin(args) ? parser.BINARY_ACK : parser.ACK;\n    self.packet({\n      type: type,\n      id: id,\n      data: args\n    });\n  };\n};\n\n/**\n * Called upon a server acknowlegement.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onack = function (packet) {\n  var ack = this.acks[packet.id];\n  if ('function' === typeof ack) {\n    debug('calling ack %s with %j', packet.id, packet.data);\n    ack.apply(this, packet.data);\n    delete this.acks[packet.id];\n  } else {\n    debug('bad ack %s', packet.id);\n  }\n};\n\n/**\n * Called upon server connect.\n *\n * @api private\n */\n\nSocket.prototype.onconnect = function () {\n  this.connected = true;\n  this.disconnected = false;\n  this.emit('connect');\n  this.emitBuffered();\n};\n\n/**\n * Emit buffered events (received and emitted).\n *\n * @api private\n */\n\nSocket.prototype.emitBuffered = function () {\n  var i;\n  for (i = 0; i < this.receiveBuffer.length; i++) {\n    emit.apply(this, this.receiveBuffer[i]);\n  }\n  this.receiveBuffer = [];\n\n  for (i = 0; i < this.sendBuffer.length; i++) {\n    this.packet(this.sendBuffer[i]);\n  }\n  this.sendBuffer = [];\n};\n\n/**\n * Called upon server disconnect.\n *\n * @api private\n */\n\nSocket.prototype.ondisconnect = function () {\n  debug('server disconnect (%s)', this.nsp);\n  this.destroy();\n  this.onclose('io server disconnect');\n};\n\n/**\n * Called upon forced client/server side disconnections,\n * this method ensures the manager stops tracking us and\n * that reconnections don't get triggered for this.\n *\n * @api private.\n */\n\nSocket.prototype.destroy = function () {\n  if (this.subs) {\n    // clean subscriptions to avoid reconnections\n    for (var i = 0; i < this.subs.length; i++) {\n      this.subs[i].destroy();\n    }\n    this.subs = null;\n  }\n\n  this.io.destroy(this);\n};\n\n/**\n * Disconnects the socket manually.\n *\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.close =\nSocket.prototype.disconnect = function () {\n  if (this.connected) {\n    debug('performing disconnect (%s)', this.nsp);\n    this.packet({ type: parser.DISCONNECT });\n  }\n\n  // remove socket from pool\n  this.destroy();\n\n  if (this.connected) {\n    // fire events\n    this.onclose('io client disconnect');\n  }\n  return this;\n};\n\n/**\n * Sets the compress flag.\n *\n * @param {Boolean} if `true`, compresses the sending data\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.compress = function (compress) {\n  this.flags = this.flags || {};\n  this.flags.compress = compress;\n  return this;\n};\n"]}